var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i},__assign=this&&this.__assign||Object.assign||function(e){for(var t,i=1,o=arguments.length;o>i;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},__awaiter=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(r,n){function s(e){try{h(o.next(e))}catch(t){n(t)}}function a(e){try{h(o["throw"](e))}catch(t){n(t)}}function h(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(s,a)}h((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return o([e,t])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,n&&(s=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(o){i=[6,o],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},ViewBase=function(e){function t(){var t=e.call(this)||this;return t.$sumStep=0,t.$totalStep=2,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdd,t),t.addEventListener(eui.UIEvent.COMPLETE,t.onComplete,t),t}return __extends(t,e),t.prototype.onComplete=function(e){this.init(),this.notifyCall(),this.onViewResize(),this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onAdd=function(e){this.notifyCall()},t.prototype.notifyCall=function(){this.$sumStep++,this.$sumStep>=this.$totalStep&&this.onShowDone()},t.prototype.onShowDone=function(){this.addEvent(),this.show()},t.prototype.onRmove=function(e){this.destory()},t.prototype.init=function(){},t.prototype.show=function(){},t.prototype.onResize=function(e){this.onViewResize()},t.prototype.onViewResize=function(){var e=GameConfig.curWidth(),t=GameConfig.curHeight();if(this.$content){var i=this.$content;i.width=e,i.height=t}},t.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRmove,this),this.stage.addEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRmove,this),this.stage.removeEventListener(egret.Event.RESIZE,this.onResize,this)},t.prototype.destory=function(){this.removeEvent()},t}(eui.Component);__reflect(ViewBase.prototype,"ViewBase",["eui.UIComponent","egret.DisplayObject"]);var BaseOption=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.compelete,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClickHandler,t),t}return __extends(t,e),t.prototype.setChild=function(e){return"group"===e.type?(e.x=this.width/2,e.y=this.height/2,void(e.width=e.height=0)):(e.x=e.y=0,this.scaleX=this.scaleY=1,this.width=e.width*e.scaleX,void(this.height=e.height*e.scaleY))},t.prototype.showAnswer=function(e,t){void 0===t&&(t=function(){});var i=Math.max(this.width,this.height);this.resultRect.width=this.resultRect.height=this.resultRect.ellipseWidth=this.resultRect.ellipseHeight=i,this.resultRect.fillColor=e===!0?5030013:16711680,this.resultRect.alpha=1,this.resultRect.scaleX=this.resultRect.scaleY=0,egret.Tween.get(this.resultRect).to({scaleX:1.3,scaleY:1.3,alpha:0},700).call(t)},t.prototype.onClickHandler=function(){},t.prototype.compelete=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.compelete,this),this.resultRect.mask=this.optionMask},t}(eui.Component);__reflect(BaseOption.prototype,"BaseOption");var BaseQuiz=function(e){function t(t){var i=e.call(this)||this;return i.options=[],i.guides=[],i.rightAnswerNum=0,i.optionSkinUrl="resource/ui/courseware/BaseOptionSkin.exml",i.actionOptionSkinUrl="resource/ui/courseware/ActionOptionSkin.exml",i.autoPlayAudios=[],i.audioPlayer=AudioPlayer.getInstance(),i.firstGuide=!0,i.currentPageData=t,i.skinName="QuizSkin",i}return __extends(t,e),t.prototype.addEvent=function(){e.prototype.addEvent.call(this),EventUtils.addEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.addEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),EventUtils.removeEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.removeEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.onTextLight=function(e){if(this._curTxt){var t=e.data.word,i=e.data.pos,o=this._txtCopy,r=o.indexOf(t,i),n=r+t.length,s=o.substring(0,r),a=o.substring(r,n+1),h=o.substring(n+1);this._curTxt.textFlow=[{text:s,style:{textColor:this._color}},{text:a,style:{textColor:16423680}},{text:h,style:{textColor:this._color}}]}},t.prototype.onTextRecover=function(e){this._curTxt&&(this._curTxt.textFlow=[],this._curTxt.text=this._txtCopy,this._curTxt.textColor=this._color)},t.prototype.init=function(){e.prototype.init.call(this),this._soundPlaying=!1,this._audioList={},this._iconList=[],this.containerMask.visible=!1,this.container.scrollEnabled=!0,this._ms.alpha=.4},t.prototype.setPlayModel=function(e,t){console.log("recordData 123",t,e),this.playModel=e,this.recordUrl=t&&t.audio,this.initQuiz(this.currentPageData)},t.prototype.getGuidePointArray=function(){this.guides=[];for(var e=this.container,t=0;t<e.numChildren;t++){var i=e.getChildAt(t);i.hasGuide&&this.guides.push({x:i.x+i.width/2,y:i.y+i.height/2,index:i.playIndex})}this.guides=this.guides.sort(function(e,t){return e.index-t.index})},t.prototype.showGuide=function(e){var t=this;if(void 0===e&&(e=0),"read"!=this.readModel&&"normal"!=this.readModel||"txtPaging"!=this.currentPageData.typesetting){var i=DBFactory.getGuiderAnimate("xiaohuangdian");this.container.addChild(i),i.x=50,i.y=50,i.addEventListener(dragonBones.EventObject.COMPLETE,function(){e+=1,e<t.guides.length&&t.showGuide(e)},this),i.animation.play("xiaohuangdian",1),i.x=this.guides[e].x+20,i.y=this.guides[e].y+20}},t.prototype.changeState=function(e){this.currentState=e},t.prototype.getScore=function(){return 0},t.prototype.getOptionBtn=function(e){var t=new BaseOption;return t},t.prototype.getActionBtn=function(e){var t;return e.animateData?(t=new AnimateActionOption,t.setAnimateData(e.animateData)):t=new ActionOption,t},t.prototype.makeActionContainer=function(e,t){var i=this.getActionBtn(e),o=e.objects?!0:!1;i.id=e.id,i.x=e.left,i.y=e.top,i.width=e.width,i.height=e.height,i.nest=o,i.addEventListener(eui.UIEvent.COMPLETE,function(){return t(i)},this),i.skinName=this.actionOptionSkinUrl},t.prototype.makeActiveObject=function(e,t){e.answer===!0&&this.rightAnswerNum++;var i=this.getOptionBtn(e),o=e.objects?!0:!1;i.id=e.id,i.x=e.left,i.y=e.top,i.width=e.width,i.height=e.height,i.nest=o,i.answer=e.answer,i.addEventListener(eui.UIEvent.COMPLETE,function(){return t(i)},this),i.skinName=this.optionSkinUrl,this.options.push(i)},t.prototype.loadImage=function(e,t){RES.getResByUrl(""+e.src+Global.webpSuffix,function(e){t.texture=e},this,"image")},t.prototype.makeDisplayObjByData=function(e){var t,i,o=0;if("txtPaging"!=this.currentPageData.typesetting&&("i-text"===e.type||"textbox"===e.type)){t=new egret.TextField;var r=e.text;o=r.length<=20?12:5,this._txtCopy=r,t.text=r,this._color=t.textColor=e.fill.replace(/#/,"0x"),t.fontFamily=e.fontFamily,t.size=e.fontSize,t.textAlign=e.textAlign,t.lineSpacing=t.size*e.lineHeight*.2,t.italic="italic"==e.fontStyle?!0:!1,t.bold="bold"==e.fontWeight?!0:!1,e.top=e.top+3,e.height=void 0,e.stroke&&(t.stroke=e.strokeWidth,t.strokeColor=e.stroke),i=new eui.Group,this.container.addChild(i),this._iconList.push(i),this._curTxt=t}if("image"===e.type&&(t=new egret.Bitmap,this.loadImage(e,t)),"group"===e.type&&(t=new eui.Group,e.left=e.left+e.width/2,e.top=e.top+e.height/2),"rect"===e.type&&(t=new eui.Rect,t.ellipseWidth=2.3*e.rx,t.ellipseHeight=2.3*e.ry,t.fillColor=e.fill.replace(/#/,"0x"),t.alpha=e.opacity),"iframe"===e.type&&(t=new WebView(e.iframeUrl),t.show()),"video"===e.type&&(t=new WebVideo(e.videoUrl),t.show()),t){if(t.type=e.type,t.x=e.left,t.y=e.top,t.scaleX=e.scaleX,t.scaleY=e.scaleY,t.rotation=e.angle,t.width=e.width+o,e.height&&(t.height=e.height),e.shadow){var n=e.shadow;n.color&&(n.offsetX?t.filters=[new egret.DropShadowFilter(1.5*n.offsetX,45,n.color.replace(/#/,"0x"),1,1,1,1)]:t.filters=[new egret.DropShadowFilter(0,0,n.color.replace(/#/,"0x"),1,n.blur,n.blur,2,3,!1,!1)])}i&&(i.width=i.height=44,i.x=t.x-98,i.y=t.y-20,i.x<=0&&(i.x=t.x-10,i.y=t.y-85))}return e.audio&&(i&&this.createAudioIcon(i,e.audio),this.installAudioPlayer(i,e.audio)),t},t.prototype.installAudioPlayer=function(e,t){var i=this;t.autoPlay&&this.autoPlayAudios.push(t),console.log("displayObj ",e),e&&(e.touchEnabled=!0,e.hasGuide=!0,e.playIndex=t.index,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(i,void 0,void 0,function(){var e,i,e,i,o=this;return __generator(this,function(r){switch(r.label){case 0:return this._soundPlaying?[2]:(this._soundPlaying=!0,this._soundTo=egret.setTimeout(function(){o._soundPlaying=!1},this,1e3),AudioPlayer.getInstance().stop(),(GameConfig.isOthers||GameConfig.isSrpg())&&this.recordUrl&&""!=this.recordUrl?(console.log("onTouch ===",GameConfig.isOthers,this.recordUrl,this.recordUrl),e=this.recordUrl,i=this._audioList[t.url],i.gotoAndPlay(0),console.log("on sound"),game.AppFacade.getInstance().sendNotification(CoursewareNotify.PLAY_SAMPLE_SOUND),[4,this.audioPlayer.play(e)]):[3,2]);case 1:return r.sent(),i.gotoAndStop(3),this.soundComplete(),[3,4];case 2:return e=t.url,i=this._audioList[e],i.gotoAndPlay(0),console.log("on sound"),game.AppFacade.getInstance().sendNotification(CoursewareNotify.PLAY_SAMPLE_SOUND),LightUtils.single.start(),[4,this.audioPlayer.play(e)];case 3:r.sent(),i.gotoAndStop(3),this.soundComplete(),r.label=4;case 4:return[2]}})})},this))},t.prototype.createAudioIcon=function(e,t){var i=McFactory.getPlaySound("NewProject");i.gotoAndStop(3),i.x=44,i.y=44,i.frameRate=6,e.addChild(i),this._audioList[t.url]=i},t.prototype.startRecord=function(){this.stopPlayIcon()},t.prototype.stopPlayIcon=function(){console.log("重置图标========》》》》》 ",this._audioList),ToolBarLayer.single.setIconStatus();for(var e=Object.keys(this._audioList),t=e.length,i=0;t>i;i++){var o=this._audioList[e[i]];o.gotoAndStop(3)}},t.prototype.removeAudioIcon=function(){for(var e=Object.keys(this._audioList),t=e.length,i=0;t>i;i++){var o=this._audioList[e[i]];o.parent&&o.parent.removeChild(o),o.stop(),o=null}this._audioList=null},t.prototype.resolveCoursewareData=function(e,t){var i=this;console.log("resolveCoursewareData");var o=0;e.objects.forEach(function(e,t){e=__assign({},e),("i-text"===e.type||"textbox"===e.type)&&o++}),o>=2&&(this.currentPageData.typesetting="txtPaging"),e.objects.forEach(function(e,o){e=__assign({},e);var r=i.makeDisplayObjByData(e);r&&(t instanceof ActionOption&&t.setChild(i.makeDisplayObjByData(e)),t.addChild(r),"group"===e.type&&i.resolveCoursewareData(e,r))})},t.prototype.initQuiz=function(e){var t=this;if(this.container.removeChildren(),e.background){var i=new egret.Shape;i.touchEnabled=!1,i.graphics.beginFill(e.background.replace(/#/,"0x")),i.graphics.drawRect(0,0,1280,640),i.graphics.endFill(),i.cacheAsBitmap=!0,this.container.addChildAt(i,0)}if(e.backgroundImage){var o=new egret.Bitmap;o.width=1280,o.height=640,this.container.addChildAt(o,1),this.loadImage(e.backgroundImage,o)}var r=new eui.Image;if(this._border=r,r.source=RES.getRes("read_book_png"),r.width=1300,r.height=660,r.x=-10,r.y=0,GameLayerManager.gameLayer().backgroudLayer.addChildAt(r,2),this.resolveCoursewareData(e,this.container),console.log("this._iconList",this._iconList),this._iconList&&this._iconList.length)for(var n=this._iconList.length,s=0;n>s;s++){var a=this._iconList[s];a&&a.parent&&a.parent.setChildIndex(a,a.parent.numChildren-1)}return this.onViewResize(),console.log("this.playModel 111",this.playModel,GameConfig.isOthers,this.recordUrl),this.recordUrl&&""!=this.recordUrl&&("record"===this.playModel||GameConfig.isOthers)?void(this._to=egret.setTimeout(function(){t.playRecordSound(t.recordUrl)},this,600)):void(this.autoPlayAudios.length&&"txtPaging"!=this.currentPageData.typesetting?(console.log("this.autoPlayAudios",this.autoPlayAudios),this.autoPlayAudios.sort(function(e,t){return e.index-t.index}),this._to=setTimeout(function(){return t.playLoopSound(0)},1200)):this.autoPlayAudios.length&&"txtPaging"==this.currentPageData.typesetting&&(console.log("this.autoPlayAudios 123",this.autoPlayAudios),this._to=egret.setTimeout(function(){console.log("delay ",t.autoPlayAudios),ToolBarLayer.single.playAudio(t.autoPlayAudios,t.recordUrl&&""!=t.recordUrl,t.soundComplete,t)},this,1200)))},t.prototype.setTool=function(){"txtPaging"==this.currentPageData.typesetting?ToolBarLayer.single.showTool(this.readModel,this.currentPageData,this.container):"record"==this.readModel?ToolBarLayer.single.showTool(this.readModel,this.currentPageData,this.container):ToolBarLayer.single.hideTool()},t.prototype.playRecordSound=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return console.log("url playRecordSound",e),t=e,t?[4,this.audioPlayer.play(e+"?"+Date.now())]:[3,2];case 1:t=i.sent(),i.label=2;case 2:return[4,Global.delay(0)];case 3:return i.sent(),this.soundComplete(GameConfig.isOthers),[2]}})})},t.prototype.playLoopSound=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o;return __generator(this,function(r){switch(r.label){case 0:return console.log(this.autoPlayAudios.length,window.currentPageNum),1!==window.currentPageNum?[3,2]:[4,Global.delay(0)];case 1:r.sent(),r.label=2;case 2:return!this.autoPlayAudios.length||P.getRecordProxy().recording?[2]:(t=this.autoPlayAudios[e].url,i=this._audioList[t],i&&i.gotoAndPlay(0,-1),LightUtils.single.start(),[4,this.audioPlayer.play(t)]);case 3:return r.sent(),i&&i.gotoAndStop(3),e<this.autoPlayAudios.length-1?this.playLoopSound(e+=1):(console.log("this.recordUrl",this.recordUrl,this.readModel),o=this.recordUrl&&""!=this.recordUrl?!1:!0,this.soundComplete(o)),[2]}})})},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=1,i=GameConfig.curWidth(),o=GameConfig.curHeight(),r=i/o,n=this.container;if(n.height>o)t=o/n.height;else{var s=r>1.32&&1.35>r?90:0;t=(i-s)/this.container.width,n.height*t>o&&(t=o/n.height)}n.scaleY=n.scaleX=t,this.containerMask.scaleY=this.containerMask.scaleX=t,n.x=(i-n.width*t)/2,n.y=(o-n.height*t)/2,n.height*t!=o,this._ms.height=n.height*t,this._ms.visible=!1,GameLayerManager.gameLayer().maskLayer.addChild(this._ms),console.log("wd / ht ====== ",r,this._border);var a=this.localToGlobal(n.x,n.y),h=GameLayerManager.gameLayer().backgroudLayer.globalToLocal(a.x,a.y);this._border&&(this._border.width=n.width*t+70,this._border.height=n.height*t+60,this._border.x=h.x-35,this._border.y=h.y-8,this._border.visible=!0,console.log("s > 1.76 && s < 1.78",r>1.76&&1.78>r),r>1.76&&1.78>r&&(this._border.visible=!1)),this.containerMask.x=n.x,this.containerMask.y=n.y,this._ms.y=h.y,this._ms.x=(i-this._ms.width)/2},t.prototype.showShadow=function(){this._ms.name="ms",GameLayerManager.gameLayer().maskLayer.addChild(this._ms),this._ms.alpha=0,this._ms.visible=!0,egret.Tween.removeTweens(this._ms),egret.Tween.get(this._ms).to({alpha:.4},600).to({alpha:0},600)},t.prototype.hideShadow=function(){egret.Tween.removeTweens(this._ms),this._ms.visible=!1,this._ms.parent&&(console.log("removeShadow"),GameLayerManager.gameLayer().maskLayer.removeChildren())},t.prototype.destory=function(){e.prototype.destory.call(this),this.audioPlayer&&(this.audioPlayer.stop(),this.audioPlayer=null),this.removeAudioIcon(),this.autoPlayAudios=[],this._iconList=[],egret.clearTimeout(this._to),egret.clearTimeout(this._soundTo),LightUtils.single.stop(),console.log("destory quiz",this.autoPlayAudios)},t}(ViewBase);__reflect(BaseQuiz.prototype,"BaseQuiz");var ResourceProxyBase=function(e){function t(t){void 0===t&&(t="");var i=e.call(this,t)||this;return i._dataMap=new Array,i._proxyName="",i.requestHeader={UID:"141245728",Authorization:"2736294757334bb6462d898b79b2a37c",Version:"1.0.0"},i._proxyName=t,i}return __extends(t,e),t.prototype.setUserInfo=function(e){var t=e.Authorization,i=e.UID,o=e.Version,r=void 0===o?"1.0.0":o;e.UserType;this.setRequestHeader(i,t,r)},t.prototype.setRequestHeader=function(e,t,i){this.requestHeader={UID:e,Authorization:t,Version:i}},t.prototype.getRequestHeader=function(){return this.requestHeader},t.prototype.getData=function(){var e=RES.getRes(this._proxyName);return e},t.prototype.requestUrl=function(e){function t(e){var t=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");return t}var i=this,o=e.actionType,r=e.method,n=e.endpoint,s=e.params,a=void 0===s?{}:s,h=e.headers,c=void 0===h?{}:h;return new Promise(function(e,o){var s=new egret.HttpRequest;s.responseType=egret.HttpResponseType.TEXT,s.open("GET"===r?n+="?"+t(a):n,r),s.setRequestHeader("Content-Type","application/json");for(var h in c)s.setRequestHeader(h,c[h]);s.send(JSON.stringify(a));var l=function(t){var i=t.currentTarget,r=JSON.parse(i.response);return r?void(r.hasOwnProperty("code")?0===r.code?e(r):o(r):e(r)):void o({actionType:"",error:"no data"})},u=function(e){};s.addEventListener(egret.Event.COMPLETE,l,i),s.addEventListener(egret.IOErrorEvent.IO_ERROR,o,i),s.addEventListener(egret.ProgressEvent.PROGRESS,u,i)})["catch"](function(e){var t=window.dsBridge;e.actionType=o,t.call("echo.h5PlayerError",e),console.log(e)})},t}(puremvc.Proxy);__reflect(ResourceProxyBase.prototype,"ResourceProxyBase",["puremvc.IProxy","puremvc.INotifier"]);var ComboBoxItemBase=function(e){function t(){var t=e.call(this)||this;return t.$select=!1,t}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.setSelect(this.$select)},t.prototype.getSelect=function(){return this.$select},t.prototype.setSelect=function(e){this.$select=e},t}(eui.ItemRenderer);__reflect(ComboBoxItemBase.prototype,"ComboBoxItemBase",["eui.UIComponent","egret.DisplayObject"]);var ActionOption=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.compelete,t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onClickHandler,t),t}return __extends(t,e),t.prototype.setChild=function(e){return"group"===e.type?(e.x=this.width/2,e.y=this.height/2,void(e.width=e.height=0)):(e.x=e.y=0,this.scaleX=this.scaleY=1,this.width=e.width*e.scaleX,void(this.height=e.height*e.scaleY))},t.prototype.onClickHandler=function(e){},t.prototype.compelete=function(){this.removeEventListener(eui.UIEvent.COMPLETE,this.compelete,this)},t}(eui.Component);__reflect(ActionOption.prototype,"ActionOption");var BaseClickOption=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setChild=function(t){e.prototype.setChild.call(this,t),this.elementContainer.addChild(t)},t.prototype.onClickHandler=function(){this.playClickAnimation()},t.prototype.compelete=function(){e.prototype.compelete.call(this),Global.setCenterPoint(this),this.currentState="lock"},t.prototype.playClickAnimation=function(){ZipUtils.single.getSound("click_mp3").play(0,1)},t}(BaseOption);__reflect(BaseClickOption.prototype,"BaseClickOption");var SupersortQuiz=function(e){function t(t){var i=e.call(this,t)||this;return i.answerRightNum=0,i.firstChoice=!0,i.clickNum=0,i.optionSkinUrl="resource/ui/courseware/BaseMoveOptionSkin.exml",i.enabled=!1,i}return __extends(t,e),t.prototype.getScore=function(){this.enabled=!1,setTimeout(this.changeState.bind(this,"compelete"),1e3);for(var e=[],t=[],i=0;i<this.container.numChildren;i++){var o=this.container.getChildAt(i);"answer"===o.answer&&e.push(o),"zone"===o.answer&&t.push(o)}for(var r=0;r<e.length;r++)for(var n=function(i){var o=e[r],n=t[i];Global.hitTest(o,n)&&(o.depId===n.id?(o.showAnswer(!0),s.answerRightNum++):o.showAnswer(!1,function(){o.restPosition()})),n.alpha=0},s=this,a=0;a<t.length;a++)n(a);return this.answerRightNum},t.prototype.changeState=function(t){e.prototype.changeState.call(this,t),"enabled"===t&&(this.enabled=!0),"disabled"===t&&(this.enabled=!1),this.options.forEach(function(e){e.currentState=t})},t.prototype.getOptionBtn=function(e){var t=this,i=new BaseMoveOption;return i.startMoveCallBack=function(e){return t.startId=e},i.stopMoveCallBack=this.onStopMoveHandler.bind(this),i.depId=e.depId,e.depId&&this.rightAnswerNum++,i},t.prototype.onStopMoveHandler=function(e){if(e.id===this.startId){for(var t,i=0;i<this.container.numChildren;i++){var o=this.container.getChildAt(i);o.answer&&Global.hitTest(e,o)&&("answer"===o.answer&&o.id!==e.id&&o.restPosition(),"zone"===o.answer&&(t=o))}t?e.rightPosition(t.x+(t.width-e.width)/2,t.y+(t.height-e.height)/2):e.restPosition(),ZipUtils.single.getSound("click_mp3").play(0,1)}},t.prototype.onMoveDone=function(e,t){t.enabled=!1},t}(BaseQuiz);__reflect(SupersortQuiz.prototype,"SupersortQuiz");var ScorePage=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onShowDone=function(){e.prototype.onShowDone.call(this)},t.prototype.init=function(){e.prototype.init.call(this)},t}(ViewBase);__reflect(ScorePage.prototype,"ScorePage");var GlobalData;!function(e){e.myName="dily"}(GlobalData||(GlobalData={}));var CoursewareNotify=function(){function e(){}return e.GET_RECORD_LIST="GET_RECORD_LIST",e.SHARE_ENTER_BOOK="SHARE_ENTER_BOOK",e.UPLOAD_RECORD_ITEM="UPLOAD_RECORD_ITEM",e.UPLOAD_RECORD_SCORE="UPLOAD_RECORD_SCORE",e.GET_COURSEWARE_INFO="GET_COURSEWARE_INFO",e.GET_PERMISSION_INFO="GET_PERMISSION_INFO",e.GET_COURSEWARE_DATA="GET_COURSEWARE_DATA",e.JUMP_PAGE="JUMP_PAGE",e.STOPRECORD="STOPRECORD",e.SETTOTALSTAR="SETTOTALSTAR",e.SHOWTOPTHREE="SHOWTOPTHREE",e.CHANGE_RECORD_STATE="CHANGE_RECORD_STATE",e.GETVOLUME="GETVOLUME",e.SENDCLASSESSTUDENTS="SENDCLASSESSTUDENTS",e.ENTER_PICTRUE_BOOK="ENTER_PICTRUE_BOOK",e.SENDCLASSSSTUDENTSSCORE="SENDCLASSSSTUDENTSSCORE",e.MUTE_SOUND="MUTE_SOUND",e.SWAP_PAGE="SWAP_PAGE",e.PLAY_SWAP_EFFECT="PLAY_SWAP_EFFECT",e.SEND_TOTAL_SCORE="SEND_TOTAL_SCORE",e.SHOW_COVER="SHOW_COVER",e.SHOW_SCORE_PAGE="SHOW_SCORE_PAGE",e.CLICK_ELEMENT="CLICK_ELEMENT",e.CHANGE_QUIZ_STATE="CHANGE_QUIZ_STATE",e.TIMER_DOWN="TIMER_DOWN",e.GET_RANK="GET_RANK",e.ADD_STARS="ADD_STARS",e.SOUND_COMPELETE="SOUND_COMPELETE",e.STOP_RECORD="STOP_RECORD",e.CANCEL_RECORD="CANCEL_RECORD",e.RESULT_STARS="RESULT_STARS",e.SET_READ_MODEL="READ_MODEL",e.AUTO_RECORD="AUTO_RECORD",e.PLAY_SAMPLE_SOUND="PLAY_SAMPLE_SOUND",e.SHOW_MY_WORKS="showMyWorks",e.HIDE_MY_WORKS="hideMyWorks",e.GET_RECORD="getRecord",e.SHOW_TOOL_BAR="showToolBar",e.GET_MY_WORKS="getMyWorks",e.GET_RANK_LIST="getRankList",e.START_READ="startRead",e.CLOSE_QUIZ="closeQuiz",e.RANK_BACK_COVER="rankBackCover",e.START_MY_RECORD="START_MY_RECORD",e.SHOW_NEXT="SHOW_NEXT",e.SHOW_SHADOW="SHOW_SHADOW",e.HIDE_SHADOW="HIDE_SHADOW",e.HIDE_COVER="HIDE_COVER",e.TEXT_LIGHT="TEXT_LIGHT",e.TEXT_RECOVER="TEXT_RECOVER",e.NEXT_PAGE="NEXT_PAGE",e}();__reflect(CoursewareNotify.prototype,"CoursewareNotify");var SysNotify=function(){function e(){}return e.CONNECT_SERVER_SUCCESS="CONNECT_SERVER_SUCCESS",e.SERVER_BACK_DATA="SERVER_BACK_DATA",e}();__reflect(SysNotify.prototype,"SysNotify");var game;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.getInstance=function(){return null==this.instance&&(this.instance=new i),this.instance},i.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(i.STARTUP,e.StartupCommand),new egret.Sound},i.prototype.startUp=function(e){this.sendNotification(i.STARTUP,e),this.removeCommand(i.STARTUP)},i.STARTUP="startup",i}(puremvc.Facade);e.AppFacade=t,__reflect(t.prototype,"game.AppFacade",["puremvc.IFacade","puremvc.INotifier"])}(game||(game={}));var game;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){},t}(puremvc.SimpleCommand);e.ControllerPrepCommand=t,__reflect(t.prototype,"game.ControllerPrepCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={}));var game;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){this.facade.registerProxy(new CoursewareProxy),this.facade.registerProxy(new RecordProxy),this.facade.registerProxy(new WorksProxy)},t}(puremvc.SimpleCommand);e.ModelPrepCommand=t,__reflect(t.prototype,"game.ModelPrepCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={}));var game;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.prototype.initializeMacroCommand=function(){this.addSubCommand(e.ControllerPrepCommand),this.addSubCommand(e.ModelPrepCommand),this.addSubCommand(e.ViewPrepCommand)},i}(puremvc.MacroCommand);e.StartupCommand=t,__reflect(t.prototype,"game.StartupCommand")}(game||(game={}));var game;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){this.facade.registerMediator(new CoverMediator),this.facade.registerMediator(new QuizMediator),this.facade.registerMediator(new EffectLayerMediator),this.facade.registerMediator(new UserLayerMediator),this.facade.registerMediator(new RecordBarMediator),this.facade.registerMediator(new MyWorksMediator),this.facade.registerMediator(new RankMediator),this.facade.registerMediator(new ToolBarMediator),this.facade.registerMediator(new MobileMediator)},t}(puremvc.SimpleCommand);e.ViewPrepCommand=t,__reflect(t.prototype,"game.ViewPrepCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={}));var MobileMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;return o.currentPageNum=0,o._needTips=!0,o.init(),o}return __extends(t,e),t.prototype.setBgVisible=function(){var e=(document.body.clientWidth/document.body.clientHeight).toFixed(1);console.log(e),"1.8"===e||"0.71">e?this.bg.visible=!1:this.bg.visible=!0},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,r,n,s,a,h,c,l,u,d,g,p;return __generator(this,function(f){switch(f.label){case 0:return e=game.AppFacade.getInstance(),this.bg=new egret.Bitmap(RES.getRes("read_bg_png")),t=this.bg,i=GameConfig.curWidth(),o=GameConfig.curHeight(),r=1,r=o/t.height,t.width*r<i&&(r=i/t.width),this.bg.scaleX=this.bg.scaleY=r,this.bg.x=(GameConfig.curWidth()-this.bg.width*r)/2-2,this.bg.y=(GameConfig.curHeight()-this.bg.height*r)/2,n=new egret.Shape,n.graphics.beginFill(3432043),n.graphics.drawRect(0,0,i,o),n.graphics.endFill(),GameConfig.scale=r,console.log("scale",r),s=new eui.Image,s.source=RES.getRes("read_bg_phone_png"),s.width=GameConfig.curWidth(),s.height=GameConfig.curHeight(),GameLayerManager.gameLayer().backgroudLayer.addChildAt(n,0),GameLayerManager.gameLayer().backgroudLayer.addChildAt(this.bg,1),this.setBgVisible(),a=Global.searchToObject(window.location.search),h=window.dsBridge,c=this.getEnterFn(),[4,c(a.id)];case 1:return f.sent(),l=parseInt(a.srpg),1==l||2==l?[3,3]:(u=P.getCoursewareProxy().getCsInfo(),console.log("coursewareData ==== >>>>",u),u.text_desc?[4,P.getCoursewareProxy().getTextDes()]:[3,3]);case 2:f.sent(),d=P.getCoursewareProxy().textDes,g=P.getCoursewareProxy().getCourseWareData(),d.length!=g.length&&d.shift(),LightUtils.single.needDes=!0,f.label=3;case 3:return window.nextPage=this.nextPage.bind(this),window.lastPage=this.lastPage.bind(this),window.jumpPage=this.jumpPage.bind(this),window.enableAnswer=this.changeQuizState.bind(this,"enabled"),window.disabledAnswer=this.changeQuizState.bind(this,"disabled"),window.setTotalStar=this.setTotalStar.bind(this),window.getRank=this.getRank.bind(this),window.showTopThree=this.showTopThree.bind(this),h.register("jumpQuestion",window.jumpPage),h.register("enableAnswer",window.enableAnswer),h.register("disableAnswer",window.disabledAnswer),h.register("setTotalStar",window.setTotalStar),h.register("showTopThree",window.showTopThree),h.register("getVolume",function(t,i){e.sendNotification(CoursewareNotify.GETVOLUME,{tid:t,volume:i})}),h.register("sendClassStudents",function(t){t&&(console.log(CoursewareNotify.SENDCLASSESSTUDENTS,t),e.sendNotification(CoursewareNotify.SENDCLASSESSTUDENTS,JSON.parse(t)))}),h.register("sendStudentsScore",function(t){console.log(CoursewareNotify.SENDCLASSSSTUDENTSSCORE,JSON.parse(t)),e.sendNotification(CoursewareNotify.SENDCLASSSSTUDENTSSCORE,JSON.parse(t))}),this._audioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,GameConfig.isBack=!0,p=this,h.register("didEnterBackground",function(e){p.onLeave()}),h.register("didBecomeActive",function(e){p.onBack()}),h.register("pause",function(e){p.onPause()}),h.register("resume",function(e){p.onResume()}),[2]}})})},t.prototype.onLeave=function(){console.log("onleave"),GameConfig.isBack=!1,P.getRecordProxy().recording&&RecordUtils.single.cancel(),AudioPlayer.getInstance().stop(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.START_MY_RECORD),LightUtils.single.stop()},t.prototype.onTap=function(){GameConfig.curStage().removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),egret.CSWebAudioDecode.single.ctx&&egret.CSWebAudioDecode.single.ctx.resume()},t.prototype.onBack=function(){console.log("onback"),GameConfig.isBack=!0,egret.setTimeout(function(){egret.CSWebAudioDecode.single.ctx&&egret.CSWebAudioDecode.single.ctx.resume(),egret.web&&egret.web.WebAudioDecode&&egret.web.WebAudioDecode.ctx&&egret.web.WebAudioDecode.ctx.resume()},this,500)},t.prototype.onPause=function(){this.onLeave()},t.prototype.onResume=function(){this.onBack()},t.prototype.listNotificationInterests=function(){return[CoursewareNotify.ADD_STARS,CoursewareNotify.SET_READ_MODEL,CoursewareNotify.CANCEL_RECORD,CoursewareNotify.GET_RECORD]},t.prototype.handleNotification=function(e){var t=window.dsBridge,i=e.getBody();switch(e.getName()){case CoursewareNotify.CHANGE_QUIZ_STATE:break;case CoursewareNotify.ADD_STARS:console.log(CoursewareNotify.ADD_STARS,i),t.call("echo.uploadScore",{num:i,tid:this.currentPageNum,action:1});break;case CoursewareNotify.SET_READ_MODEL:break;case CoursewareNotify.CANCEL_RECORD:console.log("CoursewareNotify.CANCEL_RECORD"),t.hasNativeMethod("read.cancelRecord")?(console.log("read.cancelRecord"),t.call("read.cancelRecord","")):t.hasNativeMethod("read.stopRecord")&&(console.log("read.stopRecord"),t.call("read.stopRecord",""));break;case CoursewareNotify.GET_RECORD:GameConfig.fromRank=!1;"native"!=i.from;if(i&&i.from){GameConfig.isOthers=!0,GameConfig.fromRank="rank"==i.from,console.log("GameConfig.fromRank =="+GameConfig.fromRank)}console.log("GameConfig.nowUID",GameConfig.nowUID,"++++",i.uin),i.uin&&-1!=i.uin&&(GameConfig.nowUID=i.uin),console.log("data id ",i.id),this.getCoursewareData(i.id,i.uin?i.uin:-1)}},t.prototype.getCoursewareDataFromMobile=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;
return __generator(this,function(o){switch(o.label){case 0:return e=window.dsBridge,t=JSON.parse(e.call("read.readLoaded",{status:2,version:2})),console.log("coursewareInfo",t),t&&("ReadingA-Z"==t.type_name?t.type=1:"Highlights"==t.type_name?t.type=2:"励步启蒙"==t.type_name&&(t.type=3)),P.getCoursewareProxy().setCoursewareInfo(t),[4,P.getCoursewareProxy().getCourseWareDataAsync()];case 1:return i=o.sent(),window.totalPage=this.totalPage=i.length,this.getRecordList(t),[2]}})})},t.prototype.getCoursewareData=function(e,t){return void 0===t&&(t=-1),__awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return console.log("getCoursewareData",e),[4,P.getCoursewareProxy().getCoursewareInfo(e)];case 1:return t=o.sent(),[4,P.getCoursewareProxy().getCourseWareDataAsync()];case 2:return i=o.sent(),window.totalPage=this.totalPage=i.length,this.getRecordList(t),[2]}})})},t.prototype.getMyWorks=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._needTips=!1,game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_MY_WORKS,"fromNative"),[2]})})},t.prototype.getEnterFn=function(){var e=!1,t=window.dsBridge,i=Global.searchToObject(window.location.search),o=1!=i.srpg||e?t.call("read.shopGetUserInfo",{})?JSON.parse(t.call("read.shopGetUserInfo",{})):null:i;console.log("userInfoJson::::::",o),o&&(P.getCoursewareProxy().setUserInfo(o),P.getRecordProxy().setUserInfo(o),P.getMyWorksProxy().setUserInfo(o),GameConfig.userInfo=o,GameConfig.userId=parseInt(o.UID)),BackUtils.single.hideIcon(),t.call("read.pageLoaded",{hasNativeBar:!0,menuType:1,needHandleBack:!1,hasNativeBack:!1}),GameConfig.needAudio=!1;var r=parseInt(i.srpg);switch(r){case 1:return this.getCoursewareData.bind(this);case 2:return this.getMyWorks.bind(this);default:return GameConfig.needAudio=!0,e?this.getCoursewareData.bind(this):this.getCoursewareDataFromMobile.bind(this)}},t.prototype.getRecordList=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n,s,a;return __generator(this,function(h){switch(h.label){case 0:return console.log("coursewareInfo:::",e),t=window.dsBridge,i=Global.searchToObject(window.location.search),[4,P.getRecordProxy().getRecordListAsync(e.id,GameConfig.nowUID)];case 1:return h.sent(),GameConfig.isSrpg()?(game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHARE_ENTER_BOOK,"read"),[2]):(game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_COVER,e),t.call("read.readLoaded",{status:1,version:2}),o="4.1.3",r=P.getRecordProxy().getRequestHeader().Version.split("|")[0],n=GameConfig.compareVersion(o,r),s=-1==n,s&&this._needTips&&TipsLayer.single.showTips(GameLayerManager.gameLayer().maskLayer,ShowType.TYPE_DOWNLOAD),this._needTips=!1,GameConfig.isOthers&&(a=game.AppFacade.getInstance(),a.sendNotification(CoursewareNotify.HIDE_MY_WORKS,{destory:!1}),RankLayer.single.hidePage()),EndingLayer.single.setVisible(!1),[2])}})})},t.prototype.showTopThree=function(e){void 0!==e&&(console.log(CoursewareNotify.SHOWTOPTHREE,JSON.parse(e)),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOWTOPTHREE,JSON.parse(e)))},t.prototype.changeQuizState=function(e){if(console.log(e,this.currentPageData.interactionType),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CHANGE_QUIZ_STATE,e),"enabled"===e){var t={};return t.type=this.currentPageData.interactionType,t.timeout=this.currentPageData.answerTime,"read"===this.currentPageData.interactionType&&(t.read_type="word",t.read_content=this.currentPageData.readTxt),t}},t.prototype.nextPage=function(){return this.currentPageNum===this.totalPage?null:this.jumpPage(this.currentPageNum+1)},t.prototype.lastPage=function(){1!==this.currentPageNum&&this.jumpPage(this.currentPageNum-1)},t.prototype.jumpPage=function(e){console.log("jumpPage",e);try{var t=P.getCoursewareProxy().getCourseWareData();return t&&(window.currentPageNum=this.currentPageNum=e,this.currentPageData=t[e-1],game.AppFacade.getInstance().sendNotification(CoursewareNotify.SWAP_PAGE,this.currentPageData)),this.currentPageNum}catch(i){console.log(i)}},t.prototype.getCoursewareTotalScore=function(e){if(e){var t=e.filter(function(e){return e.interactionType}).length;game.AppFacade.getInstance().sendNotification(CoursewareNotify.SEND_TOTAL_SCORE,t)}},t.prototype.preloadAssets=function(e){var t,i=this,o=[],r=new RegExp(/(https?:\/\/[^,]*\.(?:jpe?g|gif|png|mp3))/g),n=JSON.stringify(e);do t=r.exec(n),t&&o.push(t[1]);while(t);o.forEach(function(e){-1!==e.search("mp3")?RES.getResByUrl(e,function(){},i,RES.ResourceItem.TYPE_SOUND):RES.getResByUrl(""+e+Global.webpSuffix,function(){},i,RES.ResourceItem.TYPE_IMAGE)})},t.prototype.setTotalStar=function(e){console.log(CoursewareNotify.SETTOTALSTAR,e),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SETTOTALSTAR,e)},t.prototype.getRank=function(e){console.log(CoursewareNotify.GET_RANK),game.AppFacade.getInstance().sendNotification(CoursewareNotify.GET_RANK,e)},t.prototype.stopRecord=function(e){console.log(CoursewareNotify.STOP_RECORD,e);var t=JSON.parse(e?e:{}).score;game.AppFacade.getInstance().sendNotification(CoursewareNotify.STOPRECORD,t),game.AppFacade.getInstance().sendNotification(CoursewareNotify.ADD_STARS,t>79&&3||t>59&&2||1)},t.NAME="MobileCommond",t}(puremvc.Mediator);__reflect(MobileMediator.prototype,"MobileMediator",["puremvc.IMediator","puremvc.INotifier"]);var game;!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.register=function(){this.facade.registerCommand("Processor_100_1",t)},t.prototype.execute=function(e){var t=e.getBody(),i=Global.getMessage("user_login"),o=i.decode(t.buffer);console.log("反序列化数据：",o)},t.NAME="Processor_100_1",t}(puremvc.SimpleCommand);e.Processor_100_1=t,__reflect(t.prototype,"game.Processor_100_1",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={}));var P;!function(e){function t(){return game.AppFacade.getInstance().retrieveProxy(TemplateProxy.NAME)}function i(){return game.AppFacade.getInstance().retrieveProxy(GameProxy.NAME)}function o(){return game.AppFacade.getInstance().retrieveProxy(CoursewareProxy.NAME)}function r(){return game.AppFacade.getInstance().retrieveProxy(RecordProxy.NAME)}function n(){return game.AppFacade.getInstance().retrieveProxy(WorksProxy.NAME)}e.getTemplateDataProxy=t,e.getGameDataProxy=i,e.getCoursewareProxy=o,e.getRecordProxy=r,e.getMyWorksProxy=n}(P||(P={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function o(o){t.call(i,o,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?o(r):RES.getResAsync(e,o,this)}else ZipUtils.single.getSheet(e)?o(ZipUtils.single.getSheet(e)):RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ApiHttp;!function(e){var t="https://lmsvr-c.abctime-me.com",i="https://us.abctime-me.com/h5/playershare/read/index.html";t="https://test-lmsvr-c.abctime-me.com",i="https://test-us.abctime-me.com/h5/playershare/read/index.html",e.BaseUrl={recordUrl:t,srUrl:i}}(ApiHttp||(ApiHttp={}));var CoursewareProxy=function(e){function t(){var i=e.call(this,t.NAME)||this;return i.baseUrl=ApiHttp.BaseUrl.recordUrl,i}return __extends(t,e),t.prototype.setCoursewareInfo=function(e){this.coursewareInfo=e},t.prototype.getCoursewareInfo=function(e,t){return void 0===t&&(t=-1),__awaiter(this,void 0,void 0,function(){var i,o,r;return __generator(this,function(n){switch(n.label){case 0:return i=this,t=-1==t?parseInt(i.requestHeader.UID):t,console.log("getCoursewareInfo post ",e,"-----",t),o=GameConfig.isSrpg()?"/abctime/public/read/audio/get":"/v4/abctime/app/h5/read/audio/get",[4,i.requestUrl({actionType:CoursewareNotify.GET_COURSEWARE_INFO,method:"POST",endpoint:i.baseUrl+o,params:{book_id:parseInt(e),uid:t},headers:i.requestHeader})];case 1:return r=n.sent(),i.coursewareInfo=r.data,[2,i.coursewareInfo]}})})},t.prototype.reqCoursewarePermissionInfo=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return t=this,t.permissionInfo?[3,2]:[4,t.requestUrl({actionType:CoursewareNotify.GET_PERMISSION_INFO,method:"GET",endpoint:t.baseUrl+"/abctime/app/v5/read/book/check",params:{book_type:e},headers:t.requestHeader})];case 1:i=o.sent(),t.permissionInfo={},i&&0==i.code?t.permissionInfo.avaliable=!0:t.permissionInfo.avaliable=!1,o.label=2;case 2:return[2,t.permissionInfo]}})})},t.prototype.getCsInfo=function(){return this.coursewareInfo.pageNum=this.coursewareData.length,this.coursewareInfo},t.prototype.getCourseWareDataAsync=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return console.log("getCourseWareDataAsync"),[4,this.requestUrl({actionType:CoursewareNotify.GET_COURSEWARE_DATA,method:"GET",endpoint:this.coursewareInfo.aliyun_url})];case 1:return e=t.sent(),this.coursewareData=e,[2,this.coursewareData]}})})},t.prototype.getTextDes=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return console.log("getTextDes"),[4,this.requestUrl({actionType:CoursewareNotify.GET_COURSEWARE_DATA,method:"GET",endpoint:this.coursewareInfo.text_desc})];case 1:return e=t.sent(),this.textDes=e,[2,this.textDes]}})})},t.prototype.getCourseWareData=function(){return this.coursewareData},t.prototype.getPermissionInfo=function(){return this.permissionInfo},t.prototype.test=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.requestUrl({actionType:CoursewareNotify.GET_PERMISSION_INFO,method:"POST",endpoint:this.baseUrl+"/abctime/app/read/book/share/report",params:{book_id:171,type:1},headers:this.requestHeader})];case 1:return e=t.sent(),[2]}})})},t.NAME="CoursewareProxy",t}(ResourceProxyBase);__reflect(CoursewareProxy.prototype,"CoursewareProxy");var GameProxy=function(e){function t(){var i=e.call(this,t.NAME)||this;return i.vo=new GameVO,i}return __extends(t,e),t.prototype.getGameName=function(){return this.vo||(this.vo=new GameVO),this.vo.gameName},t.prototype.setGameName=function(e){this.vo||(this.vo=new GameVO),this.vo.gameName=e},t.NAME="GameProxy",t}(ResourceProxyBase);__reflect(GameProxy.prototype,"GameProxy");var RecordProxy=function(e){function t(){var i=e.call(this,t.NAME)||this;return i.recordList=[{id:"1233254122f",url:"http://www.baidu.com/aa.mp3"}],i.recordUrl=ApiHttp.BaseUrl.recordUrl,i.userInfo={},i._recording=!1,i.m_recodedBookNum=0,i}return __extends(t,e),Object.defineProperty(t.prototype,"recording",{get:function(){return this._recording},set:function(e){this._recording=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recodedBookNum",{get:function(){return this.m_recodedBookNum},enumerable:!0,configurable:!0}),t.prototype.setRecordItem=function(e,t){void 0===t&&(t="add");var i=this.recordList.filter(function(t){return e.page_id===t.page_id})[0];if(i){var o=this.recordList.indexOf(i);console.log(i,o,"set item"),this.recordList[o]=e}else this.recordList.push(e)},t.prototype.uploadRecordItem=function(e,t,i,o){return console.log(t,"page id"),this.requestUrl({actionType:CoursewareNotify.UPLOAD_RECORD_ITEM,method:"POST",endpoint:this.recordUrl+"/v4/abctime/app/h5/read/audio/report",params:{picture_book_id:parseInt(e),page_id:t,audio:i,score:o},headers:this.requestHeader})},t.prototype.getRecordListAsync=function(e,t){return void 0===e&&(e=null),__awaiter(this,void 0,void 0,function(){var i,o,r,n;return __generator(this,function(s){switch(s.label){case 0:return console.log("getRecordListAsync",e,t),i=this,t=t&&-1!=t?t:parseInt(i.requestHeader.UID),o=GameConfig.isSrpg()?"/abctime/public/read/audio/get":"/v4/abctime/app/h5/read/audio/get",[4,i.requestUrl({actionType:CoursewareNotify.GET_RECORD_LIST,method:"POST",endpoint:i.recordUrl+o,headers:i.requestHeader,params:{book_id:e,uid:t}})];case 1:return r=s.sent(),n=r.data,i.recordList=n.audios,i.m_recodedBookNum=n.audio_book_num,i.requestHeader.UID==t&&(i.userInfo={avatar:n.user_avatar,name:n.user_name,score:n.score},GameConfig.user={name:n.user_name,uid:t,avatar:n.user_avatar}),console.log("record list =======",i.recordList),[2,i.recordList]}})})},t.prototype.getRecordList=function(){return this.recordList},t.prototype.getUserInfo=function(){return this.userInfo.recordNum=this.recordList.length,this.userInfo},t.prototype.uploadRecordScore=function(e,t){return this.requestUrl({actionType:CoursewareNotify.UPLOAD_RECORD_SCORE,method:"POST",endpoint:this.recordUrl+"/v4/abctime/app/h5/read/book/audio/score",params:{picture_book_id:parseInt(e),score:t,score_flag:1},headers:this.requestHeader})},t.prototype.getRank=function(e,t){return this.requestUrl({actionType:CoursewareNotify.UPLOAD_RECORD_SCORE,method:"POST",endpoint:this.recordUrl+"/v4/abctime/app/h5/read/audio/rank/myrank",params:{uid:t,book_id:e},headers:this.requestHeader})},t.NAME="RecordProxy",t}(ResourceProxyBase);__reflect(RecordProxy.prototype,"RecordProxy");var TemplateProxy=function(e){function t(){return e.call(this,t.NAME)||this}return __extends(t,e),t.prototype.getGameData=function(){return this.getData()},t.NAME="template_json",t}(ResourceProxyBase);__reflect(TemplateProxy.prototype,"TemplateProxy");var WorksProxy=function(e){function t(){var i=e.call(this,t.NAME)||this;return i._rootUrl=ApiHttp.BaseUrl.recordUrl,i._works={},i._ranks={},i}return __extends(t,e),t.prototype.getMyWorks=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return t=this,console.log(t.requestHeader.UID),[4,t.requestUrl({actionType:CoursewareNotify.GET_MY_WORKS,method:"POST",endpoint:t._rootUrl+"/v4/abctime/app/h5/read/audio/all",headers:t.requestHeader,params:{level:e}})];case 1:return i=o.sent(),console.log(i),this._works[e-1]=i.data.books,GameConfig.user={name:i.data.user_name,uid:i.data.uid,avatar:i.data.user_avatar},[2,i]}})})},t.prototype.getRankList=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n,s;return __generator(this,function(a){switch(a.label){case 0:return t=this,[4,t.requestUrl({actionType:CoursewareNotify.GET_RANK_LIST,method:"POST",endpoint:t._rootUrl+"/v4/abctime/app/h5/read/audio/rank",headers:t.requestHeader,params:{book_id:e.id,uid:parseInt(t.requestHeader.UID)}})];case 1:for(i=a.sent(),this.curBook=e,o=i.data.rank_info_list,r=o.length,n=0;r>n;n++)if(s=o[n],s.uid==t.requestHeader.UID){this.curBook.score=s.score,this.curBook.rank=s.rank,s.rank>200&&o.splice(n,1);break}return o.length>200&&o.pop(),this._ranks[e.id]=o,[2,i]}})})},t.prototype.getWorksByLeval=function(e){return console.log(this._works),this._works[e]?this._works[e]:[]},t.prototype.getRankById=function(e){return console.log("ranks ",this._ranks),this._ranks[e]?this._ranks[e]:[]},t.NAME="WorksProxy",t}(ResourceProxyBase);__reflect(WorksProxy.prototype,"WorksProxy");var GameVO=function(){function e(){this.gameName="Eger pro"}return e}();__reflect(GameVO.prototype,"GameVO");var RecordVO=function(){function e(){}return e}();__reflect(RecordVO.prototype,"RecordVO");var GameLayerManager=function(e){function t(){var t=e.call(this)||this;return t.backgroudLayer=new eui.UILayer,t.quizLayer=new eui.UILayer,t.mainLayer=new eui.UILayer,t.panelLayer=new eui.UILayer,t.worksLayer=new eui.UILayer,t.toolLayer=new eui.UILayer,t.shareLayer=new eui.UILayer,t.effectLayer=new eui.UILayer,t.maskLayer=new eui.UILayer,t.endLayer=new eui.UILayer,t.loadLayer=new eui.UILayer,t.init(),t}return __extends(t,e),t.gameLayer=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.init=function(){this.touchThrough=!0,this.backgroudLayer.touchThrough=!0,this.quizLayer.touchThrough=!0,this.quizLayer.name="quizLayer",this.effectLayer.touchThrough=!0,this.mainLayer.touchThrough=!0,this.panelLayer.touchThrough=!0,this.maskLayer.touchThrough=!0,this.loadLayer.touchThrough=!0,this.worksLayer.touchThrough=!0,this.endLayer.touchThrough=!0,this.toolLayer.touchThrough=!0,this.shareLayer.touchThrough=!0,this.addChild(this.backgroudLayer),this.addChild(this.quizLayer),this.addChild(this.effectLayer),this.addChild(this.mainLayer),this.addChild(this.panelLayer),this.addChild(this.worksLayer),this.addChild(this.endLayer),this.addChild(this.toolLayer),this.addChild(this.maskLayer),this.addChild(this.loadLayer),this.addChild(this.shareLayer)},t}(eui.UILayer);__reflect(GameLayerManager.prototype,"GameLayerManager");var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,egret.ImageLoader.crossOrigin="anonymous",egret.lifecycle.addLifecycleListener(function(e){});var t=RES.getRes;RES.getRes=function(e){var i=t(e);return i?i:ZipUtils.single.getSheet(e)?(console.log("null with "+e),ZipUtils.single.getSheet(e)):null};var i=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",i),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.addChild(GameLayerManager.gameLayer()),RES.setMaxLoadingThread(6),this.runGame()},t.prototype.runGame=function(){var e=this;this.loadResource(function(){e.createGameScene(),RES.getResAsync("description_json"),RES.loadGroup("others")})},t.prototype.loadResource=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,15,,16]),[4,RES.loadConfig("default.res.json?v="+Date.now(),"resource/")];case 1:return o.sent(),[4,this.loadTheme()];case 2:return o.sent(),[4,RES.loadGroup("sound_zip")];case 3:return o.sent(),[4,ZipUtils.single.loadZip("sound_cbz","sound")];case 4:return o.sent(),[4,RES.loadGroup("db_zip")];case 5:return o.sent(),[4,ZipUtils.single.loadZip("db_cbz","db")];case 6:return o.sent(),[4,RES.loadGroup("sheet_zip")];case 7:return o.sent(),[4,ZipUtils.single.loadZip("sheet_cbz","sheet")];case 8:return o.sent(),Global.searchToObject(location.search).srpg?[4,RES.loadGroup("loading")]:[3,12];case 9:return o.sent(),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadGroup("preload",0,t)];case 10:return o.sent(),[4,Global.delay(3e3)];case 11:return o.sent(),this.stage.removeChild(t),[3,14];case 12:return[4,RES.loadGroup("preload")];case 13:o.sent(),o.label=14;case 14:return e(),[3,16];case 15:return i=o.sent(),console.error(i),[3,16];case 16:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){Global.initSys();var e=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;if(e)try{egret.CSWebAudioDecode.single.ctx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)}catch(t){e=!1}game.AppFacade.getInstance().startUp(GameLayerManager.gameLayer())},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ComboBox=function(e){function t(t,i){var o=e.call(this)||this;return o._isDown=!1,o._renderer=i,o.addEventListener(egret.Event.ADDED_TO_STAGE,o.onShow,o),o.skinName=t,o}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init()},t.prototype.onShow=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onShow,this),this.updata()},t.prototype.updata=function(){this._isDown&&this.onBtnTap(null)},t.prototype.setData=function(e){this._ls.dataProvider=new eui.ArrayCollection(e),this.selectIndex(0)},t.prototype.init=function(){var e=this._sl,t=this._ls;e.viewport=t,e.bounces=!1,e.verticalScrollBar=null,e.horizontalScrollBar=null,e.scrollPolicyH=eui.ScrollPolicy.OFF,t.itemRenderer=this._renderer,t.useVirtualLayout=!1;var i=this._mask;i.visible=!0,this._content.mask=this._mask,i.y=-i.height+this._btn.height,this._isDown=!0,this.onBtnTap(null)},t.prototype.setRoundUp=function(){this._roundImg&&(this._roundImg.rotation=0)},t.prototype.setRoundDown=function(){this._roundImg&&(this._roundImg.rotation=180)},t.prototype.onBtnTap=function(e){this._isDown?this.up():this.down(),this._isDown=!this._isDown},t.prototype.down=function(){var e=this;this._sl.viewport.scrollV=0,this.setRoundDown(),this.touchEnabled=!0,egret.Tween.removeTweens(this._mask),egret.Tween.get(this._mask).to({y:0},200).call(function(){e.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onStageTouch,e)},this)},t.prototype.up=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this),this.setRoundUp(),this.touchEnabled=!1,egret.Tween.removeTweens(this._mask);var e=-this._mask.height+this._btn.height;egret.Tween.get(this._mask).to({y:e},200)},t.prototype.onStageTouch=function(e){this.contains(e.target)||this.onBtnTap(null)},t.prototype.onItemTap=function(e){for(var t=this._ls,i=0,o=t.numChildren,r=0;o>r;r++){var n=t.getElementAt(r);n.setSelect(!1),r==t.selectedIndex&&(i=r,n.setSelect(!0))}this.selectIndex(i)},t.prototype.selectIndex=function(e){this._ls.selectedIndex=e,this._titleTxt.text=this._ls.selectedItem,this._isDown&&this.onBtnTap(null);var i=new egret.Event(t.COMBOBOX_SELECT);i.data={index:e,item:this._ls.selectedItem},this.dispatchEvent(i)},t.prototype.onHide=function(){this.destory()},t.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onHide,this),this._btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),this._ls.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},t.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onHide,this),this._btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnTap,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStageTouch,this),this._ls.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},t.prototype.destory=function(){console.log("destory cd")},t.COMBOBOX_SELECT="comboboxSelect",t}(eui.Component);__reflect(ComboBox.prototype,"ComboBox");var ScrollTab=function(e){function t(t,i,o,r){var n=e.call(this)||this;return n._scroll=!1,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAdd,n),n.init(t,i,o,r),n}return __extends(t,e),t.prototype.onAdd=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAdd,this)},t.prototype.onTouchBegin=function(e){this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0,1e4),this._startX=e.stageX},t.prototype.onTouchEnd=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this,!0);var t=e.stageX,i=t-this._startX,o=0;if(Math.abs(i)>150){var r=i>0?-1:1;o=this._curIndex+r}else this.index=this._curIndex;this._data&&0>o||o>=this._data.length||(e.stopPropagation(),this.index=o)},t.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this,!0,1e4)},t.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.touchEnabled=!1,this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage&&this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.onRemove=function(){},t.prototype.selectItem=function(){return this._data[this._curIndex]},t.prototype.init=function(e,t,i,o){this._sl=e,this._ls=t,this.addChild(e),this.addChild(t),this._pointStyle=i,this._pointStyleSelect=o,this._pointContainer=new eui.Group;var r=this._pointContainer;this.width=e.width,this.height=e.height,this.x=e.x,this.y=e.y,e.x=t.x=e.y=t.y=0,e.viewport=t,e.touchEnabled=!1,e.enabled=!1,r.width=100;var n=new eui.TileLayout;r.layout=n,r.y=this.height,this.addChild(this._pointContainer)},t.prototype.updata=function(e){this._data=e,this._ls.dataProvider=new eui.ArrayCollection(e),this._ls.validateNow(),this._pointContainer.removeChildren(),this._points=[];for(var t=e.length,i=0;t>i;i++){var o=new eui.Image;o.source=this._pointStyle,this._pointContainer.addChild(o),this._points.push(o)}this._pointContainer.visible=this._points.length>1,this._pointContainer.x=(this.width-this._pointContainer.width)/2,this.index=0},Object.defineProperty(t.prototype,"index",{get:function(){return this._curIndex},set:function(e){var t=this;if(!this._scroll&&!(0>e||e>=this._data.length)){this._scroll=!0,this._curIndex=e;for(var i=this._points,o=i.length,r=0;o>r;r++){var n=i[r];n.source=this._pointStyle,r==e&&(n.source=this._pointStyleSelect)}var s=this._sl.viewport;egret.Tween.removeTweens(s),egret.Tween.get(s).to({scrollH:e*this.width},600).call(function(){t._scroll=!1,egret.Tween.removeTweens(s)},this)}},enumerable:!0,configurable:!0}),t.prototype.getCurNode=function(){return this._ls.getChildAt(this._curIndex)},t}(egret.DisplayObjectContainer);__reflect(ScrollTab.prototype,"ScrollTab");var Progress=function(e){function t(){var t=e.call(this)||this;return t.blockNum=3.6,t.init(),t}return __extends(t,e),t.prototype.init=function(){this["with"]=this.height=122,this.addChild(new egret.Bitmap(RES.getRes("read_record_json.read_trail"))),this.bgImg=new egret.Bitmap(RES.getRes("read_record_json.read_load")),this.addChild(this.bgImg),this.txt=new egret.TextField,this.txt.textColor=4496127,this.txt.width=122,this.txt.textAlign="center",this.txt.y=50,this.txt.size=28,this.addChild(this.txt),this.maskShape=new egret.Shape,this.maskShape.graphics.beginFill(16711680),this.maskShape.x=this.maskShape.y=61,this.addChild(this.maskShape),this.bgImg.mask=this.maskShape,this.visible=!1},t.prototype.setProgress=function(e){this.visible=!(100==e),this.txt.text=e+"%",this.drawSector(this.maskShape,61,270,Math.floor(e*this.blockNum))},t.prototype.drawSector=function(e,t,i,o,r){void 0===t&&(t=100),void 0===i&&(i=0),void 0===o&&(o=360),void 0===r&&(r=16711680);var n=0,s=0;e.graphics.beginFill(r),e.graphics.moveTo(n,s),o=Math.abs(o)>360?360:o;var a=Math.ceil(Math.abs(o)/45),h=o/a;h=h*Math.PI/180,i=i*Math.PI/180,e.graphics.lineTo(n+t*Math.cos(i),s+t*Math.sin(i));for(var c=1;a>=c;c++){i+=h;var l=i-h/2,u=n+t/Math.cos(h/2)*Math.cos(l),d=s+t/Math.cos(h/2)*Math.sin(l),g=n+t*Math.cos(i),p=s+t*Math.sin(i);e.graphics.curveTo(u,d,g,p)}360!=o&&e.graphics.lineTo(n,s),e.graphics.endFill()},t}(egret.DisplayObjectContainer);__reflect(Progress.prototype,"Progress");var AnimateActionOption=function(e){function t(){var t=e.call(this)||this;return t.getPlayShakeAnimateFunc=function(){var e=this.x;this.y;return function(t){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(o){switch(o.label){case 0:return this.enabled=!1,[4,new Promise(function(t){egret.Tween.get(i).to({x:e+10},100*i.animateData.duration,egret.Ease.cubicInOut).call(t)})];case 1:return o.sent(),[4,new Promise(function(t){egret.Tween.get(i).to({x:e-10},100*i.animateData.duration,egret.Ease.cubicInOut).call(t)})];case 2:return o.sent(),t--,t>0?this.playShakeAnimate(t):(egret.Tween.get(this).to({x:e},100*this.animateData.duration,egret.Ease.cubicInOut),this.enabled=!0),[2]}})})}},t}return __extends(t,e),t.prototype.setAnimateData=function(e){this.animateData=e},t.prototype.onClickHandler=function(){"scale"===this.animateData.name?this.playScaleAnimate(this.animateData.times):"shake"===this.animateData.name&&this.playShakeAnimate(this.animateData.times)},t.prototype.playScaleAnimate=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.scaleX,i=this.scaleY,this.enabled=!1,[4,new Promise(function(e){egret.Tween.get(o).to({scaleX:.5,scaleY:.5*i},100*o.animateData.duration,egret.Ease.cubicInOut).call(e)})];case 1:return r.sent(),[4,new Promise(function(e){egret.Tween.get(o).to({scaleX:1*t,scaleY:1*i},100*o.animateData.duration,egret.Ease.cubicInOut).call(e)})];case 2:return r.sent(),e--,e>0?this.playScaleAnimate(e):this.enabled=!0,[2]}})})},t.prototype.compelete=function(){e.prototype.compelete.call(this),Global.setCenterPoint(this),this.playShakeAnimate=this.getPlayShakeAnimateFunc()},t}(ActionOption);__reflect(AnimateActionOption.prototype,"AnimateActionOption");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,o){function r(e){t.call(o,e)}function n(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(o))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var a=e.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(o,generateJSON.paths[e])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var BaseMoveOption=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.setChild=function(t){e.prototype.setChild.call(this,t),this.originX=this.x,this.originY=this.y,this.elementContainer.addChild(t)},t.prototype.onClickHandler=function(){},t.prototype.compelete=function(){e.prototype.compelete.call(this),"answer"===this.answer&&(this.currentState="lock",this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.startMove,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.stopMove,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.stopMove,this))},t.prototype.showAnswer=function(t,i){return void 0===i&&(i=function(){}),__awaiter(this,void 0,void 0,function(){return __generator(this,function(o){switch(o.label){case 0:return this.activeBorder.source=t?RES.getRes("right"):RES.getRes("error"),this.activeBorder.left=-2,this.activeBorder.top=-6,this.activeBorder.width=this.width+2,[4,e.prototype.showAnswer.call(this,t,i)];case 1:return o.sent(),[2]}})})},t.prototype.rightPosition=function(e,t){egret.Tween.get(this).to({x:e,y:t},300,egret.Ease.cubicOut)},t.prototype.restPosition=function(e){void 0===e&&(e=function(){}),egret.Tween.get(this).to({x:this.originX,y:this.originY},300,egret.Ease.cubicOut).call(e)},t.prototype.startMove=function(e){this.offsetX=e.stageX-this.x,this.offsetY=e.stageY-this.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.startMoveCallBack(this.id)},t.prototype.stopMove=function(e){this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),this.stopMoveCallBack(this)},t.prototype.onMove=function(e){this.x=e.stageX-this.offsetX,this.y=e.stageY-this.offsetY},t}(BaseOption);__reflect(BaseMoveOption.prototype,"BaseMoveOption");var VersionController=function(){function e(){var e=this;this.resourceRoot="resource/",this.versionPath="assets/",this.versionPath1="sound/",this.versionConfigPath="resource/version.json",this.currentVersion="1.0.7",this.versionCacheWxgame=function(){var t=egret.localStorage.getItem("resVersion");
if(t!=e.currentVersion){egret.localStorage.setItem("resVersion",e.currentVersion),console.log("版本更新");var i=wx.getFileSystemManager(),o=wx.env.USER_DATA_PATH+"/cache_crc32/assets";i.readdir({dirPath:o,success:function(t){for(var r=e.getRemoveList(t.files),n=r.length,s=0;n>s;++s)console.log("删除",o+"/"+r[s]),i.unlinkSync(o+"/"+r[s])},fail:function(e){}})}},this.versionCacheWeb=function(){var t=egret.localStorage.getItem("resVersion");t!=e.currentVersion&&(egret.localStorage.setItem("resVersion",e.currentVersion),console.log("Web版本更新"))}}return e.prototype.init=function(){var e=this;return new Promise(function(t,i){var o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(e.versionConfigPath+("?v="+Date.now()),egret.HttpMethod.GET),o.send(),o.addEventListener(egret.Event.COMPLETE,function(i){var o=i.currentTarget;e.versionConfig=JSON.parse(o.response),egret.Capabilities.runtimeType==egret.RuntimeType.WXGAME?e.versionCacheWxgame():egret.Capabilities.runtimeType==egret.RuntimeType.WEB&&e.versionCacheWeb(),t()},e),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(){egret.log("post error : "+event),i()},e)})},e.prototype.getRemoveList=function(e){var t=[],i="";for(var o in this.versionConfig)i+=this.versionConfig[o]+",";for(var r=e.length,n=0;r>n;++n){var s=e[n],a=s.slice(0,s.indexOf("."));-1==i.indexOf(a)&&t.push(s)}return t},e.prototype.getVirtualUrl=function(e){return this.getResUrlByVersion(e)},e.prototype.getResUrlByVersion=function(e){if(-1==e.indexOf(this.resourceRoot))return e;if(e=e.replace(this.resourceRoot,""),this.versionConfig){var t=e.replace(this.versionPath1,"");if(this.versionConfig&&this.versionConfig[t]){var i=this.versionConfig[t],o=e.slice(e.lastIndexOf("."));e=this.versionPath1+i+o}var r=e.replace(this.versionPath,"");if(this.versionConfig&&this.versionConfig[r]){var i=this.versionConfig[r],o=e.slice(e.lastIndexOf("."));e=this.versionPath+i+o}}return e=this.resourceRoot+e},e}();__reflect(VersionController.prototype,"VersionController",["RES.IVersionController"]),RES.registerVersionController(new VersionController);var WaitPanel=function(e){function t(t){void 0===t&&(t=1);var i=e.call(this)||this;return i.bg=new egret.Sprite,i.w=0,i.h=0,i.createView(),i}return __extends(t,e),t.prototype.createView=function(){this.w=egret.MainContext.instance.stage.stageWidth,this.h=egret.MainContext.instance.stage.stageHeight,this.bg.graphics.beginFill(0,.2),this.bg.graphics.drawRect(0,0,this.w,this.h),this.bg.graphics.endFill(),this.bg.width=this.w,this.bg.height=this.h,this.addChild(this.bg),this.touchEnabled=!0,this.waitImg=new egret.Bitmap,this.waitImg.texture=RES.getRes("loadingCircle_png"),this.addChild(this.waitImg),this.waitImg.x=this.w/2,this.waitImg.y=this.h/2,this.waitImg.anchorOffsetX=this.waitImg.width/2,this.waitImg.anchorOffsetY=this.waitImg.height/2,EffectUtils.rotationEffect(this.waitImg,1e3)},t}(egret.Sprite);__reflect(WaitPanel.prototype,"WaitPanel");var ChoiceOption=function(e){function t(){var t=e.call(this)||this;return t._checked=!1,t.addEventListener(eui.UIEvent.COMPLETE,function(){},t),t}return __extends(t,e),t.prototype.zoomOption=function(e){egret.Tween.get(this).to({scaleX:e,scaleY:e},100)},Object.defineProperty(t.prototype,"checked",{get:function(){return this._checked},set:function(e){this._checked=this.activeBorder.visible=e,this.zoomOption(e?1.05:1)},enumerable:!0,configurable:!0}),t}(BaseClickOption);__reflect(ChoiceOption.prototype,"ChoiceOption");var ChoiceQuiz=function(e){function t(t){var i=e.call(this,t)||this;return i.answerRightNum=0,i.firstChoice=!0,i.clickNum=0,i.optionSkinUrl="resource/ui/courseware/ChoiceOptionSkin.exml",i.enabled=!1,i}return __extends(t,e),t.prototype.getScore=function(){this.enabled=!1;for(var e=0;e<this.container.numChildren;e++){var t=this.container.getChildAt(e);t instanceof ChoiceOption&&t.checked&&(t.answer===!0?this.answerRightNum++:this.answerRightNum--,t.showAnswer(t.answer))}return this.rightAnswerNum===this.answerRightNum?1:0},t.prototype.changeState=function(t){e.prototype.changeState.call(this,t),"enabled"===t&&(this.enabled=!0),"disabled"===t&&(this.enabled=!1),this.options.forEach(function(e){"disabled"===t?e.currentState=e.answer===!0?"right":"error":e.currentState=t})},t.prototype.getOptionBtn=function(e){var t=new ChoiceOption;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOptionClick,this),t},t.prototype.onOptionClick=function(e){var t=e.currentTarget;this.clickNum++,1===this.rightAnswerNum?this.optionSelect.call(this,t):(t.checked=!t.checked,this.firstChoice&&(this.firstChoice=!1,setTimeout(function(){this.clickNum<2&&this.moveOptions(t)}.bind(this),1e3)))},t.prototype.optionSelect=function(e){for(var t=0;t<this.container.numChildren;t++){var i=this.container.getChildAt(t);i instanceof ChoiceOption&&(i.checked=i.id===e.id?!0:!1)}},t.prototype.moveOptions=function(e){},t.prototype.judgeQuiz=function(e){},t}(BaseQuiz);__reflect(ChoiceQuiz.prototype,"ChoiceQuiz");var MatchQuiz=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.onMoveDone=function(e,t){t.enabled=!1,t.scaleX=t.scaleY=.8},t}(SupersortQuiz);__reflect(MatchQuiz.prototype,"MatchQuiz");var PollOption=function(e){function t(){var t=e.call(this)||this;return t.checked=!1,t.disabledAnimate=!1,t.leveWidth=0,t.progressNum=0,t}return __extends(t,e),t.prototype.setProgressLeveWidth=function(e){0===this.leveWidth&&(this.leveWidth=Math.floor(100/e))},t.prototype.setProgress=function(e){e&&(this.progressNum=e,this.label.text=this.progressNum.toString(),this.progressmask.percentWidth=this.progressNum*this.leveWidth)},t.prototype.compelete=function(){e.prototype.compelete.call(this),this.progress.mask=this.progressmask,this.label.text=""},t.prototype.onClickHandler=function(){var t=this;e.prototype.onClickHandler.call(this),this.add.x=(this.width-86)/2,this.add.y=(this.height-66)/2,this.add.visible=!0,egret.Tween.get(this.add).to({y:this.add.y-40},1800,egret.Ease.cubicIn).call(function(){t.add.visible=!1})},t}(BaseClickOption);__reflect(PollOption.prototype,"PollOption");var PollQuiz=function(e){function t(t){var i=e.call(this,t)||this;return i.isAnswerd=!1,i.optionSkinUrl="resource/ui/courseware/PollOptionSkin.exml",i.enabled=!1,i}return __extends(t,e),t.prototype.getScore=function(){return this.isAnswerd?3:0},t.prototype.getOptionBtn=function(e){var t=new PollOption;return t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOptionClick,this),t},t.prototype.changeState=function(t){e.prototype.changeState.call(this,t),"enabled"===t&&(this.enabled=!0,this.interval=setInterval(this.updatePollData.bind(this),2e3)),"disabled"===t&&(this.enabled=!1,clearInterval(this.interval)),this.options.forEach(function(e){"compelete"===t||"disabled"===t||(e.currentState=t)})},t.prototype.getPollNames=function(){if(void 0!==this.namesStr)return this.namesStr;for(var e=[],t=0;t<this.container.numChildren;t++){var i=this.container.getChildAt(t);i instanceof PollOption&&e.push(i.name)}return this.namesStr=e.join(","),this.namesStr},t.prototype.updatePollData=function(){var e=window.dsBridge;e.call("echo.getVoteData",{tid:window.currentPageNum,items:this.getPollNames()},function(e){console.log("echo.getVoteData",JSON.parse(e)),e=JSON.parse(e);for(var t=0;t<this.container.numChildren;t++){var i=this.container.getChildAt(t);if(i instanceof PollOption){if(!e.person_num)return;i.setProgressLeveWidth(e.person_num),i.setProgress(e.options[i.name])}}}.bind(this))},t.prototype.setPollProgress=function(){},t.prototype.onOptionClick=function(e){var t=e.currentTarget;this.enabled=!1,this.isAnswerd=!0;var i=window.dsBridge;i.call("echo.putVoteData",{item:t.name,tid:window.currentPageNum,action:1},function(e){console.log("echo.putVoteData",e)})},t}(BaseQuiz);__reflect(PollQuiz.prototype,"PollQuiz");var ReadQuiz=function(e){function t(t){var i=e.call(this,t)||this;return i.enabled=!1,i}return __extends(t,e),t.prototype.getScore=function(){return 0},t.prototype.setVolume=function(e){if(this.phone){var t=Math.round(e/3);this.phone.gotoAndPlay(t+4)}},t.prototype.changeState=function(e){this.currentState=e,"enabled"===e?this.enablelPhone():"disabled"===e&&this.disablePhone()},t.prototype.disablePhone=function(){egret.Tween.get(this.phone).to({y:290,alpha:.3},500)},t.prototype.enablelPhone=function(){var e=this;egret.Tween.get(this.phone).to({y:-80,alpha:1},200).wait(300).call(function(){e.phone.play(),e.phone.addEventListener(egret.Event.ENTER_FRAME,e.onPhoneEnterFrameHandler,e)})},t.prototype.onPhoneEnterFrameHandler=function(e){4===e.target.currentFrame&&(this.phone.stop(),this.phone.removeEventListener(egret.Event.ENTER_FRAME,this.onPhoneEnterFrameHandler,this))},t}(BaseQuiz);__reflect(ReadQuiz.prototype,"ReadQuiz");var SceneOption=function(e){function t(){var t=e.call(this)||this;return t._checked=!1,t.filterColor="",t}return __extends(t,e),t.prototype.playActivebleAnimation=function(){egret.Tween.get(this,{loop:!1,onChange:function(){},onChangeObj:this}).to({scaleX:.8,scaleY:.8},300).to({scaleX:1,scaleY:1},200).to({scaleX:.8,scaleY:.8},300).to({scaleX:1,scaleY:1},200)},Object.defineProperty(t.prototype,"checked",{get:function(){return this._checked},set:function(e){if(this.filterColor){var t=this.elementContainer.getChildAt(0).filters[0];t.color=e?180223:this.filterColor}this._checked=e},enumerable:!0,configurable:!0}),t}(BaseClickOption);__reflect(SceneOption.prototype,"SceneOption");var SceneQuiz=function(e){function t(t){var i=e.call(this,t)||this;return i.answerRightNum=0,i.firstChoice=!0,i.optionSkinUrl="resource/ui/courseware/SceneOptionSkin.exml",i.enabled=!1,i}return __extends(t,e),t.prototype.getScore=function(){this.enabled=!1,setTimeout(this.changeState.bind(this,"compelete"),1e3);for(var e=0;e<this.container.numChildren;e++){var t=this.container.getChildAt(e);t instanceof SceneOption&&t.checked&&(t.answer===!0?this.answerRightNum++:this.answerRightNum--)}return this.rightAnswerNum===this.answerRightNum?3:0},t.prototype.changeState=function(t){e.prototype.changeState.call(this,t),"enabled"===t&&(this.moveOptions.call(this),this.enabled=!0),"disabled"===t&&(this.enabled=!1),this.options.forEach(function(e){"compelete"===t||"disabled"===t?e.currentState=e.answer===!0?"right":"error":e.currentState=t})},t.prototype.getOptionBtn=function(e){var t=new SceneOption;return t.filterColor=e.shadow&&e.shadow.color.replace(/#/,"0x"),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onOptionClick,this),t},t.prototype.onOptionClick=function(e){var t=e.currentTarget;1===this.rightAnswerNum?this.optionSelect.call(this,t):t.checked=!t.checked},t.prototype.optionSelect=function(e){for(var t=0;t<this.container.numChildren;t++){var i=this.container.getChildAt(t);i instanceof SceneOption&&(i.checked=i.id===e.id?!0:!1)}},t.prototype.moveOptions=function(e){this.options.forEach(function(e){return e.playActivebleAnimation()})},t.prototype.judgeQuiz=function(e){},t}(BaseQuiz);__reflect(SceneQuiz.prototype,"SceneQuiz");var GameConfig;!function(e){function t(){var e=window.navigator.userAgent.toLowerCase(),t=""+e.match(/MicroMessenger/i);return"null"==t?!1:"micromessenger"==t?!0:void 0}function i(){return document.body.clientHeight/document.body.clientWidth>1.32}function o(){var e=window.navigator.userAgent.toLowerCase();""+e.match(/MicroMessenger/i);return""+e.match(/windows nt/i)=="windows nt"?"windows":""+e.match(/iphone/i)=="iphone"?"ios":""+e.match(/android/i)=="android"?"android":""+e.match(/ipad/i)=="ipad"?"ipad":""+e.match(/linux/i)=="linux"?"linux":""+e.match(/mac/i)=="mac"?"mac":""+e.match(/ucbrower/i)=="ucbrower"?"ucbrower":void console.log("未知系统类型")}function r(){var e=window.navigator.userAgent.toLowerCase();return""+e.match(/micromessenger/i)=="micromessenger"?"micromessenger":""+e.match(/qzone/i)=="qzone"?"qzone":""+e.match(/weibo/i)=="weibo"?"weibo":""+e.match(/qq/i)=="qq"?"qq":""+e.match(/renren/i)=="renren"?"renren":""+e.match(/txmicroblog/i)=="txmicroblog"?"txmicroblog":""+e.match(/douban/i)=="douban"?"douban":"other"}function n(){return egret.MainContext.instance.stage}function s(){return egret.MainContext.instance.stage.stageWidth}function a(){return egret.MainContext.instance.stage.stageHeight}function h(e){if(void 0!=e){e=e.substr(1);var t=e.split("&"),i={},o=[];return t.map(function(e,t,r){o=e.split("="),void 0!=o[0]&&(i[o[0]]=decodeURIComponent(o[1]))}),i}}function c(e,t){e=e.replace(/\./g,""),t=t.replace(/\./g,"");var i=parseInt(e),o=parseInt(t);return isNaN(i)||isNaN(o)?-2:o>i?1:i==o?0:-1}e.isOnLine=navigator.onLine,e.TextColors={white:16777215,milkWhite:16511407,grayWhite:13547170,yellow:16776960,lightYellow:16765813,orangeYellow:16750848,red:15799040,green:58624,blue:1742039,grayBlue:3101047,purple:15284466,pink:16724016,black:3026221,golden:16766720},e.LabelFontSize={littleSize:12,middleSize:18,normalSize:24,bigSize:36},e.isWeiXin=t,e.isBigScreen=i,e.systemType=o,e.platformType=r,e.curStage=n,e.curWidth=s,e.curHeight=a,e.scale=1,e.searchToObject=h,e.isSrpg=function(){var e=h(location.search).srpg;return function(){return 1==e}}(),e.isOthers=!1,e.fromRank=!1,e.otherBook=!1,e.otherBookInfo=null,e.nowUID=-1,e.fromCover=!1,e.bf=null,e.formEnd=!1,e.formWork=!1,e.uploadEnd=!0,e.changePage=!1,e.soundPool={},e.needAudio=!1,e.readEnd=!1,e.recordEnd=!1,e.compareVersion=c}(GameConfig||(GameConfig={}));var WebVideo=function(e){function t(t){var i=e.call(this)||this;i._x=0,i._y=0,i._width=0,i._height=0,i._src="",i._scaleMode=egret.MainContext.instance.stage.scaleMode,i._iframeWrapper=null,i._iframe=null;var o=document.getElementById("StageDelegateDiv"),r=o.parentElement,n=document.getElementById("iframe-wrapper");n||(n=document.createElement("div"),n.style.display="none",n.attributes.style.value+="position:absolute;-webkit-overflow-scrolling: touch;overflow-y: scroll;",n.id="iframe-wrapper",o.appendChild(n)),i._iframeWrapper=n,i._iframeWrapper.style.display="none",i._iframeWrapper.style.opacity="1";var s=document.createElement("video"),a=(new Date).getTime();s.controls=!0,s.src=t,s.id="webview-iframe-"+a,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.opacity="1",s.style.display="none",i._iframeWrapper.appendChild(s),i._iframe=document.getElementById("webview-iframe-"+a);var h=i;i._iframe.onload=function(){h._iframeWrapper.style.opacity="1",h._iframe.style.opacity="1"},i._stageW=egret.MainContext.instance.stage.stageWidth,i._stageH=egret.MainContext.instance.stage.stageHeight,i._windowW=window.innerWidth,i._windowH=window.innerHeight,i._designH=parseInt(r.attributes["data-content-height"].value),i._designW=parseInt(r.attributes["data-content-width"].value);var c=egret.sys.screenAdapter.calculateStageSize(egret.MainContext.instance.stage.scaleMode,i._windowW,i._windowH,i._designW,i._designH);i._displayH=c.displayHeight,i._displayW=c.displayWidth,console.log("windowW:"+i._windowW),console.log("stageW:"+i._stageW),console.log("disPlayW:"+i._displayW),console.log("windowH:"+i._windowH),console.log("stageH:"+i._stageH),console.log("displayH:"+i._displayH);var l=window.getComputedStyle(o,null),u=l.getPropertyValue("-webkit-transform")||l.getPropertyValue("-moz-transform")||l.getPropertyValue("-ms-transform")||l.getPropertyValue("-o-transform")||l.getPropertyValue("transform")||"FAIL";console.log("Matrix: "+u);var d=u.split("(")[1].split(")")[0].split(","),g=parseFloat(d[0]),p=parseFloat(d[1]),f=(d[2],d[3],Math.sqrt(g*g+p*p));return i.canvasScale=f,i}return __extends(t,e),t.prototype.show=function(){this._iframe.style.display="block",this._iframeWrapper.style.display="block"},t.prototype.destroy=function(){this._iframe&&(this._iframeWrapper.style.display="none",this._iframeWrapper.removeChild(this._iframe))},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e;var t=e*this.scaleX/this._stageW*this._displayW/this.canvasScale;this._iframe.style.width=this._iframeWrapper.style.width=t+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e;var t=e*this.scaleY/this._stageH*this._displayH/this.canvasScale;this._iframe.style.height=this._iframeWrapper.style.height=t+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._iframeWrapper.style.left=e+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._iframeWrapper.style.top=this._y/this._stageH*this._displayH/this.canvasScale+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(WebVideo.prototype,"WebVideo");var WebView=function(e){function t(t){var i=e.call(this)||this;i._x=0,i._y=0,i._width=0,i._height=0,i._src="",i._scaleMode=egret.MainContext.instance.stage.scaleMode,i._iframeWrapper=null,i._iframe=null;var o=document.getElementById("StageDelegateDiv"),r=o.parentElement,n=document.getElementById("iframe-wrapper");n||(n=document.createElement("div"),n.style.display="none",n.attributes.style.value+="position:absolute;-webkit-overflow-scrolling: touch;overflow-y: scroll;",n.id="iframe-wrapper",o.appendChild(n)),i._iframeWrapper=n,i._iframeWrapper.style.display="none",i._iframeWrapper.style.opacity="0";var s=document.createElement("iframe"),a=(new Date).getTime();s.src=t,s.id="webview-iframe-"+a,s.name="webview-iframe-"+a,s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.opacity="0",s.style.display="none",s.frameBorder="0",s.border="0",i._iframeWrapper.appendChild(s),i._iframe=document.getElementById("webview-iframe-"+a);var h=i;i._iframe.onload=function(){h._iframeWrapper.style.opacity="1",h._iframe.style.opacity="1"},i._stageW=egret.MainContext.instance.stage.stageWidth,i._stageH=egret.MainContext.instance.stage.stageHeight,i._windowW=window.innerWidth,i._windowH=window.innerHeight,i._designH=parseInt(r.attributes["data-content-height"].value),i._designW=parseInt(r.attributes["data-content-width"].value);var c=egret.sys.screenAdapter.calculateStageSize(egret.MainContext.instance.stage.scaleMode,i._windowW,i._windowH,i._designW,i._designH);i._displayH=c.displayHeight,i._displayW=c.displayWidth,console.log("windowW:"+i._windowW),console.log("stageW:"+i._stageW),console.log("disPlayW:"+i._displayW),console.log("windowH:"+i._windowH),console.log("stageH:"+i._stageH),console.log("displayH:"+i._displayH);var l=window.getComputedStyle(o,null),u=l.getPropertyValue("-webkit-transform")||l.getPropertyValue("-moz-transform")||l.getPropertyValue("-ms-transform")||l.getPropertyValue("-o-transform")||l.getPropertyValue("transform")||"FAIL";console.log("Matrix: "+u);var d=u.split("(")[1].split(")")[0].split(","),g=parseFloat(d[0]),p=parseFloat(d[1]),f=(d[2],d[3],Math.sqrt(g*g+p*p));return i.canvasScale=f,i}return __extends(t,e),t.prototype.show=function(){this._iframe.style.display="block",this._iframeWrapper.style.display="block"},t.prototype.destroy=function(){this._iframe&&(this._iframeWrapper.style.display="none",this._iframeWrapper.removeChild(this._iframe))},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e;var t=e*this.scaleX/this._stageW*this._displayW/this.canvasScale;this._iframe.style.width=this._iframeWrapper.style.width=t+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e;var t=e*this.scaleY/this._stageH*this._displayH/this.canvasScale;this._iframe.style.height=this._iframeWrapper.style.height=t+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._iframeWrapper.style.left=e+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._iframeWrapper.style.top=this._y/this._stageH*this._displayH/this.canvasScale+"px"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(WebView.prototype,"WebView");var QuizMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;return o.panelCon=GameLayerManager.gameLayer().quizLayer,o.firstGuide=!0,o.quizHeight=640,o.playModel="book",o.recordList=[],o.readModel="book",o}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.SWAP_PAGE,CoursewareNotify.CHANGE_QUIZ_STATE,CoursewareNotify.GETVOLUME,CoursewareNotify.SHOW_SCORE_PAGE,CoursewareNotify.SET_READ_MODEL,CoursewareNotify.CANCEL_RECORD,CoursewareNotify.CLOSE_QUIZ,CoursewareNotify.START_MY_RECORD,CoursewareNotify.SHOW_SHADOW,CoursewareNotify.HIDE_SHADOW]},t.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CoursewareNotify.SHOW_SHADOW:this.quiz&&this.quiz.showShadow();break;case CoursewareNotify.HIDE_SHADOW:this.quiz&&this.quiz.hideShadow();break;case CoursewareNotify.START_MY_RECORD:this.quiz&&this.quiz.startRecord();break;case CoursewareNotify.CANCEL_RECORD:RecordUtils.single.cancel(),this.quiz&&(this.quiz.visible=!1);break;case CoursewareNotify.SWAP_PAGE:AudioPlayer.getInstance().stop(),this.loadQuiz(t);break;case CoursewareNotify.SHOW_SCORE_PAGE:AudioPlayer.getInstance().stop();break;case CoursewareNotify.CLOSE_QUIZ:console.log("this.quiz",this.quiz),this.quiz&&(this.panelCon.removeChildren(),this.quiz=null),console.log("this.quiz",this.panelCon.numChildren);break;case CoursewareNotify.CHANGE_QUIZ_STATE:if(this.changeQuizState(t),"disabled"===t){if(this.quiz instanceof ReadQuiz)return;game.AppFacade.getInstance().sendNotification(CoursewareNotify.ADD_STARS,this.quiz.getScore())}break;case CoursewareNotify.GETVOLUME:this.quiz instanceof ReadQuiz&&this.quiz.setVolume(t.volume);break;case CoursewareNotify.SET_READ_MODEL:this.readModel=t.name,this.quizHeight=GameConfig.isSrpg?640:"record"===t.name?720:640,this.playModel="book",console.log("SET_READ_MODEL",GameConfig.isOthers),("record"===t.name||GameConfig.isOthers||GameConfig.isSrpg())&&(GameConfig.isSrpg()||(this.playModel="record"),this.recordList=P.getRecordProxy().getRecordList(),console.log("SET_READ_MODEL",this.recordList))}},t.prototype.changeQuizState=function(e){this.quiz&&this.quiz.changeState(e)},t.prototype.loadQuiz=function(e){var t,i=this;i.quiz&&(i.firstGuide=!0,t=i.quiz,i.quiz=null,i.panelCon.removeChildren()),i.quiz=new BaseQuiz(e),console.log("get all data",this.recordList,e),i.quiz.setPlayModel(i.playModel,i.recordList.filter(function(t){return t.page_id===e.id})[0]),i.quiz.soundComplete=function(e){if(void 0===e&&(e=!0),console.log("soundComplete",i.firstGuide,e),i.firstGuide&&e)if(i.firstGuide=!1,i.quiz.getGuidePointArray(),"record"===i.readModel){var t=P.getRecordProxy().recodedBookNum;1===window.currentPageNum&&4>t?(CoverMediator.COVER_DATA.level<3?ZipUtils.single.getSound("tips_Chinese_mp3").play(0,1):ZipUtils.single.getSound("tips_English_mp3").play(0,1),egret.Tween.get(i).wait(2e3).call(function(){ToolBarLayer.single.start()},i)):ToolBarLayer.single.start()}else GameConfig.isOthers||i.quiz.showGuide(),console.log("CoursewareNotify.SOUND_COMPELETE"),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SOUND_COMPELETE)},i.panelCon.addChild(i.quiz),game.AppFacade.getInstance().sendNotification(CoursewareNotify.HIDE_COVER),i.quiz.readModel=i.readModel,i.quiz.setTool()},t.NAME="QuizMediator",t}(puremvc.Mediator);__reflect(QuizMediator.prototype,"QuizMediator",["puremvc.IMediator","puremvc.INotifier"]);var CoverLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="CoverLayerSkin.exml",t}return __extends(t,e),t.prototype.onShowDone=function(){e.prototype.onShowDone.call(this),this._my.visible=!1,this._other.visible=!1,GameConfig.isOthers?this._other.visible=!0:this._my.visible=!0},t.prototype.init=function(){e.prototype.init.call(this);var t=this;t.hidePopInfo(),t.coverImg.mask=t.coverMask,t.loading=new Progress,t.loading.x=320,t.loading.y=350,t.vbook.addChild(t.loading)},t.prototype.regiestBack=function(){RecordUtils.single.resetTime(),BackUtils.single.showIcon(ShowFrom.FROM_QUIZ,this.backEvent),this.audioChannel&&""!=this.audioChannel&&this.audioChannel.stop()},t.prototype.onStart=function(e){GameConfig.readEnd=!1,this.regiestBack(),this.audioChannel=null,this.enterBook()},t.prototype.onRecord=function(e){GameConfig.recordEnd=!1,EndingLayer.single.hideEnding(),BackUtils.single.showIcon(ShowFrom.FROM_QUIZ,this.backEvent),this.onRecordBtnClick()},t.prototype.getShareUrl=function(){var e=P.getRecordProxy().getRequestHeader(),t=P.getCoursewareProxy().getCsInfo().id;return ApiHttp.BaseUrl.srUrl+"?srpg=1&id="+t+"&"+Global.paramURL(e)},t.prototype.onShare=function(e){var t=__assign({shareUrl:this.getShareUrl(),bookName:P.getCoursewareProxy().getCsInfo().name},P.getCoursewareProxy().getCsInfo(),P.getRecordProxy().getUserInfo());SharePopupPage.single.showPage(t)},t.prototype.onRank=function(e){GameConfig.fromCover=!0,GameConfig.bf=P.getCoursewareProxy().getCsInfo(),RankLayer.single.showPage(P.getCoursewareProxy().getCsInfo(),"corver"),this.audioChannel&&""!=this.audioChannel&&this.audioChannel.stop(),BackUtils.single.showIcon(ShowFrom.FROM_RANK,function(){console.log("rank back to cover"),RankLayer.single.toCover(),GameConfig.fromCover=!1,BackUtils.single.changeSytle(ShowFrom.FROM_COVER)},this)},t.prototype.addEvent=function(){e.prototype.addEvent.call(this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.recordBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this._read1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this._btnShare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this.recordBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this._read1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onStart,this),this._btnShare.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._btnRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this)},t.prototype.destory=function(){e.prototype.destory.call(this),this.audioChannel&&""!=this.audioChannel&&this.audioChannel.stop(),this.audioChannel=null,egret.Tween.removeTweens(this),console.log("on cover destory")},t.prototype.showPopInfo=function(){var e=this;e.grp_pop.visible=!0,egret.Tween.get(e).wait(2e3).call(function(){e.hidePopInfo()})},t.prototype.hidePopInfo=function(){var e=this;e.grp_pop.visible=!1},t.prototype.setProgress=function(e){this.loading&&this.loading.setProgress(e)},t.prototype.setData=function(e,t,i){var o=this;this._coverData=e;var r="3.2.9|1";r>i&&(this.recordBtn.visible=!1,this.recordBtn.touchEnabled=!1,this.recordComplete1.visible=!1),RES.getResByUrl(e.cover_url_v?e.cover_url_v:e.cover_url,function(e){return o.coverImg.source=e},this,RES.ResourceItem.TYPE_IMAGE),this.readName.text=""+e.name,this.leve.text="阅读级别：Level"+e.level,this.type.text="阅读类别："+e.type_name,this.times.text="阅读次数："+e.read_count+"次",this.minute.text="阅读时间："+e.minute+"分钟",e.have_read&&(this.recordComplete.source=RES.getRes("read_record_json.icon_finish")),console.log("recordScore",t,GameConfig.isOthers),this._btnRank.visible=!1,this._btnShare.visible=!1,t>0&&(this.recordBtn.source=RES.getRes("read_record_json.record_btn"),this.recordComplete1.source=RES.getRes("read_record_json.icon_finish"),this._btnShare.visible=!0,this._btnRank.visible=!0),GameConfig.isOthers&&(this._btnRank.visible=this._btnShare.visible=!1),console.log("this.audioChannel"+this.audioChannel+GameConfig.otherBook+e.cover_audio),(null==this.audioChannel||""==this.audioChannel)&&(this.audioChannel="",GameConfig.needAudio&&(GameConfig.needAudio=!1,RES.getResByUrl(e.cover_audio,function(e){o.audioChannel=e.play(0,1)},this,RES.ResourceItem.TYPE_SOUND))),this._coverData.level>6?(this.startBtn.x=151,this.recordComplete.x=366,this.recordComplete1.visible=!1,this.recordBtn.visible=!1):(this.startBtn.x=10,this.recordComplete.x=225)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=this._mainContent,i=(GameConfig.curWidth(),GameConfig.curHeight()),o=1;t.height>i&&(o=i/t.height),t.scaleX=t.scaleY=o},t}(ViewBase);__reflect(CoverLayer.prototype,"CoverLayer");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.textField=new egret.TextField,this.bg=new eui.Image(RES.getRes("lbg_png")),this.bg.width=GameConfig.curWidth(),this.bg.height=GameConfig.curHeight(),this.track=new eui.Rect(400,30,16098851),this.lbar=new eui.Rect(400,30,16312092),this.lmask=new eui.Rect(400,30,16312092),this.llabel=new eui.Label("正在为您加载， 请稍后..."),this.lmask.x=this.track.x=this.lbar.x=GameConfig.curWidth()/2-this.track.width/2,this.lmask.y=this.track.y=this.lbar.y=GameConfig.curHeight()/2-this.track.height/2,this.track.ellipseWidth=this.lbar.ellipseWidth=12,this.track.ellipseHeight=this.lbar.ellipseHeight=12,this.llabel.x=GameConfig.curWidth()/2+50-220,this.llabel.y=GameConfig.curHeight()/2+50,this.addChild(this.bg),this.addChild(this.lmask),this.addChild(this.track),this.addChild(this.lbar),this.lbar.mask=this.lmask,this.addChild(this.llabel),this.lbarX=this.lbar.x=this.lbar.x-400,this.textField.y=this.track.y,this.textField.x=this.track.x+this.track.width+20,this.textField.width=120,this.textField.height=40,this.textField.textAlign="center",this.textField.size=36,this.addChild(this.textField),[2]})})},t.prototype.onProgress=function(e,t){this.lbar.x=this.lbarX+400*(e/t),this.textField.text=parseInt((e/t*100).toString())+"%"},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SharePage=function(e){function t(){var t=e.call(this)||this;return t.autoPlayAudios=[],t.sound=null,t.skinName="SharePageSkin",t}return __extends(t,e),t.prototype.init=function(){var t=this;e.prototype.init.call(this),this.coverImg.mask=this.coverMask,this.finishBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.restart()},this),this.shareBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SharePopupPage.single.showPage(t.data)},this),this.recordPlayBtn.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.review()},this),this.goonRecordBtn.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.rerecord(),BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ)},this)},t.prototype.setAudios=function(e){this.autoPlayAudios=e},t.prototype.playLoopSound=function(e){return void 0===e&&(e=0),__awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.autoPlayAudios.length?[4,AudioPlayer.getInstance().play(this.autoPlayAudios[e].audio)]:[2];case 1:return t.sent(),e<this.autoPlayAudios.length-1&&this.playLoopSound(e+=1),[2]}})})},t.prototype.setStars=function(e){var t=[{x:548,y:490},{x:618,y:490},{x:688,y:490}];if(this.starsGroup.removeChildren(),0!==e){this.uploadScore(e);for(var i=0;e>i;i++){var o=new eui.Image("read_record_json.read_star_light");o.x=t[i].x,o.y=t[i].y,this.starsGroup.addChild(o)}}},t.prototype.playRecordedAnimation=function(){},t.prototype.show=function(){e.prototype.show.call(this),this.sound=ZipUtils.single.getSound("recordNo_mp3"),this.soundChannel=this.sound.play(0,1)},t.prototype.removeAnimateElement=function(){var e=this;null!=e.soundChannel&&e.soundChannel.stop(),egret.Tween.removeTweens(e),e.container.removeChildren()
},t.prototype.setData=function(e){var t=this;t.data=e;var i=(e.recordNum/e.pageNum,window.dsBridge);return i.call("read.updateBackIcon"),t.scoreGroup.visible=!1,t.goonGroup.visible=!0,!1},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=this.scoreGroup,i=(GameConfig.curWidth(),GameConfig.curHeight()),o=1;t.height>i&&(o=i/t.height),t.scaleX=t.scaleY=o,this.goonGroup.scaleY=this.goonGroup.scaleX=o},t.prototype.destory=function(){e.prototype.destory.call(this),null!=this.soundChannel&&this.soundChannel.stop(),this.soundChannel=null,this.sound=null},t}(ViewBase);__reflect(SharePage.prototype,"SharePage");var SharePopupPage=function(e){function t(){var t=e.call(this)||this;return t.skinName="SharePopupPageSkin",t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.showPage=function(e,t){this.shareData=e,this.shareData.name=GameConfig.user.name,console.log("this.shareData ===== ",this.shareData),t||(t=GameLayerManager.gameLayer().shareLayer),t.addChild(this)},t.prototype.init=function(){var t=this;e.prototype.init.call(this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return t.parent.removeChild(t)},this);var i=window.dsBridge;this.shareWxBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.shareData){console.log(t.shareData);var e=""!=t.shareData.cover_url?t.shareData.cover_url:t.shareData.cover_url_v;i.call("read.shareStudyReport",{title:"每日阅读|一起来欣赏"+t.shareData.name+"的绘本配音作品《"+t.shareData.bookName+"》",description:"一起加入绘本配音，让宝宝爱上英语阅读。",thumb:e,webUrl:t.shareData.shareUrl,type:2,channel:1})}},this),this.sharePyqBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.shareData){console.log(t.shareData);var e=""!=t.shareData.cover_url?t.shareData.cover_url:t.shareData.cover_url_v;i.call("read.shareStudyReport",{title:"每日阅读|一起来欣赏"+t.shareData.name+"的绘本配音作品《"+t.shareData.bookName+"》",description:"一起加入绘本配音，让宝宝爱上英语阅读。",thumb:e,webUrl:t.shareData.shareUrl,type:2,channel:2})}},this)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=this._mainContent,i=GameConfig.curWidth(),o=GameConfig.curHeight();this.width=i,this.height=o;var r=1;t.height>o&&(r=o/t.height),t.scaleX=t.scaleY=r},t}(ViewBase);__reflect(SharePopupPage.prototype,"SharePopupPage");var CoverMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;o.starNum=0,o.currentAsset=0,o.readModel={},o.isReadEnd=!1,o.isRecordEnd=!1;var r=GameLayerManager.gameLayer().panelLayer;return o.coverLayer=new CoverLayer,o.sharePage=new SharePage,o._from="",!GameConfig.isSrpg()&&r.addChild(o.coverLayer),o.coverLayer.backEvent=function(){return o.showPage("backEvent")},o.coverLayer.enterBook=function(){return o.loadBook("normal")},o.coverLayer.onRecordBtnClick=function(){return o.loadBook("record")},OtherEndingV.single.restart=function(){return o.showPage("restart","read")},o.sharePage.restart=function(){return o.showPage("restart","record")},o.sharePage.review=function(){return o.showPage("review")},o.sharePage.rerecord=function(){return o.showPage("rerecord")},RankLayer.single.rerecord=function(){return o.showPage("rerecord")},EndingLayer.single.rerecord=function(){return o.showPage("restart","record")},o.sharePage.uploadScore=function(e){},o}return __extends(t,e),t.prototype.loadBook=function(e){console.log("loadBook"),this.readModel={name:e},game.AppFacade.getInstance().sendNotification(CoursewareNotify.SET_READ_MODEL,this.readModel),this.coverLayer.touchChildren=!1;for(var t=P.getCoursewareProxy().getCourseWareData(),i=this.preloadAssets(),o=0;o<t.length;o++)i(t[o]);i()},t.prototype.onResourceProgress=function(e){"others"==e.groupName&&this.onLoadSuccessHandler()},t.prototype.onLoadSuccessHandler=function(){var e=this,t=++this._currentAsset,i=this._total,o=Math.floor(t/i*100);console.log("loadhankder123",t,i,o),t===i?(RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.coverLayer.setProgress(100),EndingLayer.single,OtherEndingV.single,window.jumpPage(1),GameConfig.isSrpg()?SoundManager.instance.playNullSound():ZipUtils.single.getSound("enterbook_mp3").play(0,1),egret.Tween.get(this.coverLayer).to({alpha:0},700).call(function(){e.coverLayer.touchChildren=!0;var t=window.dsBridge;t.call("read.readStart"),GameLayerManager.gameLayer().panelLayer.removeChildren(),e.coverLayer.alpha=1,game.AppFacade.getInstance().sendNotification(CoursewareNotify.ENTER_PICTRUE_BOOK)})):this.coverLayer.setProgress(o)},t.prototype.getShareUrl=function(){var e=P.getRecordProxy().getRequestHeader(),t=P.getCoursewareProxy().getCsInfo().id;return ApiHttp.BaseUrl.srUrl+"?srpg=1&id="+t+"&"+Global.paramURL(e)},t.prototype.onLoadErrorHandler=function(){},t.prototype.preloadAssets=function(){var e=[];return function(t){var i=this;if(void 0===t&&(t=null),t){var o=new RegExp(/(https?:\/\/[^,]*\.(?:jpe?g|gif|png|mp3|mpeg))/g),r=void 0,n=JSON.stringify(t);do r=o.exec(n),r&&e.push(r[1]);while(r)}else{RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this);var s=RES.getGroupByName("others");this._total=e.length+s.length,this._currentAsset=0,RES.loadGroup("others"),e.forEach(function(e){if(-1!=e.search("mp3")||-1!=e.search("mpeg")){if(GameConfig.isSrpg())return void i.onLoadSuccessHandler();RES.getResByUrl(e,function(t){ZipUtils.single.addSound(e,t),i.onLoadSuccessHandler()},i,RES.ResourceItem.TYPE_SOUND)}else RES.getResByUrl(""+e+Global.webpSuffix,function(){i.onLoadSuccessHandler()},i,RES.ResourceItem.TYPE_IMAGE)})}}.bind(this)},t.prototype.showPage=function(e,t){return void 0===t&&(t=null),__awaiter(this,void 0,void 0,function(){var i,o,r,n,s,a,h,c,l,u,d,g,p,s,f,_,y,m,l,v,E,w,C,T,b,l,R,S,x,p,s,f,y,m,l,v,E,L,A=this;return __generator(this,function(O){switch(O.label){case 0:if(i=GameLayerManager.gameLayer().panelLayer,o=window,r=o.dsBridge,n=o.jumpPage,"rerecord"!==e)return[3,2];for(GameConfig.recordEnd=!1,s=P.getRecordProxy().getRecordList(),a=P.getCoursewareProxy().getCourseWareData(),h=0,c=function(e){return 0===s.filter(function(t){return a[e].id===t.page_id}).length?(h=e,"break"):void 0},l=0;l<a.length&&(u=c(l),"break"!==u);l++);return i.removeChildren(),n(h+1),[4,Global.delay(1)];case 1:return O.sent(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.ENTER_PICTRUE_BOOK),[3,24];case 2:if("recordEnd"!==e)return[3,9];if(GameConfig.recordEnd=!0,d=__assign({shareUrl:this.getShareUrl(),bookName:P.getCoursewareProxy().getCsInfo().name},P.getCoursewareProxy().getCsInfo(),P.getRecordProxy().getUserInfo()),g=this.sharePage.setData(d),RankLayer.single.shareData=d,GameConfig.formEnd=!0,AudioPlayer.getInstance().stop(),p=P.getCoursewareProxy().getCsInfo(),s=P.getRecordProxy().getRecordList(),console.log("recordList.length , info.pageNum",s.length,p.pageNum,s),f=!1,_=0,!(s.length>=p.pageNum))return[3,5];for(f=!0,y=0,m=s.length,l=0;m>l;l++)v=s[l],y+=v.score,v.score>=30&&v.score<50?_+=1:v.score>=50&&v.score<70?_+=2:v.score>=70&&(_+=3);return y=Math.round(y/s.length),console.log(y),console.log("this.coverData.score ===>>>>>",y,P.getRecordProxy().getUserInfo().score),E=P.getRecordProxy().getUserInfo().score,E&&E==y?[3,4]:[4,P.getRecordProxy().uploadRecordScore(p.id,y)];case 3:O.sent(),O.label=4;case 4:this.coverData&&(this.coverData.score=y),O.label=5;case 5:return f?(GameConfig.bf=P.getCoursewareProxy().getCsInfo(),[4,P.getRecordProxy().getRank(GameConfig.bf.id,GameConfig.userId)]):[3,7];case 6:for(w=O.sent(),console.log("get rank ===",w),BackUtils.single.changeSytle(ShowFrom.FROM_COVER),C={},C.book=GameConfig.bf,C.items=[],T=["star","score","rank"],b=[_,this.coverData.score,w.data.rank],l=0;3>l;l++)R={},R[T[l]]=b[l],C.items.push(R);return egret.setTimeout(function(){EndingLayer.single.showEnding(C)},this,100),[3,8];case 7:game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),AudioPlayer.getInstance().stop(),this.sharePage.setAudios(P.getRecordProxy().getRecordList()),i.addChild(this.sharePage),BackUtils.single.changeSytle(ShowFrom.FROM_SHARE),O.label=8;case 8:return this.isRecordEnd=f,[3,24];case 9:return"readEnd"!==e?[3,10]:(GameConfig.readEnd=!0,GameConfig.isOthers||GameConfig.isSrpg(),this.isReadEnd=!0,OtherEndingV.single.showEnding(GameConfig.userInfo),r.call("read.setReadScore",{score:3},function(e){return console.log("read.setReadScore",e)}),BackUtils.single.changeSytle(ShowFrom.FROM_COVER),[3,24]);case 10:if("restart"!==e)return[3,16];console.log("restart",t,GameConfig.nowUID),O.label=11;case 11:return O.trys.push([11,14,,15]),S="record"===t,S?[4,P.getRecordProxy().getRecordListAsync(P.getCoursewareProxy().getCsInfo().id,GameConfig.nowUID)]:[3,13];case 12:S=O.sent(),O.label=13;case 13:return i.removeChildren(),i.addChild(this.coverLayer),console.log("coverData",this.coverData),this.coverData.have_read="read"===t?!0:this.coverData.have_read,this.coverData.read_count=(parseInt(this.coverData.read_count)+1).toString(),this.sharePage.removeAnimateElement(),this.sharePage.starsBar.removeStars(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHARE_ENTER_BOOK,t),[3,15];case 14:return x=O.sent(),console.log(x),[3,15];case 15:return[3,24];case 16:return"review"!==e?[3,18]:[4,P.getRecordProxy().getRecordListAsync(P.getCoursewareProxy().getCsInfo().id,GameConfig.nowUID)];case 17:return O.sent(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SET_READ_MODEL,this.readModel),n(1),r.call("read.readStart"),this.sharePage.removeAnimateElement(),this.sharePage.starsBar.removeStars(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.ENTER_PICTRUE_BOOK),i.removeChild(this.sharePage),[3,24];case 18:if("backEvent"!==e)return[3,24];if(console.log("backEvent",this.readModel),GameConfig.needAudio=!1,"record"!==this.readModel.name)return[3,21];if(p=P.getCoursewareProxy().getCsInfo(),s=P.getRecordProxy().getRecordList(),console.log("recordList.length , info.pageNum",s.length,p.pageNum,s),f=!1,!(s.length>=p.pageNum))return[3,21];for(y=0,m=s.length,l=0;m>l;l++)v=s[l],y+=v.score;return y=Math.round(y/s.length),console.log("this.coverData.score ===>>>>>",y,P.getRecordProxy().getUserInfo().score),E=P.getRecordProxy().getUserInfo().score,E&&E==y?[3,20]:[4,P.getRecordProxy().uploadRecordScore(p.id,y)];case 19:O.sent(),O.label=20;case 20:this.coverData&&(this.coverData.score=y),O.label=21;case 21:return L="record"===t,L?[4,P.getRecordProxy().getRecordListAsync(P.getCoursewareProxy().getCsInfo().id,GameConfig.nowUID)]:[3,23];case 22:L=O.sent(),O.label=23;case 23:if(i.removeChildren(),this.coverData.have_read="read"===t?!0:this.coverData.have_read,AudioPlayer.getInstance().stop(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CANCEL_RECORD),this.sharePage.removeAnimateElement(),this.sharePage.starsBar.removeStars(),console.log("CoursewareNotify.CLOSE_QUIZ",EndingLayer.single.fromEnding,OtherEndingV.single.fromEnding),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),EndingLayer.single.fromEnding)GameConfig.recordEnd?BackUtils.single.onCloseView():(OtherEndingV.single.hideEnding(),GameConfig.isOthers=!1,EndingLayer.single.setVisible(!0),GameLayerManager.gameLayer().endLayer.visible=!0,BackUtils.single.showIcon(ShowFrom.FROM_COVER,this.coverLayer.backEvent),RankLayer.single.isShow&&BackUtils.single.showIcon(ShowFrom.FROM_RANK_END,function(){return __awaiter(A,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return GameConfig.nowUID=GameConfig.userId,[4,P.getRecordProxy().getRecordListAsync(P.getCoursewareProxy().getCsInfo().id,GameConfig.nowUID)];case 1:return e.sent(),BackUtils.single.changeSytle(ShowFrom.FROM_COVER),EndingLayer.single.setVisible(!0),RankLayer.single.hidePage(!0),[2]}})})},this));else if(OtherEndingV.single.fromEnding&&!GameConfig.isOthers)GameConfig.recordEnd?BackUtils.single.onCloseView():(OtherEndingV.single.setVisible(!0),GameLayerManager.gameLayer().endLayer.visible=!0,BackUtils.single.showIcon(ShowFrom.FROM_COVER,this.coverLayer.backEvent));else{BackUtils.single.changeSytle(ShowFrom.FROM_COVER);try{console.log("backEvent hanlder",GameConfig.isOthers),OtherEndingV.single.hideEnding(),EndingLayer.single.setVisible(!1),GameConfig.otherBook||GameConfig.isOthers||(GameConfig.recordEnd||GameConfig.readEnd?BackUtils.single.onCloseView():game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_COVER,this.coverData)),!GameConfig.otherBook&&GameConfig.isOthers&&BackUtils.single.backToPrve()}catch(k){console.log(k)}}O.label=24;case 24:return[2]}})})},t.prototype.listNotificationInterests=function(){return[CoursewareNotify.SHOW_COVER,CoursewareNotify.SHOW_SCORE_PAGE,CoursewareNotify.GET_RECORD_LIST,CoursewareNotify.SHARE_ENTER_BOOK,CoursewareNotify.SHOW_MY_WORKS,CoursewareNotify.START_READ,CoursewareNotify.RANK_BACK_COVER,CoursewareNotify.HIDE_COVER]},t.prototype.handleNotification=function(e){var i=e.getBody();switch(e.getName()){case CoursewareNotify.HIDE_COVER:this.coverLayer&&this.coverLayer.parent&&this.coverLayer.parent.removeChild(this.coverLayer);break;case CoursewareNotify.RANK_BACK_COVER:this.showPage("backEvent");break;case CoursewareNotify.GET_RECORD_LIST:break;case CoursewareNotify.START_READ:this.showPage("restart","read");break;case CoursewareNotify.SHOW_MY_WORKS:this.sharePage&&(this.sharePage.removeAnimateElement(),this.sharePage.starsBar.removeStars());break;case CoursewareNotify.SHOW_COVER:GameConfig.readEnd=!1,GameConfig.recordEnd=!1,GameConfig.formEnd=!1;var o=GameLayerManager.gameLayer().panelLayer;o.removeChildren(),o.addChild(this.coverLayer),this.coverLayer.visible=!1,P.getRecordProxy().recording=!1,RecordUtils.single.cancel(),this.coverData=i,this.isReadEnd&&(this.coverData.have_read=!0);var r=P.getRecordProxy().getUserInfo().score;this.isRecordEnd&&this.coverData.score&&(r=this.coverData.score),console.log("score ",r,this.coverData.score),t.COVER_DATA=i,this.coverLayer.setData(this.coverData,r,P.getRecordProxy().getRequestHeader().Version),GameConfig.otherBook?(game.AppFacade.getInstance().sendNotification(CoursewareNotify.START_READ),console.log("reg"),BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ)):this.coverLayer.visible=!0;break;case CoursewareNotify.SHOW_SCORE_PAGE:var n="readEnd";GameConfig.isOthers||GameConfig.isSrpg()||(n="record"===this.readModel.name?"recordEnd":"readEnd"),this.showPage(n);break;case CoursewareNotify.SHARE_ENTER_BOOK:"read"===i?this.loadBook("read"):"record"===i?this.loadBook("record"):this.loadBook("record")}},t.NAME="CoverMediator",t}(puremvc.Mediator);__reflect(CoverMediator.prototype,"CoverMediator",["puremvc.IMediator","puremvc.INotifier"]);var EffectLayer=function(e){function t(){var t=e.call(this)||this;return t.isBack=!1,t.PI=3.14159,t.addEventListener(eui.UIEvent.COMPLETE,t.onCompelete,t),t.skinName="resource/ui/effectlayer/effectlayer.exml",t}return __extends(t,e),t.prototype.drawEffectImg=function(e){this.direction=e,this.count=0,"left"===e?(this.leftImg.source=this.drawTextrue("right"),this.rightImg.source=this.drawTextrue("left"),this.activeFilter=this.getFilter(GameConfig.curWidth()/2,0,GameConfig.curWidth()/2,GameConfig.curHeight(),this.PI,1),this.rightImg.filters=[this.activeFilter],this.leftImg.x=GameConfig.curWidth()/2,this.leftImg.y=0,this.isBack=!0):(this.leftImg.source=this.drawTextrue("left"),this.rightImg.source=this.drawTextrue("right"),this.isBack=!1,this.activeFilter=this.getFilter(GameConfig.curWidth()/2,0,GameConfig.curWidth()/2,GameConfig.curHeight(),0,0),this.rightImg.filters=[this.activeFilter],this.leftImg.x=0,this.leftImg.y=0)},t.prototype.playPageEffect=function(e){this.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},t.prototype.onCompelete=function(e){this.removeEventListener(eui.UIEvent.COMPLETE,this.onCompelete,this),this.rightImg.x=GameConfig.curWidth()/2},t.prototype.drawTextrue=function(e){var t=GameConfig.curWidth(),i=GameConfig.curHeight(),o=new eui.Group;o.width=t,o.height=i;var r=GameLayerManager.gameLayer().quizLayer,n=new egret.Bitmap,s=new egret.RenderTexture;s.drawToTexture(r,new egret.Rectangle(0,0,t,i)),n.texture=s,o.addChild(n);var a=new egret.RenderTexture;return a.drawToTexture(o,new egret.Rectangle("left"===e?0:t/2,0,t/2,i)),a},t.prototype.update=function(e){var t=this.activeFilter;if("right"===this.direction){this.count<=this.PI?(this.count+=.15,t.uniforms.time=this.count):(this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),game.AppFacade.getInstance().sendNotification(CoursewareNotify.HIDE_SHADOW),this.leftImg.texture.dispose(),this.rightImg.texture.dispose(),this.rightImg.filters=[]);var i=t.uniforms.time;i<=.5*this.PI&&this.isBack?(t.uniforms.back=0,this.isBack=!1,this.leftImg.texture=this.drawTextrue("right")):i>.5*this.PI&&i<this.PI&&!this.isBack&&(this.isBack=!0,t.uniforms.back=1,this.rightImg.texture=this.drawTextrue("left"))}else{t.uniforms.time>=0?t.uniforms.time-=.15:(this.removeEventListener(egret.Event.ENTER_FRAME,this.update,this),game.AppFacade.getInstance().sendNotification(CoursewareNotify.HIDE_SHADOW),this.leftImg.texture.dispose(),this.rightImg.texture.dispose());var i=t.uniforms.time;i<=.5*this.PI&&!this.isBack?(t.uniforms.back=0,this.isBack=!0,this.rightImg.texture=this.drawTextrue("right")):i>.5*this.PI&&i<this.PI&&this.isBack&&(this.isBack=!1,t.uniforms.back=1)}},t.prototype.getFilter=function(e,t,i,o,r,n){var s="\n            attribute vec2 aVertexPosition;\n            attribute vec2 aTextureCoord;\n            attribute vec2 aColor;\n\n            uniform vec2 projectionVector;\n\n            uniform float uLB_x;\n            uniform float uLB_y;\n            uniform float uRB_x;\n            uniform float uRB_y;\n\n            uniform float uWorld_w;\n            uniform float uWorld_h;\n\n            varying vec2 texCoord;\n            uniform float time; \n\n            const vec2 center = vec2(-1.0, 1.0);\n\n\n            void main(void) {\n\n                vec2 temp = aVertexPosition / projectionVector + center;\n\n                vec2 lb;\n                lb.x = uLB_x / (uWorld_w * 0.5) + center.x;\n                lb.y = uLB_y / (uWorld_h * -0.5) + center.y;\n\n                vec2 rb;\n                rb.x = uRB_x / (uWorld_w * 0.5) + center.x;\n                rb.y = uRB_y / (uWorld_h * -0.5) + center.y;\n\n                if (abs(temp.x - lb.x) < 0.01) {\n                    // if (abs(temp.y - lb.y) < 0.01) {\n                    //     temp.y -= sin(time) * 0.5;\n                    // } else {\n                    //     temp.y += sin(time) * 0.5;\n                    // }\n                    \n                        temp.y += sin(time) * 0.2;\n                    temp.x = lb.x - 1.0 * (lb.x - rb.x) * (1.0 - cos(time));\n                }\n                \n                gl_Position = vec4(temp, 0.0, 1.0);\n                texCoord = aTextureCoord;\n            }\n        ",a="\n            precision mediump float;\n            varying vec2 texCoord;\n            uniform sampler2D sourceTex;\n            uniform float back;\n            void main(void) {\n                vec2 newCood = texCoord;\n                if (abs(back - 1.0) < 0.01) {\n                    newCood = vec2(1.0-texCoord.x, texCoord.y);\n                }\n                vec4 color = texture2D(sourceTex, newCood);\n                // gl_FragColor = vec4(1.0, 1.0, 0.0, 0.3);\n                gl_FragColor = color;\n            }\n        ",h=new egret.CustomFilter(s,a,{uLB_x:e+i,uLB_y:t+o,uRB_x:e,uRB_y:t+o,uWorld_w:GameConfig.curWidth(),uWorld_h:GameConfig.curHeight(),time:r,back:n});return h},t}(eui.Component);__reflect(EffectLayer.prototype,"EffectLayer");var EffectLayerMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;o.starNum=0;var r=GameLayerManager.gameLayer().effectLayer;return o.effectLayer=new EffectLayer,o.effectLayer.width=GameConfig.curWidth(),o.effectLayer.height=GameConfig.curHeight(),r.addChild(o.effectLayer),o}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.PLAY_SWAP_EFFECT]},t.prototype.getQuizView=function(){var e=GameLayerManager.gameLayer().quizLayer,t=e.getChildAt(0);return t.container},t.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CoursewareNotify.PLAY_SWAP_EFFECT:t.touchStart&&(this.effectLayer.drawEffectImg(t.direction),this.effectLayer.playPageEffect(t.direction))}},t.NAME="EffectLayerMediator",t}(puremvc.Mediator);__reflect(EffectLayerMediator.prototype,"EffectLayerMediator",["puremvc.IMediator","puremvc.INotifier"]);var LevelComboboxItems=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this._titleTxt.text=this.data},t.prototype.getSelect=function(){return e.prototype.getSelect.call(this)},t.prototype.setSelect=function(t){e.prototype.setSelect.call(this,t),t?this._titleTxt.textColor=54998:this._titleTxt.textColor=6710886},t}(ComboBoxItemBase);__reflect(LevelComboboxItems.prototype,"LevelComboboxItems");var MyWorksLayer=function(e){function t(){var t=e.call(this)||this;return t.data=[],t.skinName="MyWorksSKin",t}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),this._sl.viewport=this._ls,this._ls.itemRenderer=MyWorksNode,this._sl.horizontalScrollBar=null,this._sl.verticalScrollBar=null,this._sl.scrollPolicyV=eui.ScrollPolicy.OFF,this._cb=new ComboBox("ComboBoxLevel",LevelComboboxItems);for(var t=[],i=1;16>=i;i++)t.push("Level"+i);this._cb.setData(t),this._cbG.addChild(this._cb)},t.prototype.show=function(){e.prototype.show.call(this),this._mainG.visible=!1,this._emptyTxt.text="数据加载中",this._cb.selectIndex(0)},t.prototype.getWorks=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,P.getMyWorksProxy().getMyWorks(e+1)];case 1:return i.sent(),console.log("on select",e),t=P.getMyWorksProxy().getWorksByLeval(e),this._sl.visible=!1,this._empty.visible=!1,t.length<=0?(this._empty.visible=!0,this._emptyTxt.text="期待你创作Level "+(e+1)+"的绘本配音哦~"):(this._sl.visible=!0,t.sort(function(e,t){return t.last_update-e.last_update}),this._ls.dataProvider=new eui.ArrayCollection(t)),egret.setTimeout(function(){var e=window.dsBridge;e.call("read.readLoaded",{status:1,version:2})},this,300),[2]}})})},t.prototype.onCbSelect=function(e){console.log("on select 123"),this._mainG.visible=!0;var t=(e.data.item,e.data.index);this.getWorks(t)},t.prototype.addEvent=function(){e.prototype.addEvent.call(this),this._cb.addEvent(),this._cb.addEventListener(ComboBox.COMBOBOX_SELECT,this.onCbSelect,this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this._cb.removeEvent(),this._cb.removeEventListener(ComboBox.COMBOBOX_SELECT,this.onCbSelect,this)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=GameConfig.curWidth(),i=GameConfig.curHeight();this.width=t,this.height=i;var o=1,r=this._sl;r.height>=i-134&&(o=(i-134)/r.height),i-134-r.height>200&&(o=1.25),this._sl.scaleY=this._sl.scaleX=o,r.width*o!=t-32&&(this._sl.width=(t-32)/o)},t.prototype.activate=function(){GameConfig.needAudio=!1,this.visible=!0},t.prototype.deActivate=function(){this.visible=!1},t.prototype.destory=function(){e.prototype.destory.call(this)},t}(ViewBase);__reflect(MyWorksLayer.prototype,"MyWorksLayer");var MyWorksNode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.init=function(){this._btnRank.name="rank",this._btnShare.name="share",this._coverImg.mask=this._coverMask},t.prototype.updata=function(){var e=this,t=this.data.book;RES.getResByUrl(t.cover_url_v?t.cover_url_v:t.cover_url,function(t){return e._coverImg.source=t},this,RES.ResourceItem.TYPE_IMAGE),this._scoreTxt.text=this.data.score,this._timeTxt.text=RegUtils.timestampToTime(this.data.last_update)},t.prototype.onRead=function(){var e=game.AppFacade.getInstance();console.log("on read 123",this.data.book.id,GameConfig.fromCover);var t="works";BackUtils.single.showIcon(ShowFrom.FROM_WORKS,function(){e.sendNotification(CoursewareNotify.SHOW_MY_WORKS,""),e.sendNotification(CoursewareNotify.HIDE_COVER)},this),GameConfig.needAudio=!0,e.sendNotification(CoursewareNotify.GET_RECORD,{id:this.data.book.id,from:t})},t.prototype.addEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this._btnShare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this._btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.vbook.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRead,this)},t.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this._btnShare.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this._btnRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),this.vbook.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRead,this)},t.prototype.onRemove=function(e){this.removeEvent()},t.prototype.onTap=function(e){var t=e.target.name;GameLayerManager.gameLayer().worksLayer;switch(t){case"share":var i=__assign({shareUrl:this.getShareUrl(),bookName:this.data.book.name},this.data.book,P.getRecordProxy().getUserInfo());console.log(i),SharePopupPage.single.showPage(i,GameLayerManager.gameLayer().shareLayer);break;case"rank":var o="works";GameConfig.fromCover&&(o="works_rank"),RankLayer.single.showPage(this.data.book,o);var r=game.AppFacade.getInstance();BackUtils.single.showIcon(ShowFrom.FROM_RANK,function(){GameConfig.nowUID=GameConfig.userId,RankLayer.single.hidePage(),BackUtils.single.changeSytle(ShowFrom.FROM_WORKS),r.sendNotification(CoursewareNotify.SHOW_MY_WORKS,"")},this)}},t.prototype.getShareUrl=function(){var e=P.getRecordProxy().getRequestHeader(),t=this.data.book.id;return ApiHttp.BaseUrl.srUrl+"?srpg=1&id="+t+"&"+Global.paramURL(e)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.init(),this.addEvent()},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this),this.updata()},t}(eui.ItemRenderer);__reflect(MyWorksNode.prototype,"MyWorksNode",["eui.UIComponent","egret.DisplayObject"]);var MyWorksMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;return o._myWorksLayer=new MyWorksLayer,o}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.SHOW_MY_WORKS,CoursewareNotify.HIDE_MY_WORKS]},t.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CoursewareNotify.SHOW_MY_WORKS:GameConfig.formWork=!0,AudioPlayer.getInstance().stop(),console.log("works from",t),this.showLayer();break;case CoursewareNotify.HIDE_MY_WORKS:this.hideLayer(t.destory)}},t.prototype.showLayer=function(){var e=GameLayerManager.gameLayer().worksLayer;e.contains(this._myWorksLayer)||(e.removeChildren(),e.addChild(this._myWorksLayer)),this._myWorksLayer.activate()},t.prototype.hideLayer=function(e){e?this._myWorksLayer.parent&&this._myWorksLayer.parent.removeChild(this._myWorksLayer):this._myWorksLayer.deActivate()},t.NAME="MyWorksMediator",t}(puremvc.Mediator);__reflect(MyWorksMediator.prototype,"MyWorksMediator",["puremvc.IMediator","puremvc.INotifier"]);var RankLayer=function(e){function t(){var t=e.call(this)||this;return t._book=-1,t.skinName="RankPanel",t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.init=function(){e.prototype.init.call(this),this._sl.viewport=this._ls,this._ls.itemRenderer=RankNode,this._coverImg.mask=this._coverMask,this._star.visible=!1},t.prototype.show=function(){e.prototype.show.call(this)},t.prototype.getShareUrl=function(){var e=P.getRecordProxy().getRequestHeader(),t=this._bookInfo.id;return ApiHttp.BaseUrl.srUrl+"?srpg=1&id="+t+"&"+Global.paramURL(e)},t.prototype.onBackToMyWorks=function(e){var i=this,o=game.AppFacade.getInstance(),r="fromNative";this._from&&(r="fromCorver"),o.sendNotification(CoursewareNotify.SHOW_MY_WORKS,r),BackUtils.single.changeSytle(ShowFrom.FROM_RANK);var n=!1;this.parent==GameLayerManager.gameLayer().endLayer?(n=!0,EndingLayer.single.setVisible(!1),this.hidePage()):this.hidePage(),BackUtils.single.showIcon(ShowFrom.FROM_WORKS,function(){GameConfig.formWork=!1,GameConfig.isOthers=!1,o.sendNotification(CoursewareNotify.HIDE_MY_WORKS,{destory:!0}),n?(BackUtils.single.changeSytle(ShowFrom.FROM_RANK_END),EndingLayer.single.setVisible(!0),t.single.showPage(GameConfig.bf,"quiz",GameLayerManager.gameLayer().endLayer,!0)):(BackUtils.single.changeSytle(ShowFrom.FROM_RANK),"works_rank"==i._from||"works"==i._from||"works_cover"==i._from||"corver"==i._from?t.single.showPage(GameConfig.bf,"corver"):t.single.showPage(i._bookInfo,"quiz"))},this)},t.prototype.onBook=function(e){var i=this,o=game.AppFacade.getInstance(),r=!1;this.parent==GameLayerManager.gameLayer().endLayer&&(r=!0,EndingLayer.single.setVisible(!1),this.visible=!1,BackUtils.single.changeSytle(ShowFrom.FROM_COVER)),BackUtils.single.showIcon(ShowFrom.FROM_COVER,function(){console.log("this._from",i._from,r),r?(GameConfig.isOthers=!1,BackUtils.single.changeSytle(ShowFrom.FROM_RANK_END),EndingLayer.single.setVisible(!0),GameLayerManager.gameLayer().endLayer.visible=!0,t.single.showPage(GameConfig.bf,"quiz",GameLayerManager.gameLayer().endLayer,!0),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ)):"works_rank"==i._from||"works"==i._from||"works_cover"==i._from||"corver"==i._from?(BackUtils.single.changeSytle(ShowFrom.FROM_RANK),t.single.showPage(GameConfig.otherBookInfo,i._from)):(GameConfig.isOthers=!1,BackUtils.single.changeSytle(ShowFrom.FROM_RANK),t.single.showPage(i._bookInfo,"quiz"))},this),o.sendNotification(CoursewareNotify.GET_RECORD,{id:this._bookInfo.id,from:"rank",uin:GameConfig.userId})},t.prototype.onBtnBack=function(e){console.log("onBtnBack",this._from);var t=this._from;"works"==t?game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_MY_WORKS,"fromNative"):"corver"==t?this.hidePage():(game.AppFacade.getInstance().sendNotification(CoursewareNotify.RANK_BACK_COVER),BackUtils.single.changeSytle(ShowFrom.FROM_COVER,!0),this.hidePage())},t.prototype.onBtnReplay=function(e){GameConfig.recordEnd=!1,BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ),this.parent==GameLayerManager.gameLayer().endLayer?(EndingLayer.single.fromEnding=!0,EndingLayer.single.setVisible(!1),GameLayerManager.gameLayer().endLayer.visible=!1,BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ,!0)):this.hidePage(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHARE_ENTER_BOOK,"record")},t.prototype.onBtnShare=function(e){this.shareData=__assign({shareUrl:this.getShareUrl(),bookName:this._bookInfo.name},this._bookInfo,P.getRecordProxy().getUserInfo()),SharePopupPage.single.showPage(this.shareData)},t.prototype.addEvent=function(){e.prototype.addEvent.call(this),this._back.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackToMyWorks,this),this.vbook.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBook,this),this._btnBack.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnBack,this),this._btnReplay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnReplay,this),this._btnShare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBtnShare,this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this._back.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackToMyWorks,this),this.vbook.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBook,this)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);
var t=GameConfig.curWidth(),i=GameConfig.curHeight();this.width=t,this.height=i;var o=this._mainContent,r=1;o.height>i-168&&(r=(i-168)/o.height),o.scaleY=o.scaleX=r,console.log("onViewResize=====",o.width,o.height,r,t,i)},t.prototype.activate=function(){this.visible=!0,this.onViewResize()},t.prototype.deActivate=function(){this.visible=!1},t.prototype.showPage=function(e,t,i,o,r){void 0===o&&(o=!1),void 0===r&&(r=!1),this.isShow=!0,""==t&&(t=this._from),console.log("from rank",t,GameConfig.bf),GameConfig.bf&&"works_rank"!=t&&"works"!=t&&(e=GameConfig.bf),e&&(GameConfig.otherBookInfo=e),GameConfig.fromRank=!1,e||(e=this._bookInfo),this._ls.dataProvider=new eui.ArrayCollection([]),this._content.x=0,this._play=r,this._rankTitle.textColor=16777215,this._bg.visible=!0,this._topBg.visible=!0,o&&(this._rankTitle.textColor=1359293,this._bg.visible=!1,this._topBg.visible=!1),r&&(this._content.x=-this.width),i||(i=GameLayerManager.gameLayer().panelLayer),this.visible=!0,i.addChild(this),this._mainG.visible=!0;var n=game.AppFacade.getInstance();n.sendNotification(CoursewareNotify.HIDE_MY_WORKS,{destory:!1}),this._bookInfo=e,this._back.visible=!1;var s=(window.dsBridge,!1);this._btnBack.visible=!1,this._btnReplay.visible=!1,this._btnShare.visible=!0,this._btnShare.x=184,console.log(t);var a=this._book;this._book=-1==this._book?this._bookInfo.id:this._book,"works"==t?this._book=-1:"corver"==t?(s=!0,this._back.visible=!0):"works_cover"==t?(s=!0,this._back.visible=!0):"works_rank"==t?this._book=a:(this._back.visible=!0,this._btnReplay.visible=!0,this._btnShare.x=290),console.log("is othet",GameConfig.isOthers,t),GameConfig.formEnd&&"works_rank"!=t&&"works"!=t&&(this._back.visible=!0,this._btnReplay.visible=!0,this._btnShare.x=290),this._from=t,this.getRankList()},t.prototype.getRankList=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,r,n,s,a,h=this;return __generator(this,function(c){switch(c.label){case 0:return e=this._bookInfo,[4,P.getMyWorksProxy().getRankList(e)];case 1:return c.sent(),[4,P.getRecordProxy().getRank(e.id,GameConfig.userId)];case 2:for(t=c.sent(),console.log("get rank ===",t),console.log("get rank book",e),this._ls.dataProvider=new eui.ArrayCollection(P.getMyWorksProxy().getRankById(e.id)),this._mainG.visible=!1,this._play&&(egret.Tween.removeTweens(this._content),EndingLayer.single.hideBookG(),egret.Tween.get(this._content).to({x:0},500,egret.Ease.backOut)),i=t.data.score_list,i||(i=[]),o=i.length,r=0,n=0;o>n;n++)s=i[n],s>=30&&50>s?r+=1:s>=50&&70>s?r+=2:s>=70&&(r+=3);return this._starTxt.text=r.toString(),RES.getResByUrl(e.cover_url_v?e.cover_url_v:e.cover_url,function(e){return h._coverImg.source=e},this,RES.ResourceItem.TYPE_IMAGE),this._scoreTxt.text=e.score.toString(),console.log("===========book",this._scoreTxt.text,e.score.toString()),a=e.rank<=200?e.rank.toString():"200+",this._rankTxt.text=a,[2]}})})},t.prototype.showStar=function(e,t){},t.prototype.toCover=function(){var e=this,t=game.AppFacade.getInstance(),i=-1==this._book?P.getCoursewareProxy().getCsInfo().id:this._book;GameConfig.nowUID=GameConfig.userId,console.log("toCover====",GameConfig.nowUID),t.sendNotification(CoursewareNotify.GET_RECORD,{id:i,from:"native"}),GameConfig.isOthers=!1,egret.setTimeout(function(){e.hidePage()},this,300)},t.prototype.hidePage=function(e){var t=this;if(void 0===e&&(e=!1),this.isShow=!1,e){egret.Tween.removeTweens(this._content);var i=-this._content.width;EndingLayer.single.showBookG(),egret.Tween.get(this._content).to({x:i},300).call(function(){t.parent&&t.parent.removeChild(t)},this)}else this.parent&&this.parent.removeChild(this)},t.prototype.destory=function(){e.prototype.destory.call(this)},t}(ViewBase);__reflect(RankLayer.prototype,"RankLayer");var RankNode=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.onTap=function(e){var t=this.data;GameConfig.nowUID=t.uid,console.log("GameConfig.nowUID ",GameConfig.nowUID),GameConfig.otherBook=!0;var i=game.AppFacade.getInstance();BackUtils.single.showIcon(ShowFrom.FROM_COVER,function(){GameConfig.otherBook&&GameConfig.formWork?(game.AppFacade.getInstance().sendNotification(CoursewareNotify.RANK_BACK_COVER),GameConfig.otherBook=!1,GameConfig.isOthers=!1,BackUtils.single.changeSytle(ShowFrom.FROM_RANK),GameConfig.fromCover?RankLayer.single.showPage(GameConfig.otherBookInfo,"works_rank"):RankLayer.single.showPage(GameConfig.otherBookInfo,"works_rank")):(game.AppFacade.getInstance().sendNotification(CoursewareNotify.RANK_BACK_COVER),GameConfig.otherBook=!1,GameConfig.isOthers=!1,BackUtils.single.changeSytle(ShowFrom.FROM_RANK),GameConfig.fromCover?RankLayer.single.showPage(GameConfig.otherBookInfo,"corver"):RankLayer.single.showPage(GameConfig.otherBookInfo,"quiz"))},this),i.sendNotification(CoursewareNotify.GET_RECORD,{id:GameConfig.otherBookInfo.id,from:"rank"})},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this._img.mask=this._mask,this._btnPlay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this)},t.prototype.dataChanged=function(){var t=this;e.prototype.dataChanged.call(this),console.log(this.data);var i=this.data,o=["rank_img_first","rank_img_second","rank_img_third"];this._rankIcon.visible=!1,this._rankLabel.visible=!1,i.rank<=3?(this._rankIcon.source=RES.getRes(o[i.rank-1]),this._rankIcon.visible=!0):(this._rankLabel.text=i.rank.toString(),this._rankLabel.visible=!0),this._img.source="",RES.getResByUrl(i.user_avatar,function(e){return t._img.source=e},this,RES.ResourceItem.TYPE_IMAGE),this._nameTxt.text=i.user_name,this._scoreTxt.text=i.score},t}(eui.ItemRenderer);__reflect(RankNode.prototype,"RankNode",["eui.UIComponent","egret.DisplayObject"]);var RankMediator=function(e){function t(t){return void 0===t&&(t=null),e.call(this,MyWorksMediator.NAME,t)||this}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.SHOW_MY_WORKS,CoursewareNotify.HIDE_MY_WORKS]},t.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CoursewareNotify.SHOW_MY_WORKS:this.showLayer();break;case CoursewareNotify.HIDE_MY_WORKS:this.hideLayer(t.destory)}},t.prototype.showLayer=function(){},t.prototype.hideLayer=function(e){},t.NAME="RankMediator",t}(puremvc.Mediator);__reflect(RankMediator.prototype,"RankMediator",["puremvc.IMediator","puremvc.INotifier"]);var BackUtils=function(){function e(){var e=GameLayerManager.gameLayer().toolLayer,t=new eui.Image;this._backIcon=t,t.source=RES.getRes("create_icon_back"),t.x=25,t.y=25,e.addChild(t),t.visible=!1,this._count=0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this);var i=window.dsBridge;i.register("handleBack",this.onHandle.bind(this));var o="4.1.3",r=P.getRecordProxy().getRequestHeader().Version.split("|")[0],n=GameConfig.compareVersion(o,r),s=-1!=n;this._canShow=s&&!GameConfig.isSrpg()}return Object.defineProperty(e,"single",{get:function(){return null==this._single?this._single=new e:this._single},enumerable:!0,configurable:!0}),e.prototype.onTap=function(){if(this._count>0){var e=this._doList.pop();e&&(e.self?e.call.call(e.self):e.call()),this.subCount()}else this.onCloseView()},e.prototype.subCount=function(){this._count--,this._count<=0&&this.hideIcon()},e.prototype.showIcon=function(e,t,i){void 0===i&&(i=null);var o=this._canShow;if(console.log("can Show ====",o),o){this.changeSytle(e),t&&(this._doList.push({call:t,self:i}),this._count++),this._backIcon.visible=!0;var r=window.dsBridge;r.call("read.pageLoaded",{hasNativeBar:!0,menuType:1,needHandleBack:!1,hasNativeBack:!1})}else this._doList=[],this._count=0,this._backIcon.visible=!1},e.prototype.onHandle=function(){this.onTap()},e.prototype.changeSytle=function(e,t){switch(void 0===t&&(t=!1),this._backIcon.x=this._backIcon.y=32,e){case ShowFrom.FROM_COVER:case ShowFrom.FROM_WORKS:case ShowFrom.FROM_RANK_END:this._backIcon.source=RES.getRes("create_icon_back");break;case ShowFrom.FROM_RANK:case ShowFrom.FROM_SCORE:case ShowFrom.FROM_SHARE:this._backIcon.source=RES.getRes("create_icon_back_white");break;case ShowFrom.FROM_QUIZ:this._backIcon.x=this._backIcon.y=16,this._backIcon.source=RES.getRes("page_icon_back2")}t&&(this._doList.pop(),this.subCount())},e.prototype.backToPrve=function(){this.onTap()},e.prototype.hideIcon=function(){this._doList=[],this._count=0,this._backIcon.visible=this._canShow,this._backIcon.source=RES.getRes("create_icon_back")},e.prototype.onCloseView=function(){console.log("onCloseView");var e=window.dsBridge;e.call("read.closeGoBack")},e}();__reflect(BackUtils.prototype,"BackUtils");var ShowFrom;!function(e){e[e.FROM_COVER=1]="FROM_COVER",e[e.FROM_WORKS=2]="FROM_WORKS",e[e.FROM_RANK=3]="FROM_RANK",e[e.FROM_SCORE=4]="FROM_SCORE",e[e.FROM_SHARE=5]="FROM_SHARE",e[e.FROM_QUIZ=6]="FROM_QUIZ",e[e.FROM_RANK_END=7]="FROM_RANK_END"}(ShowFrom||(ShowFrom={}));var LightUtils=function(e){function t(){var t=e.call(this)||this;return t.needDes=!1,t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.onEnter=function(){var e=(new Date).getTime(),t=e-this._startTime;if(this._pointer+1>=this._curList.length){var i=this._curList[this._curList.length-1];return void(t>=parseInt(i.cue_start_ms)+800&&(this.stop(),EventUtils.dispatchEvent(new egret.Event(CoursewareNotify.TEXT_RECOVER)),console.log("end")))}var o=this._curList[this._pointer+1];t>=parseInt(o.cue_start_ms)&&this.onPointerChange()},t.prototype.onPointerChange=function(){this._pointer++;var e=this._curList[this._pointer];this._pos+=e.word_text.length,EventUtils.dispatchEvent(new egret.Event(CoursewareNotify.TEXT_LIGHT,!1,!1,{word:e.word_text,pos:this._pos-e.word_text.length})),0!=this._pos&&this._pos++},t.prototype.start=function(){if(this.needDes&&!GameConfig.isOthers){var e=window.currentPageNum-1;this._curList=[],this._curList=P.getCoursewareProxy().textDes[e].sections[0].words.concat(),console.log("this._curList ====>>>>>",this._curList),this._textDic={},this._pointer=-1,this._startTime=(new Date).getTime(),this._pos=0,this.onPointerChange(),GameConfig.curStage().addEventListener(egret.Event.ENTER_FRAME,this.onEnter,this)}},t.prototype.stop=function(){this.needDes&&!GameConfig.isOthers&&(EventUtils.dispatchEvent(new egret.Event(CoursewareNotify.TEXT_RECOVER)),GameConfig.curStage().removeEventListener(egret.Event.ENTER_FRAME,this.onEnter,this))},Object.defineProperty(t.prototype,"pos",{set:function(e){this._pos=0},enumerable:!0,configurable:!0}),t}(egret.EventDispatcher);__reflect(LightUtils.prototype,"LightUtils");var ToolBarLayer=function(e){function t(){var t=e.call(this)||this;return t._playing=!1,t.skinName="ToolBar",t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.init=function(){e.prototype.init.call(this),this._readLs.itemRenderer=ToolReadNode,this._readST=new ScrollTab(this._readSl,this._readLs,RES.getRes("read_point_1"),RES.getRes("read_point_2")),this._recordLs.itemRenderer=ToolRecordNode,this._recordST=new ScrollTab(this._recordSl,this._recordLs,RES.getRes("read_point_1"),RES.getRes("read_point_2")),this._readG.addChild(this._readST),this._recordG.addChild(this._recordST),this._btnV=McFactory.getPlaySound("NewProject"),this._btnV1=McFactory.getPlaySound("NewProject"),this._btnV.frameRate=6,this._btnV1.frameRate=6,this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),this._btnVG.addChild(this._btnV),this._btnVG1.addChild(this._btnV1),this._btnV.x=44,this._btnV.y=44,this._btnV1.x=44,this._btnV1.y=44,this._timer=new egret.Timer(1e3,0);var t="4.1.3",i=P.getRecordProxy().getRequestHeader().Version.split("|")[0],o=GameConfig.compareVersion(t,i),r=-1!=o;this._scoreG.alpha=r?1:0,this._bg.cacheAsBitmap=!0,this._del=!0},t.prototype.show=function(){e.prototype.show.call(this)},t.prototype.onRecord=function(e){var t=this;return this._timerCount>=1&&this._timerCount<2?(this._tooltipLabel.text="录音时间太短",this._tooltip.visible=!0,-1!=this._timeOut&&egret.clearTimeout(this._timeOut),void(this._timeOut=egret.setTimeout(function(){t._tooltip.visible=!1},this,1e3))):void(P.getRecordProxy().recording?this.stop():this.start())},t.prototype.start=function(){if(console.log("P.getRecordProxy().recording",P.getRecordProxy().recording,GameConfig.isBack),!P.getRecordProxy().recording&&GameConfig.isBack&&this._del){P.getRecordProxy().recording=!0,this._rBtn.source=RES.getRes("page_icon_recording_board"),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3);var e=DBFactory.getYinboAnimate("yinbo_huiben");e.alpha=1,this._effectG.addChild(e),e.x=this._effectG.width/2,e.y=this._effectG.height/2,this._yinbo=e,e.animation.play("yinbo_huiben",0),this._readST.index=0,this._recordST.index=0,this.startTimer(),RecordUtils.single.start(this._pageData,this._txt,this._maxScore)}},t.prototype.onTimer=function(e){this._timerCount++,this._timeOut=-1,this._timerCount>5&&(this._tooltipLabel.text="点击按钮结束配音",this._tooltip.visible=!0,this._timer.stop())},t.prototype.startTimer=function(){this._timerCount=1,this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.reset(),this._timer.start()},t.prototype.stopTimer=function(){this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.stop()),this._tooltip.visible=!1,this._timerCount=0,this._timeOut=-1},t.prototype.stop=function(){P.getRecordProxy().recording&&(this._rmask.visible=!0,RecordUtils.single.stop())},t.prototype.stopRecord=function(e,t){var i=this;if(void 0===t&&(t=-1),this._del=!1,P.getRecordProxy().recording&&(this.removeYinbo(),console.log("stop call"),e)){var o=DBFactory.getScoreAnimate("defen_huiben");o.alpha=1,GameLayerManager.gameLayer().effectLayer.addChild(o),o.x=GameConfig.curWidth()/2,o.y=GameConfig.curHeight()/2;var r=RES.getRes("xing_lizi_png"),n=RES.getRes("xing_lizi_json"),s=new particle.GravityParticleSystem(r,n);s.x=GameConfig.curWidth()/2-450,s.y=GameConfig.curHeight()/2-280;var a=this.createLable(t.toString());a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=GameConfig.curWidth()/2,a.y=GameConfig.curHeight()/2,GameLayerManager.gameLayer().effectLayer.addChild(a),a.scaleX=a.scaleY=0,GameLayerManager.gameLayer().effectLayer.addChild(s);var h=!0,c=!0,l=!0,u=!0,d=function(){o.animation.lastAnimationState.currentTime>=.42&&h&&(h=!1,s.start()),o.animation.lastAnimationState.currentTime>=.52&&c&&(c=!1,s.stop()),o.animation.lastAnimationState.currentTime>=1.45&&u&&(u=!1,egret.Tween.get(a).to({scaleY:0,scaleX:0},300)),o.animation.lastAnimationState.currentTime>=1.65&&l&&(l=!1,s.stop(!0),GameLayerManager.gameLayer().effectLayer.removeChild(a),GameLayerManager.gameLayer().effectLayer.removeChild(o),GameLayerManager.gameLayer().effectLayer.removeChild(s),i.removeEventListener(egret.Event.ENTER_FRAME,d,i),i._del=!0)};this.addEventListener(egret.Event.ENTER_FRAME,d,this),egret.Tween.get(a).to({scaleY:1,scaleX:1},300),o.animation.play("defen_huiben",1),console.log("play sound");var g=ZipUtils.single.getSound("getscore_mp3");g.play(0,1)}},t.prototype.removeYinbo=function(){this.stopTimer(),this._yinbo&&(this._yinbo.animation.stop(),this._effectG.removeChildren())},t.prototype.createLable=function(e){var t=new eui.Group;t.width=t.height=128;var i=new eui.Label;i.textColor=6438947,i.size=110,i.bold=!0,i.text=e,i.x=(t.width-i.width)/2,i.y=(t.height-i.height)/2-30;var o=new eui.Label;return o.textColor=6438947,o.size=30,o.bold=!0,o.text="录音得分",o.x=(t.width-o.width)/2,o.y=i.y+i.height+5,t.addChild(i),t.addChild(o),t},t.prototype.onPlay=function(e){var t=this;if(this._playing)AudioPlayer.getInstance().stop(),this._playing=!1,this._btnP.source=RES.getRes("page_icon_play");else{this._playing=!0;var i=window.currentPageNum-1,o=P.getCoursewareProxy().getCourseWareData(),r=o[i];console.log(r,"info");var n=P.getRecordProxy().getRecordList();console.log(n,"recordList");var s=n.filter(function(e){return e.page_id===r.id})[0];console.log(s,"recordData"),this._btnP.source=RES.getRes("page_icon_read"),AudioPlayer.getInstance().play(s.audio+"?v="+(new Date).getTime(),function(){t._playing=!1,t._btnP.source=RES.getRes("page_icon_play")},self)}},t.prototype.addEvent=function(){e.prototype.addEvent.call(this),this._readST&&this._readST.addEvent(),this._recordST&&this._recordST.addEvent(),this._rBtn.touchEnabled=!0,this._rBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this._btnP.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlay,this),this._btnVG.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onsound1,this),this._btnVG1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onsound,this),EventUtils.addEventListener(CoursewareNotify.NEXT_PAGE,this.onNext,this)},t.prototype.onsound=function(e){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,r,n,s=this;return __generator(this,function(a){switch(a.label){case 0:return this._soundPlaying?[2]:(this._soundPlaying=!0,this._soundTo=egret.setTimeout(function(){s._soundPlaying=!1},this,1e3),AudioPlayer.getInstance().stop(),e=window.currentPageNum-1,t=P.getCoursewareProxy().getCourseWareData(),i=t[e],console.log(i,"info"),o=P.getRecordProxy().getRecordList(),console.log(o,"recordList"),r=o.filter(function(e){return e.page_id===i.id})[0],console.log(r,"recordData"),(GameConfig.isOthers||GameConfig.isSrpg())&&r&&r.audio&&""!=r.audio?(this._btnV.gotoAndPlay(0,-1),this._btnV1.gotoAndPlay(0,-1),[4,AudioPlayer.getInstance().play(r.audio+"?v="+(new Date).getTime())]):[3,2]);case 1:return a.sent(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),[3,4];case 2:return n=this._readST.selectItem(),n&&n.audio&&n.audio.url&&""!=n.audio.url?(this._btnV.gotoAndPlay(0,-1),this._btnV1.gotoAndPlay(0,-1),this._readST.index=0,this._recordST.index=0,LightUtils.single.start(),[4,AudioPlayer.getInstance().play(n.audio.url)]):[3,4];case 3:a.sent(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),a.label=4;case 4:return[2]}})})},t.prototype.onsound1=function(e){return __awaiter(this,void 0,void 0,function(){var e,t,i,o,r,n,s=this;return __generator(this,function(a){switch(a.label){case 0:return this._soundPlaying?[2]:(this._soundPlaying=!0,this._soundTo=egret.setTimeout(function(){s._soundPlaying=!1},this,1e3),AudioPlayer.getInstance().stop(),e=window.currentPageNum-1,t=P.getCoursewareProxy().getCourseWareData(),i=t[e],console.log(i,"info"),o=P.getRecordProxy().getRecordList(),console.log(o,"recordList"),r=o.filter(function(e){return e.page_id===i.id})[0],console.log(r,"recordData"),GameConfig.isOthers&&r&&r.audio&&""!=r.audio?(this._btnV.gotoAndPlay(0,-1),this._btnV1.gotoAndPlay(0,-1),[4,AudioPlayer.getInstance().play(r.audio+"?v="+(new Date).getTime())]):[3,2]);case 1:return a.sent(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),[3,4];case 2:return n=this._recordST.selectItem(),n&&n.audio&&n.audio.url&&""!=n.audio.url?(this._btnV.gotoAndPlay(0,-1),this._btnV1.gotoAndPlay(0,-1),this._readST.index=0,this._recordST.index=0,LightUtils.single.start(),[4,AudioPlayer.getInstance().play(n.audio.url)]):[3,4];case 3:a.sent(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),a.label=4;case 4:return[2]}})})},t.prototype.onTou=function(e){e.target.visible=!1},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this),this._readST&&this._readST.removeEvent(),this._recordST&&this._recordST.removeEvent(),this._rBtn.touchEnabled=!1,this._rBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRecord,this),this._btnP.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlay,this),this._btnVG.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onsound1,this),this._btnVG1.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onsound,this),EventUtils.removeEventListener(CoursewareNotify.NEXT_PAGE,this.onNext,this)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);GameConfig.curWidth(),GameConfig.curHeight();this.parent&&(this.y=this.parent.height-this.height)},t.prototype.destory=function(){e.prototype.destory.call(this)},t.prototype.updata=function(e){var t=this;this._soundPlaying=!1,AudioPlayer.getInstance().stop(),this._playList=[],this._txtIndex=[],this._pageData=e,console.log("this._pageData",this._pageData),this._readG.visible=!1,this._recordG.visible=!1;var i=P.getCoursewareProxy().getCsInfo();console.log(i,"123"),"record"==this._type&&i.level<=6?(this._recordG.visible=!0,this._rT.visible=!1,this._bg.visible=!1,this._recordST.visible=!1,"txtPaging"==e.typesetting&&(this._rT.visible=!0,this._bg.visible=!0,this._recordST.visible=!0)):this._readG.visible=!0;var o=[],r=0;e.objects.forEach(function(e,i){if(e=__assign({},e),"i-text"===e.type||"textbox"===e.type){var n=e.text;if(n=n.replace(/[\r\n]/g,""),console.log("txt ==="+n,n.indexOf("\n"),n.length),n.length>45){for(var s=n.split(" "),a=[],h=s.length,c="",l="record"==t._type?45:61,u=0;h>u;u++){var d=s[u];console.log(d,"+",d.length,"+",c.length),c.length+d.length>=l&&(a.push(c),c=""),c+=s[u]+" "}if(a.push(c),a.length<=2)console.log("换行"),e.text=a.join("\n"),o.push(e),r++;else for(var g=Math.ceil(a.length/2),p=0,d=0;g>d;p+=2,d++){var f=t.copyObj(e),_=a[p+1]?"\n"+a[p+1]:"";f.text=a[p]+_,o.push(f),r++}}else e.text=n,o.push(e),r++;t._txtIndex.push(r)}}),this._txtIndex.shift();var n=o.length;this._txt="";for(var s=0;n>s;s++){var a=o[s].text;this._txt+=" "+a,o[s].index=s}console.log("this._txtIndex ===",this._txtIndex),console.log(o),this._readST.updata(o),this._recordST.updata(o),this._playList&&this._playList.length&&this.playLoopSound(0)},t.prototype.playAudio=function(e,t,i,o){this._playList=e,this._needGuide=t,this._completeBack=i,this._thisObj=o,this._txtIndex&&this.playLoopSound(0)},t.prototype.playLoopSound=function(e){return __awaiter(this,void 0,void 0,function(){var t,t;return __generator(this,function(i){switch(i.label){case 0:return console.log("this._playList.length === ",this._playList.length,window.currentPageNum),!this._playList.length||P.getRecordProxy().recording?[2]:(this._btnV.gotoAndPlay(0,-1),this._btnV1.gotoAndPlay(0,-1),LightUtils.single.start(),[4,AudioPlayer.getInstance().play(this._playList[e].url)]);case 1:return i.sent(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),e<this._playList.length-1?(this._txtIndex.length&&("record"==this._type?(t=this._txtIndex.shift()-1,this._recordST.index=t):(t=this._txtIndex.shift()-1,this._readST.index=t)),this.playLoopSound(e+=1)):(console.log("this._completeBack",this._completeBack,this._needGuide),this._completeBack&&this._completeBack.call(this._thisObj,this._needGuide),this._playList=null,this._txtIndex=null),[2]}})})},t.prototype.setIconStatus=function(){this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3)},t.prototype.copyObj=function(e){var t={};return t.text=e.text,t.fill=e.fill,t.fontFamily=e.fontFamily,t.fontSize=e.fontSize,t.textAlign=e.textAlign,t.lineHeight=e.lineHeight,t.fontStyle=e.fontStyle,t.fontWeight=e.fontWeight,t.audio=e.audio,e.stroke&&(t.strokeWidth=e.strokeWidth,t.stroke=e.stroke),t},t.prototype.showTool=function(e,t,i){this._type=e,i.addChild(this),this.stopTimer(),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),this._rmask.visible=!1,this.updata(t),this.onViewResize(),this.visible=!0},t.prototype.hideTool=function(){this.visible=!1,this.parent&&this.parent.removeChild(this),this._playList=[],egret.clearTimeout(this._soundTo),this._btnV.gotoAndStop(3),this._btnV1.gotoAndStop(3),AudioPlayer.getInstance().stop()},t.prototype.showText=function(e,t){var i=this;void 0===t&&(t=!0),-1!=this._timeOut&&egret.clearTimeout(this._timeOut),this._tooltip.visible=!0,this._tooltipLabel.text=e,t&&(this._timeOut=egret.setTimeout(function(){i._tooltip.visible=!1},this,2500))},t.prototype.onUplaodResult=function(e){if(e&&!GameConfig.changePage){var t="点击按钮可重新配音";this.showText(t)}GameConfig.changePage=!1},t.prototype.updatBtn=function(e){this.removeYinbo(),this._rBtn.source=RES.getRes("page_icon_replay"),this._socreTxt.text=e.toString(),this._maxScore=e},t.prototype.setPlayBtn=function(){var e=window.currentPageNum-1,t=P.getCoursewareProxy().getCourseWareData(),i=t[e];console.log(i,"info");var o=P.getRecordProxy().getRecordList();console.log(o,"recordList");var r=o.filter(function(e){return e.page_id===i.id})[0];console.log(r,"recordData"),this._maxScore=0,this._playG.visible=!1,r&&r.audio&&""!=r.audio?(this._rBtn.source=RES.getRes("page_icon_replay"),this._playG.visible=!0,this._btnP.source=RES.getRes("page_icon_play"),RecordUtils.single.old||(this._scoreG.visible=!0,this._socreTxt.text=r.score,this._maxScore=r.score)):this._rBtn.source=RES.getRes("page_icon_record"),this._rmask.visible=!1,console.log(e)},t.prototype.onNext=function(e){var t=e.data;switch(console.log("from === ",t),t){case"read":this._readST.index++;break;case"record":this._recordST.index++}},Object.defineProperty(t.prototype,"readST",{get:function(){return this._readST},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"recordST",{get:function(){return this._recordST},enumerable:!0,configurable:!0}),t}(ViewBase);__reflect(ToolBarLayer.prototype,"ToolBarLayer");var ToolReadNode=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdd,t),t}return __extends(t,e),t.prototype.onAdd=function(e){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.addEvent()},t.prototype.onRemove=function(e){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEvent()},t.prototype.addEvent=function(){EventUtils.addEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.addEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.removeEvent=function(){EventUtils.removeEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.removeEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.onTextLight=function(e){var t=e.data.word,i=e.data.pos,o=this._txtCopy,r=o.indexOf(t,i);if(-1!=r&&this.data.index==ToolBarLayer.single.readST.index){var n=r+t.length,s=o.substring(0,r),a=o.substring(r,n+1),h=o.substring(n+1);if(this._readTxt.textFlow=[{text:s,style:{textColor:this._color}},{text:a,style:{textColor:16423680}},{text:h,style:{textColor:this._color}}],h.length<=1){var c=/^[A-Za-z]+$/;c.test(h)||(EventUtils.dispatchEvent(new egret.Event(CoursewareNotify.NEXT_PAGE,!1,!1,"read")),LightUtils.single.pos=0)}}},t.prototype.onTextRecover=function(e){this._readTxt.textFlow=[],this._readTxt.text=this._txtCopy,this._readTxt.textColor=this._color},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this._readTxt,i=this.data;console.log(i.text),this._txtCopy=i.text,this._readTxt.text=this._txtCopy,this._color=t.textColor=i.fill.replace(/#/,"0x"),t.fontFamily=i.fontFamily,t.size=44,t.verticalAlign=egret.VerticalAlign.TOP,t.lineSpacing=t.size*i.lineHeight*.2,t.italic="italic"==i.fontStyle?!0:!1,t.bold="bold"==i.fontWeight?!0:!1,i.stroke&&(t.stroke=i.strokeWidth,t.strokeColor=i.stroke),console.log("data.text.indexOf('\n'')",i.text.indexOf("\n")),-1==i.text.indexOf("\n")&&(t.size=46,t.verticalAlign=egret.VerticalAlign.MIDDLE)},t}(eui.ItemRenderer);__reflect(ToolReadNode.prototype,"ToolReadNode",["eui.UIComponent","egret.DisplayObject"]);var To=egret.tween.To,ToolRecordNode=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAdd,t),t}return __extends(t,e),t.prototype.onAdd=function(e){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.addEvent()},t.prototype.onRemove=function(e){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemove,this),this.removeEvent()},t.prototype.addEvent=function(){EventUtils.addEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.addEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.removeEvent=function(){EventUtils.removeEventListener(CoursewareNotify.TEXT_LIGHT,this.onTextLight,this),EventUtils.removeEventListener(CoursewareNotify.TEXT_RECOVER,this.onTextRecover,this)},t.prototype.onTextLight=function(e){var t=e.data.word,i=e.data.pos,o=this._txtCopy,r=o.indexOf(t,i);if(-1!=r&&this.data.index==ToolBarLayer.single.recordST.index){var n=r+t.length,s=o.substring(0,r),a=o.substring(r,n+1),h=o.substring(n+1);if(this._recordTxt.textFlow=[{text:s,style:{textColor:this._color}},{text:a,style:{textColor:16423680}},{text:h,style:{textColor:this._color}}],h.length<=1){var c=/^[A-Za-z]+$/;c.test(h)||(EventUtils.dispatchEvent(new egret.Event(CoursewareNotify.NEXT_PAGE,!1,!1,"record")),LightUtils.single.pos=0)}}},t.prototype.onTextRecover=function(e){this._recordTxt.textFlow=[],this._recordTxt.text=this._txtCopy,this._recordTxt.textColor=this._color},t.prototype.partAdded=function(t,i){e.prototype.partAdded.call(this,t,i)},t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.dataChanged=function(){e.prototype.dataChanged.call(this);var t=this._recordTxt,i=this.data;this._txtCopy=i.text,this._recordTxt.text=this._txtCopy,this._color=t.textColor=i.fill.replace(/#/,"0x"),t.fontFamily=i.fontFamily,t.size=44,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.lineSpacing=t.size*i.lineHeight*.2,t.italic="italic"==i.fontStyle?!0:!1,t.bold="bold"==i.fontWeight?!0:!1,console.log("displayObj.bold",t.bold),i.stroke&&(t.stroke=i.strokeWidth,t.strokeColor=i.stroke),-1==i.text.indexOf("\n")&&i.text.length<40&&(t.size=46)},t}(eui.ItemRenderer);__reflect(ToolRecordNode.prototype,"ToolRecordNode",["eui.UIComponent","egret.DisplayObject"]);var tr=egret.sys.tr,RecordUtils=function(){function e(){this._sum=0,this._total=2;var e=window.dsBridge,t="4.1.3",i=P.getRecordProxy().getRequestHeader().Version.split("|")[0],o=GameConfig.compareVersion(t,i),r=-1!=o;this.old=!r,this.dsBridge=e,this._uploadTime=0,this.dsBridge.register("recordComplete",this.onUploadComplete.bind(this)),this.dsBridge.register("evaluatingResultCode",this.onEvaluatingResult.bind(this))}return Object.defineProperty(e,"single",{get:function(){return null==this._single?this._single=new e:this._single},enumerable:!0,configurable:!0}),e.prototype.onEvaluatingResult=function(e){e=JSON.parse(e);var t=e.code;switch(console.log("静默截停  code ==== ",t),t){case 2:ToolBarLayer.single.stop(),console.log("静默截停  code ==== 后置静音");break;case 1:P.getRecordProxy().recording&&TipsLayer.single.showTips(GameLayerManager.gameLayer().maskLayer,ShowType.TYPE_RECORD_FAILE),this.cancel(),GameConfig.uploadEnd=!0,console.log("静默截停  code ==== 前置静音")}},e.prototype.resetTime=function(){this._uploadTime=0},e.prototype.start=function(e,t,i){this._maxScore=0,this._pageData=e,this._pageScore=i,console.log("this._pageScore ====",this._pageScore,i),GameConfig.uploadEnd=!0,this._uploadTime++,console.log("----- startRecord ----- pageData 1 = >>>>>>>",this._pageData,"text ===",t),AudioPlayer.getInstance().stop(),AudioPlayer.getInstance().setMute(!0),LightUtils.single.stop(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.START_MY_RECORD);var o={},r=P.getCoursewareProxy().getCsInfo();if(this.old)o.id=e.id,o.tid=e.id,o.readbook_id=r.id,o.timeout=40,o.type=0;else{this.registerGetVolume(this.getVolume,this),this.registerProcessRecord(this.processRecord,this),this.registerStopRecord(this.onStop,this),t=RegUtils.cTrim(t,0),this._type=t.split(" ").length>1?"sentence":"world",this._stopTime=0;var n=t.length;10>=n?this._stopTime=1:n>10&&30>=n?this._stopTime=2:this._stopTime=3,o.read_content=t,o.read_type=this._type,o.id=e.id,o.tid=e.id,o.readbook_id=r.id,o.timeout=40,o.type=1,o.count=0,console.log("start record new",this._type)}this._uploadResult=!1,this._sum=0,this.startRecord(o)},e.prototype.recordNote=function(){console.log("this._sum",this._sum),this._sum++,this._sum>=this._total&&(this._uploadTime--,this._uploadTime<=0&&(GameConfig.uploadEnd=!0),P.getRecordProxy().recording=!1,ToolBarLayer.single.onUplaodResult(this._uploadResult))
},e.prototype.stop=function(){if(P.getRecordProxy().recording){var e={};e.id=this._pageData.id,e.readbook_id=e.id,this.old?(e.type=0,console.log("stop record old")):(e.type=1,console.log("stop record new")),this._uploadTime>0&&(GameConfig.uploadEnd=!1),this.stopRecord(e)}},e.prototype.cancel=function(){if(P.getRecordProxy().recording){var e={};e.id=this._pageData.id,e.readbook_id=e.id,this.old?(e.type=0,console.log("cancel record old")):(e.type=1,console.log("cancel record new")),this.cancelRecord(e),this.onCancel()}},e.prototype.onCancel=function(){P.getRecordProxy().recording=!1,console.log("----- onCancel"),AudioPlayer.getInstance().setMute(!1),ToolBarLayer.single.removeYinbo(),this.old||(this.unregisterGetVolume(),this.unregisterProcessRecord(),this.unregisterStopRecord()),this._uploadTime=0,ToolBarLayer.single.setPlayBtn()},e.prototype.getVolume=function(e,t){console.log("get volume",e,t),console.log(e,t)},e.prototype.processRecord=function(e){console.log("--------- processRecord : ",e,this._type),console.log("--------- data.result : ",e.result),e=JSON.parse(e),e.tid==this._pageData.id},e.prototype.onUploadComplete=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o;return __generator(this,function(r){switch(r.label){case 0:return console.log("----- onUploadComplete",e),e&&(e=JSON.parse(e)),e&&e.url&&""!=e.url?(e.tid=this._pageData.id,e.score=e.score&&e.score>this._maxScore?e.score:this._maxScore,t=e.score,[4,P.getRecordProxy().uploadRecordItem(P.getCoursewareProxy().getCsInfo().id,e.tid,e.url,t)]):[3,2];case 1:return i=r.sent(),console.log("updata audio",i),0===i.code&&(o={audio:e.url,page_id:e.tid,score:t},P.getRecordProxy().setRecordItem(o,"add")),egret.setTimeout(function(){TipsLayer.single.isShow&&(TipsLayer.single.hideTips(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_NEXT))},this,700),[3,3];case 2:this._uploadTime<=1&&TipsLayer.single.showTips(GameLayerManager.gameLayer().maskLayer,ShowType.TYPE_FAILE),r.label=3;case 3:return this.old&&(AudioPlayer.getInstance().setMute(!1),ToolBarLayer.single.updatBtn(this._maxScore),P.getRecordProxy().recording=!1),this._uploadTime--,this._uploadTime<=0&&(ToolBarLayer.single.setPlayBtn(),this._uploadTime=0,GameConfig.uploadEnd=!0,this._uploadResult=!0,ToolBarLayer.single.onUplaodResult(this._uploadResult),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SOUND_COMPELETE)),[2]}})})},e.prototype.onStop=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n,s;return __generator(this,function(a){return console.log("----- stopRecord",e),AudioPlayer.getInstance().setMute(!1),e&&(e=JSON.parse(e)),e&&1==e.code&&(e.tid=this._pageData.id,e.tid==this._pageData.id&&(console.log("onn stop ===...",e.score,this._maxScore),e.score=e.score>=this._maxScore?e.score:this._maxScore,this._maxScore=e.score,console.log("stop record",this._maxScore))),ToolBarLayer.single.stopRecord(!0,this._maxScore),this.old||(this.unregisterGetVolume(),this.unregisterProcessRecord(),this.unregisterStopRecord()),t="4.2.0",i=P.getRecordProxy().getRequestHeader().Version.split("|")[0],o=GameConfig.compareVersion(t,i),r=-1!=o,r?(n={},s=!0,this._pageScore>this._maxScore?(s=!1,GameConfig.uploadEnd=!0,this.onCancel(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SOUND_COMPELETE)):(this._pageScore=this._maxScore,ToolBarLayer.single.updatBtn(this._maxScore)),n.needUplaod=s,this.requestUpload(n)):(this._pageScore=this._maxScore,ToolBarLayer.single.updatBtn(this._maxScore)),P.getRecordProxy().recording=!1,[2]})})},e.prototype.requestUpload=function(e){console.log("read.requestUpload",e),this.dsBridge.call("read.requestUpload",e)},e.prototype.startRecord=function(e){var t=this;console.log("read.startRecord",e),this.dsBridge.call("read.startRecord",e,function(e){console.log(e),e||t.onStop(null)})},e.prototype.cancelRecord=function(e){this.old?console.log("cancel old"):console.log("cancel new"),console.log("read.cancelRecord",e),this.dsBridge.call("read.cancelRecord",e)},e.prototype.stopRecord=function(e){console.log("read.stopRecord",e),this.dsBridge.hasNativeMethod("read.stopRecord")&&this.dsBridge.call("read.stopRecord",e)},e.prototype.registerProcessRecord=function(e,t){var i=function(i){e&&e.apply(t,arguments)};this.dsBridge.register("realSendScore",i)},e.prototype.unregisterProcessRecord=function(){var e=function(e){};this.dsBridge.register("realSendScore",e)},e.prototype.registerStopRecord=function(e,t){var i=function(i){e&&e.apply(t,arguments)};this.dsBridge.register("stopRecord",i)},e.prototype.unregisterStopRecord=function(){var e=function(e){};this.dsBridge.register("stopRecord",e)},e.prototype.registerGetVolume=function(e,t){var i=function(i,o){e&&e.apply(t,arguments)};this.dsBridge.register("getVolume",i)},e.prototype.unregisterGetVolume=function(){var e=function(e,t){};this.dsBridge.register("getVolume",e)},e}();__reflect(RecordUtils.prototype,"RecordUtils");var ToolBarMediator=function(e){function t(i){return void 0===i&&(i=null),e.call(this,t.NAME,i)||this}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.SWAP_PAGE,CoursewareNotify.CANCEL_RECORD]},t.prototype.handleNotification=function(e){var t=(e.getBody(),window.currentPageNum);switch(e.getName()){case CoursewareNotify.SWAP_PAGE:AudioPlayer.getInstance().setMute(!1);var i=P.getRecordProxy().getRecordList();i.filter(function(e){return e.page_id===t})[0];ToolBarLayer.single.setPlayBtn()}},t.prototype.showLayer=function(){var e=(GameLayerManager.gameLayer().worksLayer,GameLayerManager.gameLayer().panelLayer);e.removeChildren()},t.prototype.hideLayer=function(e){},t.NAME="ToolBarMediator",t}(puremvc.Mediator);__reflect(ToolBarMediator.prototype,"ToolBarMediator",["puremvc.IMediator","puremvc.INotifier"]);var Avator=function(e){function t(){var t=e.call(this)||this;return t.radius=34,t._url="",t.boderColor=16777215,t.fillColor=15658734,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStageHandler,t),t}return __extends(t,e),t.prototype.onAddToStageHandler=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){return egret.callLater(t,e)})];case 1:return t.sent(),this.image=new eui.Image,this.image.width=this.image.height=this.radius-4,this.background=new eui.Rect(this.radius,this.radius,this.fillColor),this.background.strokeColor=this.boderColor,this.background.strokeWeight=2,this.background.ellipseWidth=this.background.explicitHeight=2*this.radius,this.background.x=this.background.y=-2,this.imageMask=new eui.Rect(this.radius-4,this.radius-4,16711680),this.imageMask.ellipseWidth=this.imageMask.explicitHeight=2*this.radius,this.addChild(this.background),this.addChild(this.imageMask),this.addChild(this.image),this.image.mask=this.imageMask,this.url&&RES.getResByUrl(""+this.url+Global.webpSuffix,function(t){return e.image.source=t},this,"image"),[2]}})})},Object.defineProperty(t.prototype,"url",{get:function(){return this._url},set:function(e){var t=this;this._url=e,this.image&&RES.getResByUrl(""+this.url+Global.webpSuffix,function(e){return t.image.source=e},this,"image")},enumerable:!0,configurable:!0}),t}(eui.Component);__reflect(Avator.prototype,"Avator");var RecordBar=function(e){function t(){var t=e.call(this)||this;return t.starsNum=0,t.addEventListener(eui.UIEvent.COMPLETE,t.createCompleteEvent,t),t.skinName="resource/ui/courseware/RecordBarSkin.exml",t.visible=!1,t}return __extends(t,e),t.prototype.createCompleteEvent=function(e){var t=this,i=this;i.removeEventListener(eui.UIEvent.CREATION_COMPLETE,i.createCompleteEvent,i),i.recordPlay.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return i.playUrl?(i.showRecordPlayingAnim(),[4,AudioPlayer.getInstance().play(i.playUrl,function(){i.hideRecordPlayingAnim()},i)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},i),i.resetBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.currentState="normal",i.hideRecordPlayingAnim()},i);var o=new FrameAnim(RES.getRes("read_playback_a1")),r={};r.frameRate=260,r.anims=["read_playback_a1","read_playback_a2","read_playback_a3"],o.initAnims(r),o.x=i.recordPlay.x,o.y=i.recordPlay.y,i.addChild(o),i.m_playingRecordAnim=o,i.m_playingRecordAnim.visible=!1},t.prototype.showTooltip=function(e){this.tooltip.visible=!0,this.tooltipLabel.text=e},t.prototype.hiddenTooltip=function(){this.tooltip.visible=!1},t.prototype.setRecordInfo=function(e){void 0===e&&(e={}),this.playUrl=e.audio?e.audio+"?v="+(new Date).getTime():e.audio,this.recordPlay.source=this.playUrl?RES.getRes("read_record_json.read_playback"):RES.getRes("read_record_json.read_playback_not")},t.prototype.showRecordPlayingAnim=function(){var e=this;e.m_playingRecordAnim&&(e.m_playingRecordAnim.visible=!0,e.m_playingRecordAnim.playAnim(!0))},t.prototype.hideRecordPlayingAnim=function(){var e=this;e.m_playingRecordAnim&&(e.m_playingRecordAnim.stopAnim(),e.m_playingRecordAnim.visible=!1)},t.prototype.show=function(){this.visible=!0},t.prototype.hidden=function(){this.visible=!1},t}(eui.Component);__reflect(RecordBar.prototype,"RecordBar");var StarsBar=function(e){function t(){var t=e.call(this)||this;return t.starsNum=0,t.addEventListener(eui.UIEvent.COMPLETE,t.createCompleteEvent,t),t.skinName="resource/ui/coverlayer/StarsBarSkin.exml",t}return __extends(t,e),t.prototype.createCompleteEvent=function(e){this.removeEventListener(eui.UIEvent.CREATION_COMPLETE,this.createCompleteEvent,this)},t.prototype.removeStars=function(){this.starsNum=0,this.starsGroup.removeChildren();var e=this;egret.Tween.removeTweens(e)},t.prototype.showStars=function(e,t,i){void 0===t&&(t=function(){}),void 0===i&&(i=!0),this.removeStars(),this.addStars(e,t,i)},t.prototype.addStars=function(e,t,i){void 0===t&&(t=function(){}),void 0===i&&(i=!0)},t.prototype.hideBg=function(){this._bg.visible=!1},t}(eui.Component);__reflect(StarsBar.prototype,"StarsBar");var TipsLayer=function(e){function t(){var t=e.call(this)||this;return t._r=12,t.init(),t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.init=function(){var e=new egret.Shape;this._bg=e;var t=GameConfig.curWidth(),i=GameConfig.curHeight();e.graphics.beginFill(0,.5),e.graphics.drawRect(0,0,t,i),e.graphics.endFill(),this.addChild(e);var o=new eui.Image;this._img=o,o.source=RES.getRes("view_bg_upload"),this.addChild(o);var r=new eui.Image;this._btnKnow=r,r.source=RES.getRes("btn_know"),this.addChild(r);var n=new eui.Image;this._close=n,n.source=RES.getRes("create_view_icon_close1"),this.addChild(n);var s=new eui.Label;this._txt=s,s.width=t,s.textAlign=egret.HorizontalAlign.CENTER,s.size=32,s.text="宝贝，你的录音\n马上就要上传成功咯！",s.textColor=0,s.fontFamily="FZLanTYJW_ZhongCu",s.lineSpacing=8,this.addChild(s),s.y=450,this.initCircle()},t.prototype.updata=function(e){var t=this._img,i=this._close,o=GameConfig.curWidth(),r=GameConfig.curHeight();switch(this._sound&&this._soundCancel&&this._soundCancel.stop(),this._txt.size=32,i.visible=!0,e){case ShowType.TYPE_FAILE:t.source=RES.getRes("view_bg_wifi"),this._txt.text="网络开小差啦！\n上传失败，再录一次吧！",this._sound=ZipUtils.single.getSound("faile_mp3"),this._soundCancel=this._sound.play(0,1);break;case ShowType.TYPE_UPLOADING:t.source=RES.getRes("view_bg_upload"),this._txt.text="宝贝，你的录音\n马上就要上传成功咯！",this._txt.y=520,this._sound=ZipUtils.single.getSound("uploading_mp3"),this._soundCancel=this._sound.play(0,1),this.showCircle();break;case ShowType.TYPE_DOWNLOAD:AudioPlayer.getInstance().stop(),t.source=RES.getRes("view_bg_new"),this._txt.size=36,this._txt.text="下载新版本，宝贝的配音\n就能在评分后，登上排行榜咯！",this._txt.y=520,this._sound=ZipUtils.single.getSound("download_new_mp3"),this._soundCancel=this._sound.play(0,1),this._btnKnow.visible=!0,this._btnKnow.x=(o-this._btnKnow.width)/2,i.visible=!1;break;case ShowType.TYPE_RECORD_FAILE:t.source=RES.getRes("view_bg_record"),this._txt.text="",this._sound=ZipUtils.single.getSound("record_faile_mp3"),this._soundCancel=this._sound.play(0,1)}t.x=(o-t.width)/2,t.y=(r-t.height)/2,i.x=t.x+t.width+20,i.y=t.y,e==ShowType.TYPE_FAILE?this._txt.y=t.y+t.height-this._txt.height-30:e==ShowType.TYPE_UPLOADING?this._txt.y=t.y+t.height-this._txt.height-90:e==ShowType.TYPE_DOWNLOAD&&(this._btnKnow.y=t.y+t.height-this._btnKnow.height-60,this._txt.y=this._btnKnow.y-this._txt.height-40),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._btnKnow.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this)},t.prototype.onClose=function(e){this.hideTips()},t.prototype.showTips=function(e,t){this.isShow=!0,this._type=t,this.hideCircle(),this._btnKnow.visible=!1,e.addChild(this),this.updata(t)},t.prototype.hideTips=function(){this.parent&&this.parent.removeChild(this),this.isShow=!1,this._type=-1,this._close.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._btnKnow.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClose,this),this._timer&&(this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.stop()),this._sound&&this._soundCancel&&this._soundCancel.stop()},t.prototype.initCircle=function(){this._circleList=[],this._rGroup=new eui.Group,this._rGroup.width=this._rGroup.height=120,this._center=new egret.Point(this._rGroup.width/2,this._rGroup.height/2),this.addChild(this._rGroup),this._rGroup.visible=!1;var e=this._r;this._speed=this._rGroup.width/2-10;for(var t=[0,40,80,120,160,200,240,280,320],i=0;7>i;i++){var o=e-1.5*i,r=new egret.Shape;r.graphics.beginFill(3129754),r.graphics.drawCircle(0,0,o),r.graphics.endFill(),this._rGroup.addChild(r);var n=t[i];r.x=this._center.x+Math.sin(n/180*Math.PI)*this._speed,r.y=this._center.y-Math.cos(n/180*Math.PI)*this._speed,this._circleList.push({circle:r,angle:n})}this._timer=new egret.Timer(30,0)},t.prototype.showCircle=function(){var e=GameConfig.curWidth(),t=GameConfig.curHeight();this._rGroup.visible=!0,this._rGroup.x=(e-this._rGroup.width)/2,this._rGroup.y=(t-this._rGroup.height)/2-80,this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.reset(),this._timer.start()},t.prototype.onTimer=function(e){for(var t=this._circleList,i=t.length,o=0;i>o;o++){var r=t[o].circle,n=t[o].angle;t[o].angle+=9,r.x=this._center.x+Math.sin(n/180*Math.PI)*this._speed,r.y=this._center.y-Math.cos(n/180*Math.PI)*this._speed}},t.prototype.hideCircle=function(){this._rGroup.visible=!1,this._timer&&(this._timer.stop(),this._timer.removeEventListener(egret.TimerEvent.TIMER,this.onTimer,this))},t}(egret.DisplayObjectContainer);__reflect(TipsLayer.prototype,"TipsLayer");var ShowType;!function(e){e[e.TYPE_UPLOADING=1]="TYPE_UPLOADING",e[e.TYPE_FAILE=2]="TYPE_FAILE",e[e.TYPE_DOWNLOAD=3]="TYPE_DOWNLOAD",e[e.TYPE_RECORD_FAILE=4]="TYPE_RECORD_FAILE"}(ShowType||(ShowType={}));var UserLayer=function(e){function t(){var t=e.call(this)||this;return t.startX=0,t.currentX=0,t.endX=0,t.recordInfo={},t.touchStart=!0,t.skinName="userlayer",t}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.verticalCenter=0,this._hs.minimum=0,this._hs.maximum=9},t.prototype.addSliderEvent=function(){this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._hs.addEventListener(eui.UIEvent.CHANGE,this.onSilderChange,this)},t.prototype.removeSliderEvent=function(){this.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._hs.removeEventListener(eui.UIEvent.CHANGE,this.onSilderChange,this)},t.prototype.onSilderChange=function(e){console.log(this._hs.value),AudioPlayer.getInstance().playRate=(this._hs.value+1)/10},t.prototype.showFinger=function(e){void 0===e&&(e=!0),e||(this.fingerBtn.visible=!0),this.fingerBtn.visible&&(this.fingerBtn.x=1080,egret.Tween.get(this.fingerBtn).to({x:900},1200,egret.Ease.cubicOut).call(this.showFinger.bind(this)))},t.prototype.hiddenFinger=function(){this.fingerBtn.visible=!1},t.prototype.onTouchBegin=function(e){this.onUserTouch(),this.hiddenFinger(),this.startX=e.stageX,this.startTime=egret.getTimer(),this.touchStart=!0},t.prototype.onTouchMove=function(e){},t.prototype.onTouchEnd=function(e){this.endX=e.stageX;var t=this.endX-this.startX;egret.getTimer()-this.startTime;this._distance=t,Math.abs(t)>150&&!P.getRecordProxy().recording&&GameConfig.uploadEnd?this.next():Math.abs(t)>150&&!GameConfig.uploadEnd&&(console.log("show tips"),GameConfig.changePage=!0,TipsLayer.single.showTips(GameLayerManager.gameLayer().maskLayer,ShowType.TYPE_UPLOADING))},t.prototype.next=function(){var e="left";return this._distance<0&&(e="right"),"right"==e&&window.currentPageNum>=window.totalPage?(game.AppFacade.getInstance().sendNotification(CoursewareNotify.HIDE_SHADOW),void this.showScorePage()):void(("left"!==e||1!==window.currentPageNum)&&(game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_SHADOW),this.onTouchHandler({direction:e,distance:Math.abs(this._distance),touchStart:this.touchStart}),"right"==e?window.nextPage()?ZipUtils.single.getSound("fanye1_mp3").play(0,1):(game.AppFacade.getInstance().sendNotification(CoursewareNotify.HIDE_SHADOW),this.showScorePage()):(window.lastPage(),ZipUtils.single.getSound("fanye1_mp3").play(0,1))))},t}(ViewBase);__reflect(UserLayer.prototype,"UserLayer");var AttainmentCellsView=function(){function e(e){console.log(e),this._view=e,this._icon=e._icon,this._title=e._title,this._numTxt=e._numTxt,this._vTxt=e._vTxt,this._timer=new egret.Timer(50,0)}return e.prototype.updata=function(e,t){var i="",o="",r="",n=0;switch(t){case 0:i="end_img_star",o="获得星星",r="颗",n=e.star;break;case 1:i="end_img_score",o="配音分数",r="分",n=e.score;break;case 2:i="end_img_rank",o="排行榜",r="名",n=e.rank}this._num=n>200?201:n,this._dx=this._num/30,this._icon.source=RES.getRes(i),this._title.text=o,this._vTxt.text=r,this._numTxt.text="0"},e.prototype.hide=function(){this._view.visible=!1,this._view.scaleX=this._view.scaleY=1,this._view.alpha=1},e.prototype.hideWithAni=function(){var e=this;egret.Tween.removeTweens(this._view),egret.Tween.get(this._view).to({scaleX:.2,scaleY:.2,alpha:.2},500).call(function(){e.hide()},this)},e.prototype.show=function(){this._view.alpha=0,this._view.visible=!0;var e=this._view.y;this._view.y+=50,this._sum=0,egret.Tween.removeTweens(this._view),egret.Tween.get(this._view).to({y:e},500,egret.Ease.backOut),egret.Tween.get(this._view).to({alpha:1},500),this._timer.reset(),this._timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this._timer.start()},e.prototype.onTimer=function(e){this._sum+=this._dx,this._sum>=this._num&&(this._sum=this._num,this._timer.stop(),EventUtils.dispatchEvent(new egret.Event("countOut"))),this._numTxt.text=Math.round(this._sum).toString();var t=parseInt(this._numTxt.text);t>200&&(this._numTxt.text="200+",this._vTxt.text="")},Object.defineProperty(e.prototype,"y",{set:function(e){this._view.y=e+20},enumerable:!0,configurable:!0}),e}();__reflect(AttainmentCellsView.prototype,"AttainmentCellsView");var EndingLayer=function(e){function t(){var t=e.call(this)||this;return t.skinName="Endding",t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.addUIEvent=function(){this.vbook.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBook,this),this._btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this._btnShare.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._btnRerecord.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onReplay,this)},t.prototype.removeUIEvent=function(){this.vbook.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onBook,this),this._btnRank.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this._btnShare.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onShare,this),this._btnRerecord.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onReplay,this)},t.prototype.onBook=function(e){this._sc&&this._playing&&(this._sc.volume=0);var t=game.AppFacade.getInstance();this.fromEnding=!0,t.sendNotification(CoursewareNotify.GET_RECORD,{id:this._bookInfo.id,from:"rank",uin:GameConfig.userId})},t.prototype.setVisible=function(e){if(this.visible=e,e)this.fromEnding=!1;else{this._playing=!1;var t=GameConfig.curHeight();this._sc&&(this._sc.removeEventListener(egret.Event.SOUND_COMPLETE,this.onShowCell,this),this._sound=null,this._sc.stop());for(var i=0;i<this._cellList.length;i++){var o=this._cellList[i];o.hide()}-1!=this._to&&egret.clearTimeout(this._to);for(var r=this._btnList,n=r.length,i=0;n>i;i++){var s=r[i];s.scaleX=s.scaleY=1,s.visible=!0,egret.Tween.removeTweens(s)}if(this._bookG){var a=(t-this._bookG.height)/2;this._bookG.y=a,egret.Tween.removeTweens(this._bookG)}egret.Tween.removeTweens(this),egret.Tween.removeTweens(this._endTxt),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),EventUtils.removeEventListener("countOut",this.onCountOut,this),this._panda&&this._panda.animation.play("dianzhandaijixunhua_toby",0),this._endAni&&this._endAni.animation.stop(),this._point&&(this._point.visible=!1,this._point.animation.stop())}},t.prototype.onRank=function(e){var t=this;this._sc&&this._playing&&(this._sc.volume=0),BackUtils.single.showIcon(ShowFrom.FROM_RANK_END,function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return GameConfig.nowUID=GameConfig.userId,[4,P.getRecordProxy().getRecordListAsync(P.getCoursewareProxy().getCsInfo().id,GameConfig.nowUID)];case 1:return e.sent(),BackUtils.single.changeSytle(ShowFrom.FROM_COVER),this.setVisible(!0),RankLayer.single.hidePage(!0),[2]}})})},this),RankLayer.single.showPage(this._bookInfo,"quiz",this.parent,!0,!0)},t.prototype.onReplay=function(e){var t=this;this.fromEnding=!0,GameConfig.recordEnd=!1,this._sc&&this._playing&&(this._sc.volume=0),this.rerecord(),BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ),egret.setTimeout(function(){t.setVisible(!1)},this,300)},t.prototype.onShare=function(e){var t=__assign({shareUrl:this.getShareUrl(),bookName:this._bookInfo.name},this._bookInfo,P.getRecordProxy().getUserInfo());SharePopupPage.single.showPage(t)},t.prototype.getShareUrl=function(){var e=P.getRecordProxy().getRequestHeader(),t=this._bookInfo.id;return ApiHttp.BaseUrl.srUrl+"?srpg=1&id="+t+"&"+Global.paramURL(e)},t.prototype.init=function(){e.prototype.init.call(this);var t=new AttainmentCellsView(this._cellStar),i=new AttainmentCellsView(this._cellScore),o=new AttainmentCellsView(this._cellRank);this._coverImg.mask=this._coverMask,this._cellList=[t,i,o],this._btnList=[this._btnRank,this._btnRerecord,this._btnShare];var r=DBFactory.getEndAni("ending_huiben");this._endAni=r,r.scaleX=r.scaleY=3,this.addChild(r);var n=DBFactory.getEndPanda("panda");this._panda=n,n.visible=!1,this.addChild(n),this._pw=n.width,this._ph=n.height;var s=DBFactory.getFinger("dianji_xiaoshou");this._point=s,s.visible=!1,this._bookG.addChild(s),this._playing=!1,this._to=-1,this.fromEnding=!1},t.prototype.show=function(){e.prototype.show.call(this)},t.prototype.addEvent=function(){e.prototype.addEvent.call(this)},t.prototype.removeEvent=function(){e.prototype.removeEvent.call(this)},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=GameConfig.curWidth(),i=GameConfig.curHeight(),o=this._endAni;o.x=t/2,o.y=i/2-13;var r=this._panda;r.x=t-this._pw/2,r.y=i-this._ph/2+60},t.prototype.destory=function(){e.prototype.destory.call(this)},t.prototype.hideEnding=function(){if(!this.fromEnding){console.log("hideEnding ======>>>>>>>",this._playing),this._playing=!1,this.removeUIEvent();var e=GameConfig.curHeight();this._sc&&(this._sc.removeEventListener(egret.Event.SOUND_COMPLETE,this.onShowCell,this),this._sound=null,this._sc.stop());for(var t=0;t<this._cellList.length;t++){var i=this._cellList[t];i.hide()}-1!=this._to&&egret.clearTimeout(this._to);for(var o=this._btnList,r=o.length,n=function(e){var t=o[e];egret.setTimeout(function(){t.scaleX=t.scaleY=1,t.visible=!0,egret.Tween.removeTweens(t)},s,200*e)},s=this,t=0;r>t;t++)n(t);if(this._bookG){var a=(e-this._bookG.height)/2;this._bookG.y=a,egret.Tween.removeTweens(this._bookG)}egret.Tween.removeTweens(this),egret.Tween.removeTweens(this._endTxt),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),EventUtils.removeEventListener("countOut",this.onCountOut,this),this._panda&&(this._panda.visible=!1,this._panda.removeEventListener(dragonBones.EventObject.COMPLETE,this.onPandaShow,this),this._panda.animation.stop()),this._endAni&&this._endAni.animation.stop(),this._point&&(this._point.visible=!1,this._point.animation.stop()),this.parent&&this.parent.removeChild(this)}},t.prototype.updatBook=function(e){var t=this;this._bookInfo=e,RES.getResByUrl(e.cover_url_v?e.cover_url_v:e.cover_url,function(e){return t._coverImg.source=e},this,RES.ResourceItem.TYPE_IMAGE)},t.prototype.showEnding=function(e,t){if(!this._playing){this._playing=!0,this.fromEnding=!1,game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),AudioPlayer.getInstance().stop(),this.onViewResize();var i=(GameConfig.curWidth(),GameConfig.curHeight());this._bookG.visible=!1,this._bookG.y=-this._bookG.height-2,this.updatBook(e.book);var o=t?t:GameLayerManager.gameLayer().endLayer;o.visible=!0,RankLayer.single.hidePage();var r=this._endTxt;r.visible=!0,r.scaleY=r.scaleX=.3,r.y=i/2,r.visible=!1;for(var n=e.items,s=n.length,a=0;s>a;a++){var h=this._cellList[a];h.updata(n[a],a),h.y=i/2,h.hide()}this._count=0,this.visible=!0,this.alpha=1,this._panda.visible=!1,o.addChild(this),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),this._sound=ZipUtils.single.getSound("theEnd_mp3"),this._sound.play(0,1),this._endAni.animation.play("ending_huiben",1)}},t.prototype.onEnterFream=function(e){var t=this,i=this._endAni,o=this._endTxt;i.animation.lastAnimationState.currentTime>=.29&&(o.visible=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),egret.Tween.removeTweens(o),egret.Tween.get(o).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).call(function(){var e=t._panda;e.visible=!0,e.addEventListener(dragonBones.EventObject.COMPLETE,t.onPandaShow,t),e.animation.play("chuxian_toby",1)},this))},t.prototype.onPandaShow=function(e){var t=this._panda;t.removeEventListener(dragonBones.EventObject.COMPLETE,this.onPandaShow,this),t.animation.play("shuohua_toby",1),this._sound=ZipUtils.single.getSound("endTips_mp3"),this._sc=this._sound.play(0,1),this._sc.addEventListener(egret.Event.SOUND_COMPLETE,this.onShowCell,this)},t.prototype.onShowCell=function(e){var t=this;this._sc.removeEventListener(egret.Event.SOUND_COMPLETE,this.onShowCell,this);var i=GameConfig.curHeight(),o=i/2-210,r=this._panda,n=this._endTxt;r.animation.stop(),r.animation.play("dianzhandaijixunhua_toby",0),egret.Tween.get(n).wait(300).to({y:o,scaleX:.84,scaleY:.84},400).call(function(){t._sound=ZipUtils.single.getSound("sunValue_mp3"),t._sound.play(0,1);for(var e=function(e){var i=t._cellList[e];egret.setTimeout(function(){i.show()},t,150*e)},i=0;3>i;i++)e(i)},this),EventUtils.addEventListener("countOut",this.onCountOut,this)},t.prototype.onCountOut=function(e){var t=this,i=(GameConfig.curWidth(),GameConfig.curHeight());this._count++,this._count>=3&&(EventUtils.removeEventListener("countOut",this.onCountOut,this),this._to=egret.setTimeout(function(){t._bookG.alpha=1,t._bookG.visible=!0,t._btnRank.visible=!1,t._btnRerecord.visible=!1,t._btnShare.visible=!1,t._endTxt.visible=!1,t._btnSum=0;for(var e=t._cellList.length,o=0;e>o;o++){var r=t._cellList[o];r.hideWithAni()}var n=(i-t._bookG.height)/2;egret.Tween.removeTweens(t._bookG),t._sound=ZipUtils.single.getSound("bookTo_mp3"),t._sound.play(0,1),egret.Tween.get(t._bookG).to({y:n},700,egret.Ease.getBackOut(.9)).call(function(){for(var e=t._btnList,i=e.length,o=function(i){var o=e[i];egret.setTimeout(function(){o.scaleX=o.scaleY=0,o.visible=!0,egret.Tween.removeTweens(o),egret.Tween.get(o).to({scaleX:1,scaleY:1},400,egret.Ease.backOut).call(function(){t.btnShow()},t)},t,200*i)},r=0;i>r;r++)o(r)},t)},this,4e3))},t.prototype.btnShow=function(){var e=this;if(this._btnSum++,this._btnSum>=3&&this._playing){this.addUIEvent();var t=this._panda;t.animation.play("shuohua_toby",1);var i=this._point;i.visible=!0,i.x=this._btnShare.x,i.y=this._btnShare.y+15,i.animation.play("dianji_xiaoshou",1),this._sound=ZipUtils.single.getSound("endShareTips_mp3"),this._sc=this._sound.play(0,1),this._sc.once(egret.Event.SOUND_COMPLETE,function(){t.animation.stop(),t.animation.stop(),t.animation.play("dianzhandaijixunhua_toby",0),i.animation.stop(),i.visible=!1,e._playing=!1},this)}},t.prototype.hideBookG=function(){egret.Tween.removeTweens(this._bookG),egret.Tween.get(this._bookG).to({alpha:0},400),egret.Tween.removeTweens(this._panda);var e=this._panda.y+500;egret.Tween.get(this._panda).to({y:e},400)},t.prototype.showBookG=function(){var e=GameConfig.curHeight();egret.Tween.removeTweens(this._bookG),egret.Tween.get(this._bookG).wait(100).to({alpha:1},200),egret.Tween.removeTweens(this._panda);var t=e-this._ph/2+60;egret.Tween.get(this._panda).to({y:t},300)},t}(ViewBase);__reflect(EndingLayer.prototype,"EndingLayer");var OtherEndingV=function(e){function t(){var t=e.call(this)||this;return t.shareEnd=!1,t.skinName="OtherEnding",t}return __extends(t,e),Object.defineProperty(t,"single",{get:function(){return null==this._single?this._single=new t:this._single},enumerable:!0,configurable:!0}),t.prototype.init=function(){e.prototype.init.call(this);var t=DBFactory.getEndAni("ending_huiben");t.parent&&t.parent.removeChild(t),this._end=t,t.scaleX=t.scaleY=3,this.addChild(t);var i=DBFactory.getEndHead("effect_huiben");this._endHead=i,i.scaleX=i.scaleY=2,this.addChild(i);var o=DBFactory.getEndHeadStar("effect_touxiang");this._endHeadStar=o,o.scaleX=o.scaleY=3,this.addChild(o),this._endStatLinghts=[],this._stars=[];for(var r=0;3>r;r++){var n=DBFactory.getEndStatLinght("effect_star");this._endStatLinghts.push(n),n.scaleX=n.scaleY=2,this._starG.addChild(n);var s=this["_starBg"+(r+1)];n.x=s.x+27,n.y=s.y+26,n.visible=!1,n.animation.stop(),this._stars.push(new Stars(this["_star"+(r+1)]))}},t.prototype.updata=function(e,t){this.shareEnd=GameConfig.isSrpg(),this._readEnd.visible=!1,this._shareEnd.visible=!1,this._myWorksEnd.visible=!1,this._starG.alpha=0,this._starG.visible=!0;var i=this._readEnd;GameConfig.isOthers&&(i=this._myWorksEnd,this._starG.visible=!1),GameConfig.isSrpg()&&(i=this._shareEnd,this._starG.visible=!1),i.alpha=0,i.visible=!0,this._needStar=this._starG.visible,i.y=t-i.height-10,this._curGroup=i;var o=this._endHead.armature.getSlot("touxiang"),r=new egret.Bitmap,n=GameConfig.user&&GameConfig.user.avatar&&""!=GameConfig.user.avatar?GameConfig.user.avatar:"";console.log("GameConfig.user",GameConfig.user,n),r.width=81,r.height=81;var s=new egret.Shape;s.graphics.beginFill(16777215,1),s.graphics.drawCircle(0,0,40.5),s.graphics.endFill();var a=new eui.Group;a.width=81,a.height=81,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.addChild(r),a.addChild(s),s.x=40.5,s.y=40.5,r.mask=s,o.display=a,n=n+"?v="+(new Date).getTime(),RES.getResByUrl(n,function(e){r.texture=e},this,RES.ResourceItem.TYPE_IMAGE);for(var h=[50,380,1156],c=0;3>c;c++){var l=this._endStatLinghts[c],u=this["_starBg"+(c+1)];l.x=u.x+27,l.y=u.y+26,l.visible=!1,l.animation.stop();var d=this._stars[c];d.x=h[c],d.y=t-42,d.visible=!1}var g=P.getCoursewareProxy().getCsInfo();g.level>6?(this._readRecordBtn.visible=!1,this._restartBtn.x=175):(this._readRecordBtn.visible=!0,this._restartBtn.x=350)
},t.prototype.setVisible=function(e){this.visible=e,e?this.fromEnding=!1:(egret.Tween.removeTweens(this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),console.log("setVisible ==== ",this._sc,this._sc1),this._sc&&this._sc.stop(),this._sc1&&this._sc1.stop())},t.prototype.hideEnding=function(){this._playing=!1,egret.Tween.removeTweens(this),this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),console.log("hide ==== ",this._sc,this._sc1),this._sc&&this._sc.stop(),this._sc1&&this._sc1.stop(),this._end.animation.stop(),this._endTxt&&egret.Tween.removeTweens(this._endTxt),this._starG&&egret.Tween.removeTweens(this._starG),this._endHead&&this._endHead.animation.stop(),this._endHeadStar&&(this._endHeadStar.animation.stop(),this._endHeadStar.addEventListener(dragonBones.EventObject.COMPLETE,this.onHeadEnd,this));for(var e=0;e<this._stars.length;e++){var t=this._stars[e];egret.Tween.removeTweens(t)}this._curGroup&&egret.Tween.removeTweens(this._curGroup),this.parent&&this.parent.removeChild(this)},t.prototype.showEnding=function(e,t){var i=this;if(!this._playing){this._playing=!0,this.fromEnding=!1,game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),AudioPlayer.getInstance().stop();var o=GameConfig.curWidth(),r=GameConfig.curHeight();this.updata(o,r),this.onViewResize();var n=t?t:GameLayerManager.gameLayer().endLayer;this.alpha=0;var s=this._endTxt;s.alpha=1,s.visible=!0,s.scaleY=s.scaleX=.3,s.y=r/2,s.visible=!1,this._endHead.visible=!1,this._endHeadStar.visible=!1,this.visible=!0,n.addChild(this),egret.Tween.removeTweens(this),egret.Tween.get(this).to({alpha:1},300).call(function(){game.AppFacade.getInstance().sendNotification(CoursewareNotify.CLOSE_QUIZ),i.addEventListener(egret.Event.ENTER_FRAME,i.onEnterFream,i),i._sound=ZipUtils.single.getSound("theEnd_mp3"),i._sc=i._sound.play(0,1),i._end.animation.play("ending_huiben",1)},this)}},t.prototype.onEnterFream=function(e){var t=this,i=this._end,o=this._endTxt;i.animation.lastAnimationState.currentTime>=.29&&(o.visible=!0,this.removeEventListener(egret.Event.ENTER_FRAME,this.onEnterFream,this),egret.Tween.removeTweens(o),egret.Tween.get(o).to({scaleX:1,scaleY:1},300,egret.Ease.backOut).wait(500).call(function(){egret.Tween.get(o).to({alpha:0},600),t._needStar&&(egret.Tween.removeTweens(t._starG),egret.Tween.get(t._starG).to({alpha:1},600));var e=t._endHead,i=t._endHeadStar;e.visible=!0,i.visible=!0,i.addEventListener(dragonBones.EventObject.COMPLETE,t.onHeadEnd,t),t._sound=ZipUtils.single.getSound("hu_mp3"),t._sc=t._sound.play(0,1),t._sound1=ZipUtils.single.getSound("Fantastic_baby_mp3"),t._sc1=t._sound1.play(0,1),e.animation.play("effect_huiben",1),i.animation.play("effect_touxiang",1)},this))},t.prototype.onHeadEnd=function(e){var t=this;this._starCount=0;for(var i=function(e){egret.setTimeout(function(){if(t._playing)if(t._needStar){var i=t._stars[e];i.visible=!0;var o=new egret.Point(i.x,i.y),r=t["_starBg"+(e+1)],n=t._starG.localToGlobal(r.x,r.y),s=t.$content.globalToLocal(n.x,n.y),a=e>=2?-1:1,h=new egret.Point(s.x-400*a,s.y+180);i.setPoints(o,h,s),egret.Tween.removeTweens(i),egret.Tween.get(i).to({factor:1},600).call(function(){if(t._playing){t._sound=ZipUtils.single.getSound("star_mp3"),t._sound.play(0,1);var i=t._endStatLinghts[e];i.visible=!0,i.animation.play("effect_star",1),t._starCount++,t._starCount>=3&&t.onStarEnd()}},t),egret.Tween.get(i).to({scaleX:1.4,scaleY:1.4},300).to({scaleX:1,scaleY:1},300)}else t.onStarEnd()},o,250*e)},o=this,r=0;3>r;r++)i(r)},t.prototype.onStarEnd=function(){var e=this;if(this._playing){var t=(GameConfig.curWidth(),GameConfig.curHeight(),this._curGroup),i=this._endHead.y+100;egret.Tween.removeTweens(t),egret.Tween.get(t).wait(500).to({y:i},500,egret.Ease.backOut).call(function(){e._playing=!1,e.addUIEvent()},this),egret.Tween.get(t).wait(500).to({alpha:1},500)}},t.prototype.onRestart=function(e){this.shareEnd?location.href="http://t.cn/Rsb2ZRf":(BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ),this.restart()),GameConfig.readEnd=!1,this.hideEnding()},t.prototype.onRead=function(e){this.shareEnd?location.href="http://t.cn/Rsb2ZRf":(BackUtils.single.changeSytle(ShowFrom.FROM_QUIZ),game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHARE_ENTER_BOOK,"record")),this.fromEnding=!0,GameConfig.recordEnd=!1,this.setVisible(!1)},t.prototype.onBackToMyWorks=function(e){BackUtils.single.changeSytle(ShowFrom.FROM_COVER),BackUtils.single.backToPrve(),this.hideEnding()},t.prototype.addUIEvent=function(){this._restartBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this._readRecordBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRead,this),this._shareRead.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this._shareRecord.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRead,this),this._replay.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRestart,this),this._backMyWorks.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onBackToMyWorks,this)},t.prototype.removeUIEvent=function(){},t.prototype.onViewResize=function(){e.prototype.onViewResize.call(this);var t=GameConfig.curWidth(),i=GameConfig.curHeight(),o=this._end;o.x=t/2,o.y=i/2-13;var r=0;r=this._needStar?70:15;var n=this._endHead;n.x=t/2,n.y=i/2+r;var s=this._endHeadStar;s.x=t/2,s.y=i/2-30,this._starG.y=i/2-320,this._starG.y<=0&&(this._starG.y=25)},t.prototype.destory=function(){e.prototype.destory.call(this)},t}(ViewBase);__reflect(OtherEndingV.prototype,"OtherEndingV");var Stars=function(){function e(e){this._view=e}return Object.defineProperty(e.prototype,"visible",{get:function(){return this._view.visible},set:function(e){this._view.visible=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._view.x},set:function(e){this._view.x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleX",{get:function(){return this._view.scaleX},set:function(e){this._view.scaleX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleY",{get:function(){return this._view.scaleY},set:function(e){this._view.scaleY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._view.y},set:function(e){this._view.y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(e){this._view.x=(1-e)*(1-e)*this._point1.x+2*e*(1-e)*this._point2.x+e*e*this._point3.x,this._view.y=(1-e)*(1-e)*this._point1.y+2*e*(1-e)*this._point2.y+e*e*this._point3.y},enumerable:!0,configurable:!0}),e.prototype.setPoints=function(e,t,i){this._point1=e,this._point2=t,this._point3=i},e}();__reflect(Stars.prototype,"Stars");var RecordBarMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;o.recordFlag=!0,o.pageId="",o.recordDuration=0;var r=GameLayerManager.gameLayer().mainLayer;o.recordBar=new RecordBar,o.recordBar.x=(GameConfig.curWidth()-1280)/2,o.recordBar.y=(GameConfig.curHeight()-640)/2+640,r.addChild(o.recordBar);var n=o.recordBar,s=n.recordBtn,a=n.recordPlay;s.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onRecordBtnClick,o),a.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onPlayBtnClick,o);var h=window.dsBridge;return h.register("recordComplete",o.updateRecordItem.bind(o)),o.recordTimer=new egret.Timer(1e3,0),o.recordTimer.addEventListener(egret.TimerEvent.TIMER,function(){return o.recordDuration++},o),o}return __extends(t,e),t.prototype.onPlayBtnClick=function(){},t.prototype.onRecordBtnClick=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){if(e=this,t=window.dsBridge,egret.Tween.removeTweens(e),e.recordFlag)AudioPlayer.getInstance().stop(),AudioPlayer.getInstance().setMute(!0),t.call("read.startRecord",{id:e.pageId,timeout:60},function(t){t&&(e.recordDuration=0,e.recordTimer.start(),e.recordFlag=!1,e.recordBar.currentState="recoding",e.recordBar.hideRecordPlayingAnim(),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CHANGE_RECORD_STATE,"recoding"))}),egret.Tween.get(e).wait(5e3).call(function(){e.recordBar.hiddenTooltip(),e.recordBar.showTooltip("点击按钮结束配音")},e);else{if(e.recordDuration<2)return e.recordBar.hiddenTooltip(),e.recordBar.showTooltip("录音时间太短"),setTimeout(function(){return e.recordBar.hiddenTooltip()},1e3),[2];e.endReocord(!1)}return[2]})})},t.prototype.updateRecordItem=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},t.prototype.endReocord=function(e){void 0===e&&(e=!0);var t=this;t.recordBar.hiddenTooltip(),t.recordBar.showTooltip("点击按钮可重新配音");var i=window.dsBridge;t.recordFlag=!0,t.recordBar.currentState="normal",t.recordBar.hideRecordPlayingAnim(),AudioPlayer.getInstance().setMute(!1),e||i.call("read.stopRecord",{id:t.pageId}),game.AppFacade.getInstance().sendNotification(CoursewareNotify.CHANGE_RECORD_STATE,"normal")},t.prototype.listNotificationInterests=function(){return[]},t.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CoursewareNotify.SET_READ_MODEL:P.getRecordProxy().getUserInfo().score>0&&(t.recordBar.currentState="read"),GameConfig.isSrpg()?t.recordBar.hidden():"record"===i.name?t.recordBar.show():t.recordBar.hidden();break;case CoursewareNotify.SWAP_PAGE:AudioPlayer.getInstance().setMute(!1),t.pageId=i.id;var o=P.getRecordProxy().getRecordList();t.recordData=o.filter(function(e){return e.page_id===t.pageId})[0],t.recordBar.setRecordInfo(t.recordData),t.recordBar.hideRecordPlayingAnim();break;case CoursewareNotify.AUTO_RECORD:t.onRecordBtnClick();break;case CoursewareNotify.CANCEL_RECORD:break;case CoursewareNotify.PLAY_SAMPLE_SOUND:t.recordBar.hideRecordPlayingAnim()}},t.NAME="RecordBarMediator",t}(puremvc.Mediator);__reflect(RecordBarMediator.prototype,"RecordBarMediator",["puremvc.IMediator","puremvc.INotifier"]);var UserLayerMediator=function(e){function t(i){void 0===i&&(i=null);var o=e.call(this,t.NAME,i)||this;o.starNum=0,o.userClick=!1,o.fingerTimeOut=null;var r=GameLayerManager.gameLayer().mainLayer;return o.userLayer=new UserLayer,r.addChild(o.userLayer),o.userLayer.showScorePage=function(){return game.AppFacade.getInstance().sendNotification(CoursewareNotify.SHOW_SCORE_PAGE)},o.userLayer.onTouchHandler=function(e){P.getRecordProxy().recording||game.AppFacade.getInstance().sendNotification(CoursewareNotify.PLAY_SWAP_EFFECT,e)},o.userLayer.onUserTouch=function(){o.fingerTimeOut&&clearTimeout(o.fingerTimeOut)},o}return __extends(t,e),t.prototype.listNotificationInterests=function(){return[CoursewareNotify.ENTER_PICTRUE_BOOK,CoursewareNotify.SHOW_SCORE_PAGE,CoursewareNotify.SOUND_COMPELETE,CoursewareNotify.SWAP_PAGE,CoursewareNotify.CHANGE_RECORD_STATE,CoursewareNotify.SHOW_COVER,CoursewareNotify.CLOSE_QUIZ,CoursewareNotify.SHOW_NEXT]},t.prototype.handleNotification=function(e){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(o){switch(t=e.getBody(),e.getName()){case CoursewareNotify.SHOW_NEXT:this.userLayer&&this.userLayer.next();break;case CoursewareNotify.CHANGE_RECORD_STATE:"recoding"===t?this.userLayer.removeSliderEvent():this.userLayer.addSliderEvent();break;case CoursewareNotify.ENTER_PICTRUE_BOOK:this.userLayer.addSliderEvent();break;case CoursewareNotify.SHOW_SCORE_PAGE:this.userLayer.removeSliderEvent();break;case CoursewareNotify.SOUND_COMPELETE:this.userClick=!1,console.log("this.fingerTimeOut = setTimeout"),this.fingerTimeOut=setTimeout(function(){return i.userLayer.showFinger(!1)},5e3);break;case CoursewareNotify.SWAP_PAGE:this.fingerTimeOut&&clearTimeout(this.fingerTimeOut),this.userLayer.hiddenFinger();break;case CoursewareNotify.SHOW_COVER:case CoursewareNotify.CLOSE_QUIZ:this.userLayer.removeSliderEvent()}return[2]})})},t.NAME="UserLayerMediator",t}(puremvc.Mediator);__reflect(UserLayerMediator.prototype,"UserLayerMediator",["puremvc.IMediator","puremvc.INotifier"]);var HttpManager;!function(e){function t(e){function t(e){Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}var i=this,o=e.actionType,r=(e.method,e.endpoint),n=e.params,s=void 0===n?{}:n;return new Promise(function(e,n){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(r,egret.HttpMethod.GET),a.setRequestHeader("Content-Type","application/json"),a.send(t(s));var h=function(t){var i=t.currentTarget;game.AppFacade.getInstance().sendNotification(o,i.response),e(i.response)},c=function(e){game.AppFacade.getInstance().sendNotification(o,e),n(e)},l=function(e){};a.addEventListener(egret.Event.COMPLETE,h,i),a.addEventListener(egret.IOErrorEvent.IO_ERROR,c,i),a.addEventListener(egret.ProgressEvent.PROGRESS,l,i)})}e.requestUrl=t}(HttpManager||(HttpManager={}));var SocketManager;!function(e){function t(e,t){void 0===e&&(e=""),void 0===t&&(t=80),Global.showWaritPanel()}function i(){Global.hideWaritPanel(),game.AppFacade.getInstance().sendNotification(SysNotify.CONNECT_SERVER_SUCCESS)}function o(){Global.hideWaritPanel();var e=new egret.ByteArray;this.sock.readBytes(e);var t=e.readInt(),i=e.readShort(),o=new egret.ByteArray;e.readBytes(o),game.AppFacade.getInstance().sendNotification("Processor_"+t+"_"+i,o)}function r(e,t,i){Global.showWaritPanel();var o=new egret.ByteArray;o.writeInt(e),o.writeShort(t),o.writeBytes(new egret.ByteArray(i)),this.sock.writeBytes(o)}e.connectServer=t,e.onSocketOpen=i,e.onReceiveMessage=o,e.sendMessage=r}(SocketManager||(SocketManager={}));var AudioPlayer=function(){function e(){this.stopFlag=!1,this._mute=!1,this.playRate=1}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},Object.defineProperty(e.prototype,"playRate",{get:function(){return this._playRate},set:function(e){this._playRate=e,this.audioChannel},enumerable:!0,configurable:!0}),e.prototype.play=function(e,t,i){var o=this;console.log("play");var r=this;return r.stopFlag=!1,r.audioChannel&&(r.audioChannel.stop(),r.audioChannel=null),new Promise(function(n){var s;console.log(" has sound =====",o._mute,e,GameConfig.soundPool.hasOwnProperty(e)),s=GameConfig.isSrpg()?new egret.Sound:new egret.CSWebAudioSound,console.log("sound type ",s instanceof egret.Sound);var a=function(e){console.log("self.stopFlag",r.stopFlag),r.stopFlag||(r.audioChannel=s.play(0,1),console.log("cs.play",r.audioChannel),console.log("cs.play sound == ",s),r._mute&&(r.audioChannel.volume=0),r.audioChannel.once(egret.Event.SOUND_COMPLETE,function(){r.audioChannel=null,console.log("self.comFunc",t),t&&i&&t.call(i),n("complete")},r))};s.once(egret.Event.COMPLETE,a,o),ZipUtils.single.getSound(e)?(s=ZipUtils.single.getSound(e),a(null)):s.load(e)})},e.prototype.stop=function(){console.log("stop");var e=this;e.stopFlag=!0,e.audioChannel&&(e.audioChannel.stop(),e.audioChannel=null)},e.prototype.setMute=function(e){console.log("setMute");var t=this;t._mute=e,t.audioChannel&&(t.audioChannel.volume=e?0:1)},e.prototype.getMute=function(){return this._mute},e}();__reflect(AudioPlayer.prototype,"AudioPlayer");var EffectUtils;!function(e){function t(e){return e}e.colorStr=t}(EffectUtils||(EffectUtils={}));var DBFactory;!function(e){function t(e){if(!d){var t=RES.getRes("jiesuan-yueduqi_ske_json"),i=RES.getRes("jiesuan-yueduqi_tex_json"),o=RES.getRes("jiesuan-yueduqi_tex_png"),r=dragonBones.EgretFactory.factory;r.parseDragonBonesData(t),r.parseTextureAtlasData(i,o),d=r.buildArmatureDisplay(e)}return d}function i(e){if(!g){var t=RES.getRes("caidai-yueduqi_ske_json"),i=RES.getRes("caidai-yueduqi_tex_json"),o=RES.getRes("caidai-yueduqi_tex_png"),r=dragonBones.EgretFactory.factory;r.parseDragonBonesData(t),r.parseTextureAtlasData(i,o),g=r.buildArmatureDisplay(e)}return g}function o(e){if(!p){var t=RES.getRes("xiaohuangdian_ske_json"),i=RES.getRes("xiaohuangdian_tex_json"),o=RES.getRes("xiaohuangdian_tex_png"),r=dragonBones.EgretFactory.factory;r.parseDragonBonesData(t),r.parseTextureAtlasData(i,o),p=r.buildArmatureDisplay(e)}return p}function r(e){return f||(f=ZipUtils.single.getDBAnimate(e)),f}function n(e){return _||(_=ZipUtils.single.getDBAnimate(e)),_}function s(e){return ZipUtils.single.getDBAnimate(e)}function a(e){return y||(y=ZipUtils.single.getDBAnimate(e)),y}function h(e){return m||(m=ZipUtils.single.getDBAnimate(e)),m}function c(e){return v||(v=ZipUtils.single.getDBAnimate(e)),v}function l(e){return E||(E=ZipUtils.single.getDBAnimate(e)),E}function u(e){return ZipUtils.single.getDBAnimate(e)}var d;e.getFinishAnimate=t;var g;e.getcolorBarAnimate=i;var p;e.getGuiderAnimate=o;var f;e.getYinboAnimate=r;var _;e.getScoreAnimate=n;e.getEndAni=s;var y;e.getEndPanda=a;var m;e.getFinger=h;var v;e.getEndHead=c;var E;e.getEndHeadStar=l,e.getEndStatLinght=u}(DBFactory||(DBFactory={}));var EffectUtils;!function(e){function t(e,t){if(void 0===t&&(t=1e3),null==this.rotationArr&&(this.rotationArr=[]),!this.rotationArr[e.hashCode]){null!=this.rotationArr[e.hashCode]&&this.rotationArr[e.hashCode]||(this.rotationArr[e.hashCode]=!0);var i=function(){this.rotationArr[e.hashCode]&&null!=e&&(e.rotation=0,egret.Tween.get(e).to({rotation:360},t).call(i,this))};e.rotation=0,egret.Tween.get(e).to({rotation:360},t).call(i,this)}}function i(e){null==this.rotationArr&&(this.rotationArr=[]),this.rotationArr[e.hashCode]=!1}function o(e,t){void 0===t&&(t=1e3),new BitmapBlink(e,t)}function r(e){var t=80,i=e.x;egret.Tween.get(e).to({x:e.x-10},t),egret.setTimeout(function(){egret.Tween.get(e).to({x:e.x+20},t)},this,2*t),egret.setTimeout(function(){egret.Tween.get(e).to({x:e.x-20},t)},this,3*t),egret.setTimeout(function(){egret.Tween.get(e).to({x:e.x+20},t)},this,4*t),egret.setTimeout(function(){egret.Tween.get(e).to({x:i},t)},this,5*t)}function n(e){void 0===e&&(e=1);var t=GameConfig.curPanel,i=40,o=t.x,r=t.y;1==e?(egret.Tween.get(t).to({x:t.x-10},i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,2*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x-20},i)},this,3*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20},i)},this,4*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:o},i)},this,5*i)):(egret.Tween.get(t).to({x:t.x-10,y:t.y},i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x+20,y:t.y},i)},this,2*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y+15},i)},this,3*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y-20},i)},this,4*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:t.x,y:t.y+10},i)},this,5*i),egret.setTimeout(function(){egret.Tween.get(t).to({x:o,y:r},i)},this,6*i))}function s(e,t,i){switch(void 0===e&&(e=""),void 0===t&&(t=1),void 0===i&&(i=!1),t){case 1:TipsUtils.showTipsDownToUp(e,i);break;case 2:TipsUtils.showTipsLeftOrRight(e,i,!0);break;case 3:TipsUtils.showTipsLeftOrRight(e,i,!1);break;case 4:TipsUtils.showTipsFromCenter(e,i);break;case 5:TipsUtils.showTipsBigToSmall(e,i)}}function a(e,t){if(void 0===t&&(t=1),!this.isPlayEffectPlay){this.isPlayEffectPlay=!0;var i=function(){this.isPlayEffectPlay=!1},o=function(){1==t?egret.Tween.get(e).to({scaleX:1,scaleY:1,x:e.x-e.width/4,y:e.y-e.height/4},500,egret.Ease.elasticOut).call(i,this):2==t?egret.Tween.get(e).to({scaleX:1,scaleY:1,x:e.x-e.width/4,y:e.y-e.height/4},500,egret.Ease.backOut).call(i,this):3==t&&egret.Tween.get(e).to({scaleX:1,scaleY:1,x:e.x-e.width/4,y:e.y-e.height/4},100).call(i,this)};egret.Tween.get(e).to({scaleX:.5,scaleY:.5,x:e.x+e.width/4,y:e.y+e.height/4},100,egret.Ease.sineIn).call(o,this)}}function h(e){var t=function(){if(null!=e){var i=function(){e.scaleX=1,e.scaleY=1,egret.Tween.get(e).to({alpha:1},1e3).call(t,self)};e.alpha=1,egret.Tween.get(e).to({scaleX:1.5,scaleY:1.5,alpha:0},1e3).call(i,self)}};t()}function c(e,t,i){void 0===i&&(i=50);var o=function(){if(null!=e){var r=function(){egret.Tween.get(e).to({y:e.y-i},t).call(o,this)};egret.Tween.get(e).to({y:e.y+i},t).call(r,this)}};o()}function l(e,t,i){void 0===i&&(i=20);var o=function(){if(null!=e){var r=function(){egret.Tween.get(e).to({rotation:-i},t).call(o,this)};egret.Tween.get(e).to({rotation:i},t).call(r,this)}};o()}function u(e,t,i){void 0===t&&(t=""),void 0===i&&(i=200);for(var o=t.split(""),r=o.length,n=0;r>n;n++)egret.setTimeout(function(){e.appendText(o[Number(this)])},n,i*n)}e.rotationEffect=t,e.removeRotationEffect=i,e.blinkEffect=o,e.shakeObj=r,e.shakeScreen=n,e.showTips=s;e.playEffect=a,e.playScaleEffect=h,e.flyObj=c,e.rockObj=l,e.typerEffect=u}(EffectUtils||(EffectUtils={}));var EventUtils=function(){function e(){}return e.addEventListener=function(t,i,o,r,n){e.e.addEventListener(t,i,o,r,n)},e.removeEventListener=function(t,i,o,r){e.e.removeEventListener(t,i,o,r)},e.dispatchEvent=function(t){return e.e.dispatchEvent(t)},e.once=function(t,i,o,r,n){e.e.once(t,i,o,r,n)},e.e=new egret.EventDispatcher,e}();__reflect(EventUtils.prototype,"EventUtils");var Global;!function(e){function t(){e.waitPanel=new WaitPanel(1),GameLayerManager.gameLayer().maskLayer.removeChildren(),GameLayerManager.gameLayer().maskLayer.addChild(e.waitPanel)}function i(){null!=e.waitPanel&&GameLayerManager.gameLayer().maskLayer.contains(e.waitPanel)&&GameLayerManager.gameLayer().maskLayer.removeChild(e.waitPanel)}function o(e){var t=new egret.HtmlTextParser;return t.parser(e)}function r(t){return null==e.message,e.message.build(t)}function n(e){switch(e){case 0:return"零";case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五";case 6:return"六";case 7:return"七";case 8:return"八";case 9:return"九";default:console.log("default case")}}function s(e){if(void 0!=e){e=e.substr(1);var t=e.split("&"),i={},o=[];return t.map(function(e,t,r){o=e.split("="),void 0!=o[0]&&(i[o[0]]=decodeURIComponent(o[1]))}),i}}function a(e){var t=e.width/2,i=e.height/2;return e.anchorOffsetX=t,e.anchorOffsetY=i,e.x+=t,e.y+=i,e}function h(e,t){var i=e.getBounds(),o=t.getBounds();return i.x=e.x,i.y=e.y,o.x=t.x,o.y=t.y,i.intersects(o)}function c(e){var t=Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&");return t}function l(){var t=RES.getRes("description_json");e.debug=t.debug,window.showConsole(e.debug);var i=console.log;console.log=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];e.debug&&i.call(console,t,o)}}e.showWaritPanel=t,e.hideWaritPanel=i,e.getTextFlow=o,e.getMessage=r,e.getNumber=n,e.searchToObject=s,e.setCenterPoint=a,e.hitTest=h,e.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},e.androidCheakSupportWebp=function(){var e=new Image,t=!1;return e.onload=function(){t=!0},e.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",function(){return t}}(),e.getPlayType=function(){var e=s(location.search).playType;return function(){return e}}(),e.webpSuffix="";(function(){return __awaiter(this,void 0,void 0,function(){var t,i,o,r,n;return __generator(this,function(a){switch(a.label){case 0:return t="?x-oss-process=image/format,webp",i="&isNeedWebp=true",o="",r=s(location.search).sdkVersion,[4,new Promise(function(e){var t=new Image;t.onload=function(){e(!0)},t.onerror=function(){e(!1)},t.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="})];case 1:return n=a.sent(),n?o=t:r>=1&&(o=t+i),e.webpSuffix=o,[2]}})})})();e.paramURL=c,e.debug=!1,e.initSys=l}(Global||(Global={}));var McFactory;!function(e){function t(e){var t=RES.getRes("effect_ui_json"),o=RES.getRes("effect_ui_png");return i||(i=new egret.MovieClipDataFactory(t,o)),new egret.MovieClip(i.generateMovieClipData(e))}var i;e.getUserMcByName=t;var o;e.getClickMcByName=function(e){var t=RES.getRes("star_json"),i=RES.getRes("star_png");return o||(o=new egret.MovieClipDataFactory(t,i)),new egret.MovieClip(o.generateMovieClipData(e))};var r;e.getFlashMcByName=function(e){var t=RES.getRes("saoguang_ydq_json"),i=RES.getRes("saoguang_ydq_png");return r||(r=new egret.MovieClipDataFactory(t,i)),new egret.MovieClip(r.generateMovieClipData(e))};var n;e.getPlaySound=function(e){var t=RES.getRes("playIcon_mc_json"),i=RES.getRes("playIcon_tex_png");return n||(n=new egret.MovieClipDataFactory(t,i)),new egret.MovieClip(n.generateMovieClipData(e))}}(McFactory||(McFactory={}));var NativeApi;!function(e){function t(e,t){egret.localStorage.setItem(e,t)}function i(e){return egret.localStorage.getItem(e)}function o(e){egret.localStorage.removeItem(e)}function r(){egret.localStorage.clear()}function n(){}function s(){}function a(e){window.open("tel:"+e,"_self")}function h(e){window.open("sms:"+e,"_self")}function c(){return window.location.href}e.setLocalData=t,e.getLocalData=i,e.deleteLocalData=o,e.clearLocalData=r,e.getMic=n,e.getScreen=s,e.callPhone=a,e.sendMessage=h,e.getCurUrl=c,e.curAngle=Number(window.orientation)}(NativeApi||(NativeApi={}));var RegUtils;!function(e){function t(e){var t=/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;return t.test(e)?!0:(alert("您输入的Email地址格式不正确！"),!1)}function i(e){if(n(e))return!1;var t=/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/g;return t.test(e)&&Number(RegExp.$1)<256&&Number(RegExp.$2)<256&&Number(RegExp.$3)<256&&Number(RegExp.$4)<256?!0:!1}function o(e){var t="/^1[3|4|5|7|8][0-9]d{4,8}$/",i=new RegExp(t);return i.test(e)?!0:!1}function r(e){var t=/^[0][1-9]{2,3}-[0-9]{5,10}$/,i=/^[1-9]{1}[0-9]{5,8}$/,o="您输入的电话号码不正确!";return e.length>9?t.test(e)?!0:(alert(o),!1):i.test(e)?!0:(alert(o),!1)}function n(e){if(""==e)return!0;var t="^[ ]+$",i=new RegExp(t);return i.test(e)}function s(e){var t=/^[-]{0,1}[0-9]{1,}$/;return t.test(e)}function a(e){var t="^[0-9]+$",i=new RegExp(t);return-1!=e.search(i)?!0:!1}function h(e){var t="^[0-9]+[.][0-9]{0,3}$",i=new RegExp(t);return i.test(e)?!0:!1}function c(e,t){var i=" ",o=-1;if(0==t||1==t){for(;" "==i;)++o,i=e.substr(o,1);e=e.substring(o)}if(0==t||2==t){for(i=" ",o=e.length;" "==i;)--o,i=e.substr(o,1);e=e.substring(0,o+1)}return e}function l(e){var t=new Date(1e3*e),i=t.getFullYear(),o=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,r=t.getDate()<10?"0"+t.getDate():t.getDate();t.getHours()<10?"0"+t.getHours():t.getHours(),t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes(),t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds();return i+"."+o+"."+r}e.checkEmail=t,e.isIP=i,e.checkMobile=o,e.checkPhone=r,e.isNull=n,e.isInteger=s,e.isNumber=a,e.isMoney=h,e.cTrim=c,e.timestampToTime=l}(RegUtils||(RegUtils={}));var SoundManager=function(){function e(){this.onOff=!0}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),e.prototype.playMusic=function(e,t){void 0===e&&(e=""),void 0===t&&(t=.5)},e.prototype.stopMusic=function(){},e.prototype.playNullSound=function(){var e=ZipUtils.single.getSound("enterbook_mp3");window.playsound(e,!1)},e}();__reflect(SoundManager.prototype,"SoundManager");var TipsManager;!function(e){function t(e,t,i){void 0===t&&(t=""),void 0===i&&(i=0),null==this._dict&&(this._dict=[]),e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showTips,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.removeTips,this),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.removeTips,this),null==this._dict[e.hashCode]&&(this._dict[e.hashCode]=[],this._dict[e.hashCode].descStr=t,this._dict[e.hashCode].effectType=i)}function i(e){var t=e.currentTarget,i="",o=0;if(null==this._tips){null!=this._dict[t.hashCode]&&(i=this._dict[t.hashCode].descStr,o=this._dict[t.hashCode].effectType),this._tips=new TipsPanel(this._dict[t.hashCode].descStr),GameLayerManager.gameLayer().effectLayer.contains(this._tips)||GameLayerManager.gameLayer().effectLayer.addChild(this._tips);var r=t.parent.localToGlobal(t.x,t.y);switch(r.x=r.x+t.width/2,r.y=r.y-this._tips.getHeight(),r.x+this._tips.getWidth()>GameConfig.curWidth()?r.x=GameConfig.curWidth()-this._tips.getWidth():r.x<0&&(r.x=0),r.y+this._tips.getHeight()>GameConfig.curHeight()?r.y=GameConfig.curHeight()-this._tips.getHeight():r.y<0&&(r.y=0),this._tips.x=r.x,this._tips.y=r.y,o){case 0:this._tips.alpha=0,egret.Tween.get(this._tips).to({alpha:1},300);break;case 1:this._tips.alpha=0,this._tips.y+=this._tips.getHeight(),egret.Tween.get(this._tips).to({alpha:1,y:this._tips.y-this._tips.getHeight()},500,egret.Ease.backOut);break;case 2:this._tips.alpha=0,this._tips.x-=this._tips.getWidth(),egret.Tween.get(this._tips).to({alpha:1,x:this._tips.x+this._tips.getWidth()},500,egret.Ease.backOut);break;case 3:this._tips.alpha=0,this._tips.x+=this._tips.getWidth(),egret.Tween.get(this._tips).to({alpha:1,x:this._tips.x-this._tips.getWidth()},500,egret.Ease.backOut)}}}function o(e){e.currentTarget;if(null!=this._tips){var t=function(){GameLayerManager.gameLayer().effectLayer.contains(this._tips)&&(GameLayerManager.gameLayer().effectLayer.removeChild(this._tips),this._tips=null)};egret.Tween.get(this._tips).to({alpha:0},300).call(t,this)}}e.addTips=t,e.showTips=i,e.removeTips=o}(TipsManager||(TipsManager={}));var TipsPanel=function(e){function t(t){void 0===t&&(t="");var i=e.call(this)||this;return i.descStr="",i.descStr=t,i.initUI(),i}return __extends(t,e),t.prototype.initUI=function(){this.bg=new egret.Bitmap,this.bg.texture=RES.getRes("tipsBg_png"),this.addChild(this.bg),this.bg.touchEnabled=!0,this.descTF=new egret.TextField,this.addChild(this.descTF),this.descTF.textColor=0,this.descTF.size=20,this.descTF.x=5,this.descTF.textAlign="center",this.descTF.text=this.descStr;var e=new egret.Rectangle(5,5,5,5);this.bg.scale9Grid=e,this.bg.width=this.descTF.width+10,this.bg.height=3*this.descTF.height,this.descTF.y=this.bg.height/2-this.descTF.height/2+2},t.prototype.getHeight=function(){return this.bg.height},t.prototype.getWidth=function(){return this.bg.width},t}(eui.Component);__reflect(TipsPanel.prototype,"TipsPanel");var egret;!function(e){var t=function(){function e(){this.decodeArr=[],this.isDecoding=!1}return Object.defineProperty(e,"single",{get:function(){return null==this._single?this._single=new e:this._single},enumerable:!0,configurable:!0}),e.prototype.decodeAudios=function(){if(!(this.decodeArr.length<=0||this.isDecoding)){this.isDecoding=!0;var t=this.decodeArr.shift();this.ctx.decodeAudioData(t.buffer,function(i){t.self.audioBuffer=i,t.success&&t.success(),e.single.isDecoding=!1,e.single.decodeAudios()},function(){alert("sound decode error: "+t.url+"！\nsee http://edn.egret.com/cn/docs/page/156"),t.fail&&t.fail(),e.single.isDecoding=!1,e.single.decodeAudios()})}},e._single=null,e}();e.CSWebAudioDecode=t,__reflect(t.prototype,"egret.CSWebAudioDecode");var i=function(i){function o(){var e=i.call(this)||this;return e.loaded=!1,e}return __extends(o,i),Object.defineProperty(o.prototype,"length",{get:function(){if(this.audioBuffer)return this.audioBuffer.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),o.prototype.load=function(i){function o(){n.loaded=!0,n.dispatchEventWith(e.Event.COMPLETE)}function r(){n.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}var n=this;this.url=i;var s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){if(4==s.readyState){var i=s.status>=400||0==s.status;i?n.dispatchEventWith(e.IOErrorEvent.IO_ERROR):(t.single.decodeArr.push({buffer:s.response,success:o,fail:r,self:n,url:n.url}),t.single.decodeAudios())}},s.send()},o.prototype.play=function(t,i,o){t=+t||0,i=+i||0;var r=new e.CSWebAudioSoundChannel;return r.$url=this.url,r.$loops=i,r.$audioBuffer=this.audioBuffer,r.$startTime=t,r.playRate=o?o:1,r.$play(),e.sys.$pushSoundChannel(r),r},o.prototype.close=function(){},o.MUSIC="music",o.EFFECT="effect",o}(e.EventDispatcher);e.CSWebAudioSound=i,__reflect(i.prototype,"egret.CSWebAudioSound",["egret.Sound"])}(egret||(egret={}));var egret;!function(e){var t=function(t){function i(){var i=t.call(this)||this;return i.$startTime=0,i.bufferSource=null,i.context=e.CSWebAudioDecode.single.ctx,i.isStopped=!1,i._currentTime=0,i._volume=1,i.onPlayEnd=function(){return 1==i.$loops?(i.stop(),void i.dispatchEventWith(e.Event.SOUND_COMPLETE)):(i.$loops>0&&i.$loops--,void i.$play())
},i._startTime=0,i.context.createGain?i.gain=i.context.createGain():i.gain=i.context.createGainNode(),i}return __extends(i,t),i.prototype.$play=function(){if(this.isStopped)return void e.$error(1036);this.bufferSource&&(this.bufferSource.onended=null,this.bufferSource=null);var t=this.context,i=this.gain,o=t.createBufferSource();this.bufferSource=o,o.buffer=this.$audioBuffer,o.connect(i),i.connect(t.destination),o.onended=this.onPlayEnd,this._startTime=Date.now(),this.gain.gain.value=this._volume,console.log(o.playbackRate),o.start(0,this.$startTime),this._currentTime=0},i.prototype.stop=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.onended=null,t.disconnect(),this.bufferSource=null,this.$audioBuffer=null}this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0},Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.gain.gain.value=t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.bufferSource?(Date.now()-this._startTime)/1e3+this.$startTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playRate",{set:function(t){return this.isStopped?void e.$error(1036):void(this.bufferSource&&(this.bufferSource.playbackRate.value=t))},enumerable:!0,configurable:!0}),i}(e.EventDispatcher);e.CSWebAudioSoundChannel=t,__reflect(t.prototype,"egret.CSWebAudioSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={}));var egret;!function(e){var t=function(t){function i(){var e=t.call(this)||this;return e.loaded=!1,e}return __extends(i,t),Object.defineProperty(i.prototype,"length",{get:function(){if(this.originAudio)return this.originAudio.duration;throw new Error("sound not loaded!")},enumerable:!0,configurable:!0}),i.prototype.load=function(t){function o(){i.$recycle(this.url,a),n(),h.indexOf("firefox")>=0&&(a.pause(),a.muted=!1),s.loaded=!0,s.dispatchEventWith(e.Event.COMPLETE)}function r(){n(),s.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}function n(){a.removeEventListener("canplaythrough",o),a.removeEventListener("error",r),h.indexOf("edge")>=0&&document.body.removeChild(a)}var s=this;this.url=t;var a=new Audio(t);a.addEventListener("canplaythrough",o),a.addEventListener("error",r);var h=navigator.userAgent.toLowerCase();h.indexOf("firefox")>=0&&(a.autoplay=!0,a.muted=!0),h.indexOf("edge")>=0&&document.body.appendChild(a),a.load(),this.originAudio=a,i.clearAudios[this.url]&&delete i.clearAudios[this.url]},i.prototype.play=function(t,o,r){t=+t||0,o=+o||0;var n=i.$pop(this.url);null==n&&(n=this.originAudio.cloneNode()),n.autoplay=!0,n.playbackRate=r?r:1;var s=new e.CustomSoundChannel(n);return s.$url=this.url,s.$loops=o,s.$startTime=t,s.$play(),e.sys.$pushSoundChannel(s),s},i.prototype.close=function(){0==this.loaded&&this.originAudio&&(this.originAudio.src=""),this.originAudio&&(this.originAudio=null),i.$clear(this.url)},i.$clear=function(e){i.clearAudios[e]=!0;var t=i.audios[e];t&&(t.length=0)},i.$pop=function(e){var t=i.audios[e];return t&&t.length>0?t.pop():null},i.$recycle=function(e,t){if(!i.clearAudios[e]){var o=i.audios[e];null==i.audios[e]&&(o=i.audios[e]=[]),o.push(t)}},i.MUSIC="music",i.EFFECT="effect",i.audios={},i.clearAudios={},i}(e.EventDispatcher);e.CustomSound=t,__reflect(t.prototype,"egret.CustomSound")}(egret||(egret={}));var egret;!function(e){var t=function(t){function i(i){var o=t.call(this)||this;return o.$startTime=0,o.audio=null,o.isStopped=!1,o.canPlay=function(){o.audio.removeEventListener("canplay",o.canPlay);try{o.audio.currentTime=o.$startTime}catch(e){}finally{o.audio.play()}},o.onPlayEnd=function(){return 1==o.$loops?(o.stop(),void o.dispatchEventWith(e.Event.SOUND_COMPLETE)):(o.$loops>0&&o.$loops--,void o.$play())},o._volume=1,i.addEventListener("ended",o.onPlayEnd),o.audio=i,o}return __extends(i,t),i.prototype.$play=function(){if(this.isStopped)return void e.$error(1036);try{this.audio.volume=this._volume,this.audio.currentTime=this.$startTime}catch(t){return void this.audio.addEventListener("canplay",this.canPlay)}this.audio.play()},i.prototype.stop=function(){if(this.audio){this.isStopped||e.sys.$popSoundChannel(this),this.isStopped=!0;var t=this.audio;t.removeEventListener("ended",this.onPlayEnd),t.removeEventListener("canplay",this.canPlay),t.volume=0,this._volume=0,this.audio=null;var i=this.$url;window.setTimeout(function(){t.pause(),e.CustomSound.$recycle(i,t)},200)}},Object.defineProperty(i.prototype,"volume",{get:function(){return this._volume},set:function(t){return this.isStopped?void e.$error(1036):(this._volume=t,void(this.audio&&(this.audio.volume=t)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"position",{get:function(){return this.audio?this.audio.currentTime:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playRate",{set:function(t){return this.isStopped?void e.$error(1036):void(this.audio&&(this.audio.playbackRate=t))},enumerable:!0,configurable:!0}),i}(e.EventDispatcher);e.CustomSoundChannel=t,__reflect(t.prototype,"egret.CustomSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={}));var BitmapBlink=function(e){function t(t,i,o){void 0===o&&(o=!0);var r=e.call(this)||this;return r._target=t,r._time=i,o&&r.start(),r}return __extends(t,e),t.prototype.start=function(){this._currTime=egret.getTimer(),this._target.addEventListener(egret.Event.ENTER_FRAME,this.runDown,this)},t.prototype.runDown=function(e){this._target.alpha-=.045,this.checkOver()||this._target.alpha<=.6&&(this._target.removeEventListener(egret.Event.ENTER_FRAME,this.runDown,this),this._target.addEventListener(egret.Event.ENTER_FRAME,this.runUp,this))},t.prototype.runUp=function(e){this._target.alpha+=.045,this.checkOver()||this._target.alpha>=1&&(this._target.removeEventListener(egret.Event.ENTER_FRAME,this.runUp,this),this._target.addEventListener(egret.Event.ENTER_FRAME,this.runDown,this))},t.prototype.checkOver=function(){var e=egret.getTimer();return e-this._currTime>=this._time?(this.destroy(),!0):!1},t.prototype.destroy=function(){this._target.alpha=1,this._target.removeEventListener(egret.Event.ENTER_FRAME,this.runDown,this),this._target.removeEventListener(egret.Event.ENTER_FRAME,this.runUp,this),this.dispatchEventWith(egret.Event.COMPLETE,!1,this._target),this._target=null},t}(egret.EventDispatcher);__reflect(BitmapBlink.prototype,"BitmapBlink");var FrameAnim=function(e){function t(t){var i=e.call(this,t)||this;i.b_isAnim=!1,i.b_isLoop=!1;var o=i;return o.updateTexture(t),o.m_completeFuncs=[],o.addEventListener(egret.Event.REMOVED_FROM_STAGE,o.onDestroy,o),i}return __extends(t,e),t.prototype.onDestroy=function(){var e=this;e.stopAnim(),e.m_orgTexture=null,e.m_spriteSheet=null,e.m_animData=null,e.m_completeFuncs=null},t.prototype.updateTexture=function(e){var t=this;t.b_isAnim||(t.texture=e),t.m_orgTexture=e},t.prototype.initAnims=function(e,t){var i=this;i.m_frameRate=e.frameRate,i.m_animData=e.anims,i.m_spriteSheet=t},t.prototype._playFrame=function(e){var t=this,i=t.m_animData[e];t.m_spriteSheet?t.texture=t.m_spriteSheet.getTexture(i):t.texture=RES.getRes(i)},t.prototype.playAnim=function(e){void 0===e&&(e=!1);var t=this,i=t.m_animData;i&&(t.b_isAnim=!0,t.b_isLoop=e,t.m_time=egret.getTimer(),t.m_animIndex=0,t._playFrame(t.m_animIndex),egret.startTick(t.ticker,t))},t.prototype.stopAnim=function(){var e=this;egret.stopTick(e.ticker,e),e.b_isAnim=!1,e.texture=e.m_orgTexture},t.prototype.ticker=function(e){var t=this,i=this;if(i.b_isAnim){var o=egret.getTimer(),r=o-i.m_time;if(r>=i.m_frameRate){if(++i.m_animIndex,i.m_animIndex>=i.m_animData.length){if(!i.b_isLoop)return i.m_completeFuncs.forEach(function(e){e.compFunc.call(e.thisObj,t)}),void i.stopAnim();i.m_animIndex=0}i._playFrame(i.m_animIndex),i.m_time=o}return!1}},t.prototype.addCompeleteListener=function(e,t){var i={};i.compFunc=e,i.thisObj=t,this.m_completeFuncs.push(i)},t.prototype.removeCompeleteListener=function(e,t){var i=[];this.m_completeFuncs.forEach(function(o){(o.thisObj!==t||o.compFunc!==e)&&i.push(o)}),this.m_completeFuncs=i},t}(egret.Bitmap);__reflect(FrameAnim.prototype,"FrameAnim");var TipsUtils;!function(e){function t(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2-i.width/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,GameLayerManager.gameLayer().effectLayer.contains(i)||GameLayerManager.gameLayer().effectLayer.addChild(i);var o=function(){GameLayerManager.gameLayer().effectLayer.contains(i)&&(GameLayerManager.gameLayer().effectLayer.removeChild(i),i=null)},r=function(){egret.Tween.get(i).to({alpha:0},500).call(o,this)};i.visible=!0,egret.Tween.get(i).to({y:i.y-120,alpha:1},800,egret.Ease.backOut).call(r,this)}function i(e,t,i){void 0===e&&(e=""),void 0===t&&(t=!1),void 0===i&&(i=!0);var o=new egret.TextField;o.size=24,o.y=GameConfig.curHeight()/2,t?o.textColor=GameConfig.TextColors.red:o.textColor=GameConfig.TextColors.green,o.alpha=0,o.text=e,o.strokeColor=0,i?o.x=-o.width:o.x=GameConfig.curWidth(),o.stroke=2,o.bold=!0,o.textAlign=egret.HorizontalAlign.CENTER,GameLayerManager.gameLayer().effectLayer.contains(o)||GameLayerManager.gameLayer().effectLayer.addChild(o),i?egret.Tween.get(o).to({x:GameConfig.curWidth()/2-o.width/2-50,alpha:1},300,egret.Ease.sineInOut):egret.Tween.get(o).to({x:GameConfig.curWidth()/2-o.width/2+50,alpha:1},300,egret.Ease.sineInOut),egret.setTimeout(function(){i?egret.Tween.get(o).to({x:o.x+100},500):egret.Tween.get(o).to({x:o.x-100},500)},this,300),egret.setTimeout(function(){i?egret.Tween.get(o).to({x:GameConfig.curWidth()},300,egret.Ease.sineIn):egret.Tween.get(o).to({x:-o.width},300,egret.Ease.sineIn)},this,800),egret.setTimeout(function(){GameLayerManager.gameLayer().effectLayer.contains(o)&&(GameLayerManager.gameLayer().effectLayer.removeChild(o),o=null)},this,1100)}function o(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,GameLayerManager.gameLayer().effectLayer.contains(i)||GameLayerManager.gameLayer().effectLayer.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=0,i.scaleY=0;var o=function(){GameLayerManager.gameLayer().effectLayer.contains(i)&&(GameLayerManager.gameLayer().effectLayer.removeChild(i),i=null)};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(o,this)},this,1e3)}function r(e,t){void 0===e&&(e=""),void 0===t&&(t=!1);var i=new egret.TextField;i.size=24,i.y=GameConfig.curHeight()/2,t?i.textColor=GameConfig.TextColors.red:i.textColor=GameConfig.TextColors.green,i.alpha=0,i.text=e,i.strokeColor=0,i.x=GameConfig.curWidth()/2,i.stroke=2,i.bold=!0,i.textAlign=egret.HorizontalAlign.CENTER,GameLayerManager.gameLayer().effectLayer.contains(i)||GameLayerManager.gameLayer().effectLayer.addChild(i),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=4,i.scaleY=4;var o=function(){GameLayerManager.gameLayer().effectLayer.contains(i)&&(GameLayerManager.gameLayer().effectLayer.removeChild(i),i=null)};egret.Tween.get(i).to({scaleX:1,scaleY:1,alpha:1},200),egret.setTimeout(function(){egret.Tween.get(i).to({alpha:0},500).call(o,this)},this,1e3)}e.showTipsDownToUp=t,e.showTipsLeftOrRight=i,e.showTipsFromCenter=o,e.showTipsBigToSmall=r}(TipsUtils||(TipsUtils={}));var ResourceManagerError=RES.ResourceManagerError,ZipUtils=function(){function e(){this._zips={},this._soundList={},this._sheetList={}}return Object.defineProperty(e,"single",{get:function(){return null==this._single?this._single=new e:this._single},enumerable:!0,configurable:!0}),e.prototype.loadZip=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,o,r,n,s,a;return __generator(this,function(h){switch(h.label){case 0:return[4,RES.getResAsync(e)];case 1:return i=h.sent(),[4,JSZip.loadAsync(i)];case 2:o=h.sent(),this._curZip=o,r=Object.keys(o.files),n=r.length,s=0,h.label=3;case 3:return n>s?(a=r[s],[4,this.analysis(a,o.files[a],t)]):[3,6];case 4:h.sent(),h.label=5;case 5:return s++,[3,3];case 6:return this._zips[e]=o,[2]}})})},e.prototype.analysis=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var o,r,n,s,a,h,c,l,u,d,g,p,f,_,y,m,p,v,E,_,w,C=this;return __generator(this,function(T){switch(T.label){case 0:if(console.log("relativePath",e),-1!=e.indexOf("__MACOSX"))return[3,12];switch(o=e.substr(e.lastIndexOf(".")+1),r=this._curZip,n=i){case"sound":return[3,1];case"db":return[3,3];case"sheet":return[3,8]}return[3,12];case 1:return[4,t.async("blob")];case 2:return s=T.sent(),a=URL.createObjectURL(s),h=new egret.Sound,h.once(egret.Event.COMPLETE,function(){var t=e.replace(/(.*)\./,"$1_");C._soundList[t]=h},this),h.load(a),[3,12];case 3:return"dbbin"!=o?[3,7]:(c=e,l=e.lastIndexOf("_"),u=e.replace(e.substring(l+1),"tex.json"),d=e.replace(e.substring(l+1),"tex.png"),[4,r.files[c].async("arraybuffer")]);case 4:return g=T.sent(),[4,r.files[u].async("text")];case 5:return p=T.sent(),f=JSON.parse(p),[4,r.files[d].async("base64")];case 6:_=T.sent(),y=new Image,y.src="data:image/png;base64,"+_,y.onload=function(){var e=new egret.Texture,t=new egret.BitmapData(y);e.bitmapData=t;var i=dragonBones.EgretFactory.factory;i.parseDragonBonesData(g),i.parseTextureAtlasData(f,e)},T.label=7;case 7:return[3,12];case 8:return"json"!=o?[3,11]:(m=e,[4,r.files[m].async("text")]);case 9:return p=T.sent(),v=JSON.parse(p),E=v.file,[4,r.files[E].async("base64")];case 10:_=T.sent(),w=new Image,w.src="data:image/png;base64,"+_,w.onload=function(){var t=new egret.Texture,i=new egret.BitmapData(w);t.bitmapData=i;var o=new egret.SpriteSheet(t),r=v.frames;for(var n in r){var s=r[n],a=o.createTexture(n,s.x,s.y,s.w,s.h,s.offX,s.offY,s.sourceW,s.sourceH);if(s.scale9grid){var h=s.scale9grid,c=h.split(",");a.scale9Grid=new egret.Rectangle(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]),parseInt(c[3]))}}var l=e.replace(/(.*)\./,"$1_");C._sheetList[l]=o,console.log("jsonName === "+m+"pngName"+E)},T.label=11;case 11:return[3,12];case 12:return[2]}})})},e.prototype.getSound=function(e){return this._soundList.hasOwnProperty(e)?(console.log("get zip sound"),this._soundList[e]):RES.hasRes(e)?RES.getRes(e):null},e.prototype.addSound=function(e,t){this._soundList[e]=t},e.prototype.getDBAnimate=function(e){return dragonBones.EgretFactory.factory.buildArmatureDisplay(e)},e.prototype.getSheet=function(e){if(-1!=e.indexOf(".")){var t=e.split("."),i=t[0],o=t[1];if(this._sheetList.hasOwnProperty(i)){var r=this._sheetList[i];return r.getTexture(o)}return null}for(var t=Object.keys(this._sheetList),n=t.length,s=0;n>s;s++){var r=this._sheetList[t[s]];if(r.getTexture(e))return r.getTexture(e)}return null},e}();__reflect(ZipUtils.prototype,"ZipUtils");